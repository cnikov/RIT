{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar LinkDetector_1;\nimport { createCancelablePromise, RunOnceScheduler } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport * as platform from '../../../../base/common/platform.js';\nimport * as resources from '../../../../base/common/resources.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport './links.css';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { ModelDecorationOptions } from '../../../common/model/textModel.js';\nimport { ILanguageFeatureDebounceService } from '../../../common/services/languageFeatureDebounce.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { ClickLinkGesture } from '../../gotoSymbol/browser/link/clickLinkGesture.js';\nimport { getLinks } from './getLinks.js';\nimport * as nls from '../../../../nls.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nlet LinkDetector = LinkDetector_1 = class LinkDetector extends Disposable {\n  static get(editor) {\n    return editor.getContribution(LinkDetector_1.ID);\n  }\n  constructor(editor, openerService, notificationService, languageFeaturesService, languageFeatureDebounceService) {\n    super();\n    this.editor = editor;\n    this.openerService = openerService;\n    this.notificationService = notificationService;\n    this.languageFeaturesService = languageFeaturesService;\n    this.providers = this.languageFeaturesService.linkProvider;\n    this.debounceInformation = languageFeatureDebounceService.for(this.providers, 'Links', {\n      min: 1000,\n      max: 4000\n    });\n    this.computeLinks = this._register(new RunOnceScheduler(() => this.computeLinksNow(), 1000));\n    this.computePromise = null;\n    this.activeLinksList = null;\n    this.currentOccurrences = {};\n    this.activeLinkDecorationId = null;\n    const clickLinkGesture = this._register(new ClickLinkGesture(editor));\n    this._register(clickLinkGesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, keyboardEvent]) => {\n      this._onEditorMouseMove(mouseEvent, keyboardEvent);\n    }));\n    this._register(clickLinkGesture.onExecute(e => {\n      this.onEditorMouseUp(e);\n    }));\n    this._register(clickLinkGesture.onCancel(e => {\n      this.cleanUpActiveLinkDecoration();\n    }));\n    this._register(editor.onDidChangeConfiguration(e => {\n      if (!e.hasChanged(70 /* EditorOption.links */)) {\n        return;\n      }\n      // Remove any links (for the getting disabled case)\n      this.updateDecorations([]);\n      // Stop any computation (for the getting disabled case)\n      this.stop();\n      // Start computing (for the getting enabled case)\n      this.computeLinks.schedule(0);\n    }));\n    this._register(editor.onDidChangeModelContent(e => {\n      if (!this.editor.hasModel()) {\n        return;\n      }\n      this.computeLinks.schedule(this.debounceInformation.get(this.editor.getModel()));\n    }));\n    this._register(editor.onDidChangeModel(e => {\n      this.currentOccurrences = {};\n      this.activeLinkDecorationId = null;\n      this.stop();\n      this.computeLinks.schedule(0);\n    }));\n    this._register(editor.onDidChangeModelLanguage(e => {\n      this.stop();\n      this.computeLinks.schedule(0);\n    }));\n    this._register(this.providers.onDidChange(e => {\n      this.stop();\n      this.computeLinks.schedule(0);\n    }));\n    this.computeLinks.schedule(0);\n  }\n  computeLinksNow() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.editor.hasModel() || !this.editor.getOption(70 /* EditorOption.links */)) {\n        return;\n      }\n      const model = this.editor.getModel();\n      if (model.isTooLargeForSyncing()) {\n        return;\n      }\n      if (!this.providers.has(model)) {\n        return;\n      }\n      if (this.activeLinksList) {\n        this.activeLinksList.dispose();\n        this.activeLinksList = null;\n      }\n      this.computePromise = createCancelablePromise(token => getLinks(this.providers, model, token));\n      try {\n        const sw = new StopWatch(false);\n        this.activeLinksList = yield this.computePromise;\n        this.debounceInformation.update(model, sw.elapsed());\n        if (model.isDisposed()) {\n          return;\n        }\n        this.updateDecorations(this.activeLinksList.links);\n      } catch (err) {\n        onUnexpectedError(err);\n      } finally {\n        this.computePromise = null;\n      }\n    });\n  }\n  updateDecorations(links) {\n    const useMetaKey = this.editor.getOption(77 /* EditorOption.multiCursorModifier */) === 'altKey';\n    const oldDecorations = [];\n    const keys = Object.keys(this.currentOccurrences);\n    for (const decorationId of keys) {\n      const occurence = this.currentOccurrences[decorationId];\n      oldDecorations.push(occurence.decorationId);\n    }\n    const newDecorations = [];\n    if (links) {\n      // Not sure why this is sometimes null\n      for (const link of links) {\n        newDecorations.push(LinkOccurrence.decoration(link, useMetaKey));\n      }\n    }\n    this.editor.changeDecorations(changeAccessor => {\n      const decorations = changeAccessor.deltaDecorations(oldDecorations, newDecorations);\n      this.currentOccurrences = {};\n      this.activeLinkDecorationId = null;\n      for (let i = 0, len = decorations.length; i < len; i++) {\n        const occurence = new LinkOccurrence(links[i], decorations[i]);\n        this.currentOccurrences[occurence.decorationId] = occurence;\n      }\n    });\n  }\n  _onEditorMouseMove(mouseEvent, withKey) {\n    const useMetaKey = this.editor.getOption(77 /* EditorOption.multiCursorModifier */) === 'altKey';\n    if (this.isEnabled(mouseEvent, withKey)) {\n      this.cleanUpActiveLinkDecoration(); // always remove previous link decoration as their can only be one\n      const occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n      if (occurrence) {\n        this.editor.changeDecorations(changeAccessor => {\n          occurrence.activate(changeAccessor, useMetaKey);\n          this.activeLinkDecorationId = occurrence.decorationId;\n        });\n      }\n    } else {\n      this.cleanUpActiveLinkDecoration();\n    }\n  }\n  cleanUpActiveLinkDecoration() {\n    const useMetaKey = this.editor.getOption(77 /* EditorOption.multiCursorModifier */) === 'altKey';\n    if (this.activeLinkDecorationId) {\n      const occurrence = this.currentOccurrences[this.activeLinkDecorationId];\n      if (occurrence) {\n        this.editor.changeDecorations(changeAccessor => {\n          occurrence.deactivate(changeAccessor, useMetaKey);\n        });\n      }\n      this.activeLinkDecorationId = null;\n    }\n  }\n  onEditorMouseUp(mouseEvent) {\n    if (!this.isEnabled(mouseEvent)) {\n      return;\n    }\n    const occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n    if (!occurrence) {\n      return;\n    }\n    this.openLinkOccurrence(occurrence, mouseEvent.hasSideBySideModifier, true /* from user gesture */);\n  }\n\n  openLinkOccurrence(occurrence, openToSide, fromUserGesture = false) {\n    if (!this.openerService) {\n      return;\n    }\n    const {\n      link\n    } = occurrence;\n    link.resolve(CancellationToken.None).then(uri => {\n      // Support for relative file URIs of the shape file://./relativeFile.txt or file:///./relativeFile.txt\n      if (typeof uri === 'string' && this.editor.hasModel()) {\n        const modelUri = this.editor.getModel().uri;\n        if (modelUri.scheme === Schemas.file && uri.startsWith(`${Schemas.file}:`)) {\n          const parsedUri = URI.parse(uri);\n          if (parsedUri.scheme === Schemas.file) {\n            const fsPath = resources.originalFSPath(parsedUri);\n            let relativePath = null;\n            if (fsPath.startsWith('/./')) {\n              relativePath = `.${fsPath.substr(1)}`;\n            } else if (fsPath.startsWith('//./')) {\n              relativePath = `.${fsPath.substr(2)}`;\n            }\n            if (relativePath) {\n              uri = resources.joinPath(modelUri, relativePath);\n            }\n          }\n        }\n      }\n      return this.openerService.open(uri, {\n        openToSide,\n        fromUserGesture,\n        allowContributedOpeners: true,\n        allowCommands: true,\n        fromWorkspace: true\n      });\n    }, err => {\n      const messageOrError = err instanceof Error ? err.message : err;\n      // different error cases\n      if (messageOrError === 'invalid') {\n        this.notificationService.warn(nls.localize('invalid.url', 'Failed to open this link because it is not well-formed: {0}', link.url.toString()));\n      } else if (messageOrError === 'missing') {\n        this.notificationService.warn(nls.localize('missing.url', 'Failed to open this link because its target is missing.'));\n      } else {\n        onUnexpectedError(err);\n      }\n    });\n  }\n  getLinkOccurrence(position) {\n    if (!this.editor.hasModel() || !position) {\n      return null;\n    }\n    const decorations = this.editor.getModel().getDecorationsInRange({\n      startLineNumber: position.lineNumber,\n      startColumn: position.column,\n      endLineNumber: position.lineNumber,\n      endColumn: position.column\n    }, 0, true);\n    for (const decoration of decorations) {\n      const currentOccurrence = this.currentOccurrences[decoration.id];\n      if (currentOccurrence) {\n        return currentOccurrence;\n      }\n    }\n    return null;\n  }\n  isEnabled(mouseEvent, withKey) {\n    return Boolean(mouseEvent.target.type === 6 /* MouseTargetType.CONTENT_TEXT */ && (mouseEvent.hasTriggerModifier || withKey && withKey.keyCodeIsTriggerKey));\n  }\n  stop() {\n    var _a;\n    this.computeLinks.cancel();\n    if (this.activeLinksList) {\n      (_a = this.activeLinksList) === null || _a === void 0 ? void 0 : _a.dispose();\n      this.activeLinksList = null;\n    }\n    if (this.computePromise) {\n      this.computePromise.cancel();\n      this.computePromise = null;\n    }\n  }\n  dispose() {\n    super.dispose();\n    this.stop();\n  }\n};\nLinkDetector.ID = 'editor.linkDetector';\nLinkDetector = LinkDetector_1 = __decorate([__param(1, IOpenerService), __param(2, INotificationService), __param(3, ILanguageFeaturesService), __param(4, ILanguageFeatureDebounceService)], LinkDetector);\nexport { LinkDetector };\nconst decoration = {\n  general: ModelDecorationOptions.register({\n    description: 'detected-link',\n    stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */,\n    collapseOnReplaceEdit: true,\n    inlineClassName: 'detected-link'\n  }),\n  active: ModelDecorationOptions.register({\n    description: 'detected-link-active',\n    stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */,\n    collapseOnReplaceEdit: true,\n    inlineClassName: 'detected-link-active'\n  })\n};\nclass LinkOccurrence {\n  static decoration(link, useMetaKey) {\n    return {\n      range: link.range,\n      options: LinkOccurrence._getOptions(link, useMetaKey, false)\n    };\n  }\n  static _getOptions(link, useMetaKey, isActive) {\n    const options = Object.assign({}, isActive ? decoration.active : decoration.general);\n    options.hoverMessage = getHoverMessage(link, useMetaKey);\n    return options;\n  }\n  constructor(link, decorationId) {\n    this.link = link;\n    this.decorationId = decorationId;\n  }\n  activate(changeAccessor, useMetaKey) {\n    changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, true));\n  }\n  deactivate(changeAccessor, useMetaKey) {\n    changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, false));\n  }\n}\nfunction getHoverMessage(link, useMetaKey) {\n  const executeCmd = link.url && /^command:/i.test(link.url.toString());\n  const label = link.tooltip ? link.tooltip : executeCmd ? nls.localize('links.navigate.executeCmd', 'Execute command') : nls.localize('links.navigate.follow', 'Follow link');\n  const kb = useMetaKey ? platform.isMacintosh ? nls.localize('links.navigate.kb.meta.mac', \"cmd + click\") : nls.localize('links.navigate.kb.meta', \"ctrl + click\") : platform.isMacintosh ? nls.localize('links.navigate.kb.alt.mac', \"option + click\") : nls.localize('links.navigate.kb.alt', \"alt + click\");\n  if (link.url) {\n    let nativeLabel = '';\n    if (/^command:/i.test(link.url.toString())) {\n      // Don't show complete command arguments in the native tooltip\n      const match = link.url.toString().match(/^command:([^?#]+)/);\n      if (match) {\n        const commandId = match[1];\n        nativeLabel = nls.localize('tooltip.explanation', \"Execute command {0}\", commandId);\n      }\n    }\n    const hoverMessage = new MarkdownString('', true).appendLink(link.url.toString(true).replace(/ /g, '%20'), label, nativeLabel).appendMarkdown(` (${kb})`);\n    return hoverMessage;\n  } else {\n    return new MarkdownString().appendText(`${label} (${kb})`);\n  }\n}\nclass OpenLinkAction extends EditorAction {\n  constructor() {\n    super({\n      id: 'editor.action.openLink',\n      label: nls.localize('label', \"Open Link\"),\n      alias: 'Open Link',\n      precondition: undefined\n    });\n  }\n  run(accessor, editor) {\n    const linkDetector = LinkDetector.get(editor);\n    if (!linkDetector) {\n      return;\n    }\n    if (!editor.hasModel()) {\n      return;\n    }\n    const selections = editor.getSelections();\n    for (const sel of selections) {\n      const link = linkDetector.getLinkOccurrence(sel.getEndPosition());\n      if (link) {\n        linkDetector.openLinkOccurrence(link, false);\n      }\n    }\n  }\n}\nregisterEditorContribution(LinkDetector.ID, LinkDetector, 1 /* EditorContributionInstantiation.AfterFirstRender */);\nregisterEditorAction(OpenLinkAction);","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","LinkDetector_1","createCancelablePromise","RunOnceScheduler","CancellationToken","onUnexpectedError","MarkdownString","Disposable","Schemas","platform","resources","StopWatch","URI","EditorAction","registerEditorAction","registerEditorContribution","ModelDecorationOptions","ILanguageFeatureDebounceService","ILanguageFeaturesService","ClickLinkGesture","getLinks","nls","INotificationService","IOpenerService","LinkDetector","get","editor","getContribution","ID","constructor","openerService","notificationService","languageFeaturesService","languageFeatureDebounceService","providers","linkProvider","debounceInformation","for","min","max","computeLinks","_register","computeLinksNow","computePromise","activeLinksList","currentOccurrences","activeLinkDecorationId","clickLinkGesture","onMouseMoveOrRelevantKeyDown","mouseEvent","keyboardEvent","_onEditorMouseMove","onExecute","onEditorMouseUp","onCancel","cleanUpActiveLinkDecoration","onDidChangeConfiguration","hasChanged","updateDecorations","stop","schedule","onDidChangeModelContent","hasModel","getModel","onDidChangeModel","onDidChangeModelLanguage","onDidChange","getOption","model","isTooLargeForSyncing","has","dispose","token","sw","update","elapsed","isDisposed","links","err","useMetaKey","oldDecorations","keys","decorationId","occurence","push","newDecorations","link","LinkOccurrence","decoration","changeDecorations","changeAccessor","decorations","deltaDecorations","len","withKey","isEnabled","occurrence","getLinkOccurrence","position","activate","deactivate","openLinkOccurrence","hasSideBySideModifier","openToSide","fromUserGesture","None","uri","modelUri","scheme","file","startsWith","parsedUri","parse","fsPath","originalFSPath","relativePath","substr","joinPath","open","allowContributedOpeners","allowCommands","fromWorkspace","messageOrError","Error","message","warn","localize","url","toString","getDecorationsInRange","startLineNumber","lineNumber","startColumn","column","endLineNumber","endColumn","currentOccurrence","id","Boolean","type","hasTriggerModifier","keyCodeIsTriggerKey","_a","cancel","general","register","description","stickiness","collapseOnReplaceEdit","inlineClassName","active","range","options","_getOptions","isActive","assign","hoverMessage","getHoverMessage","changeDecorationOptions","executeCmd","test","label","tooltip","kb","isMacintosh","nativeLabel","match","commandId","appendLink","replace","appendMarkdown","appendText","OpenLinkAction","alias","precondition","undefined","run","accessor","linkDetector","selections","getSelections","sel","getEndPosition"],"sources":["/home/chlohest/work/website/my_web/node_modules/monaco-editor/esm/vs/editor/contrib/links/browser/links.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar LinkDetector_1;\nimport { createCancelablePromise, RunOnceScheduler } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport * as platform from '../../../../base/common/platform.js';\nimport * as resources from '../../../../base/common/resources.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport './links.css';\nimport { EditorAction, registerEditorAction, registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { ModelDecorationOptions } from '../../../common/model/textModel.js';\nimport { ILanguageFeatureDebounceService } from '../../../common/services/languageFeatureDebounce.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { ClickLinkGesture } from '../../gotoSymbol/browser/link/clickLinkGesture.js';\nimport { getLinks } from './getLinks.js';\nimport * as nls from '../../../../nls.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nlet LinkDetector = LinkDetector_1 = class LinkDetector extends Disposable {\n    static get(editor) {\n        return editor.getContribution(LinkDetector_1.ID);\n    }\n    constructor(editor, openerService, notificationService, languageFeaturesService, languageFeatureDebounceService) {\n        super();\n        this.editor = editor;\n        this.openerService = openerService;\n        this.notificationService = notificationService;\n        this.languageFeaturesService = languageFeaturesService;\n        this.providers = this.languageFeaturesService.linkProvider;\n        this.debounceInformation = languageFeatureDebounceService.for(this.providers, 'Links', { min: 1000, max: 4000 });\n        this.computeLinks = this._register(new RunOnceScheduler(() => this.computeLinksNow(), 1000));\n        this.computePromise = null;\n        this.activeLinksList = null;\n        this.currentOccurrences = {};\n        this.activeLinkDecorationId = null;\n        const clickLinkGesture = this._register(new ClickLinkGesture(editor));\n        this._register(clickLinkGesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, keyboardEvent]) => {\n            this._onEditorMouseMove(mouseEvent, keyboardEvent);\n        }));\n        this._register(clickLinkGesture.onExecute((e) => {\n            this.onEditorMouseUp(e);\n        }));\n        this._register(clickLinkGesture.onCancel((e) => {\n            this.cleanUpActiveLinkDecoration();\n        }));\n        this._register(editor.onDidChangeConfiguration((e) => {\n            if (!e.hasChanged(70 /* EditorOption.links */)) {\n                return;\n            }\n            // Remove any links (for the getting disabled case)\n            this.updateDecorations([]);\n            // Stop any computation (for the getting disabled case)\n            this.stop();\n            // Start computing (for the getting enabled case)\n            this.computeLinks.schedule(0);\n        }));\n        this._register(editor.onDidChangeModelContent((e) => {\n            if (!this.editor.hasModel()) {\n                return;\n            }\n            this.computeLinks.schedule(this.debounceInformation.get(this.editor.getModel()));\n        }));\n        this._register(editor.onDidChangeModel((e) => {\n            this.currentOccurrences = {};\n            this.activeLinkDecorationId = null;\n            this.stop();\n            this.computeLinks.schedule(0);\n        }));\n        this._register(editor.onDidChangeModelLanguage((e) => {\n            this.stop();\n            this.computeLinks.schedule(0);\n        }));\n        this._register(this.providers.onDidChange((e) => {\n            this.stop();\n            this.computeLinks.schedule(0);\n        }));\n        this.computeLinks.schedule(0);\n    }\n    computeLinksNow() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.editor.hasModel() || !this.editor.getOption(70 /* EditorOption.links */)) {\n                return;\n            }\n            const model = this.editor.getModel();\n            if (model.isTooLargeForSyncing()) {\n                return;\n            }\n            if (!this.providers.has(model)) {\n                return;\n            }\n            if (this.activeLinksList) {\n                this.activeLinksList.dispose();\n                this.activeLinksList = null;\n            }\n            this.computePromise = createCancelablePromise(token => getLinks(this.providers, model, token));\n            try {\n                const sw = new StopWatch(false);\n                this.activeLinksList = yield this.computePromise;\n                this.debounceInformation.update(model, sw.elapsed());\n                if (model.isDisposed()) {\n                    return;\n                }\n                this.updateDecorations(this.activeLinksList.links);\n            }\n            catch (err) {\n                onUnexpectedError(err);\n            }\n            finally {\n                this.computePromise = null;\n            }\n        });\n    }\n    updateDecorations(links) {\n        const useMetaKey = (this.editor.getOption(77 /* EditorOption.multiCursorModifier */) === 'altKey');\n        const oldDecorations = [];\n        const keys = Object.keys(this.currentOccurrences);\n        for (const decorationId of keys) {\n            const occurence = this.currentOccurrences[decorationId];\n            oldDecorations.push(occurence.decorationId);\n        }\n        const newDecorations = [];\n        if (links) {\n            // Not sure why this is sometimes null\n            for (const link of links) {\n                newDecorations.push(LinkOccurrence.decoration(link, useMetaKey));\n            }\n        }\n        this.editor.changeDecorations((changeAccessor) => {\n            const decorations = changeAccessor.deltaDecorations(oldDecorations, newDecorations);\n            this.currentOccurrences = {};\n            this.activeLinkDecorationId = null;\n            for (let i = 0, len = decorations.length; i < len; i++) {\n                const occurence = new LinkOccurrence(links[i], decorations[i]);\n                this.currentOccurrences[occurence.decorationId] = occurence;\n            }\n        });\n    }\n    _onEditorMouseMove(mouseEvent, withKey) {\n        const useMetaKey = (this.editor.getOption(77 /* EditorOption.multiCursorModifier */) === 'altKey');\n        if (this.isEnabled(mouseEvent, withKey)) {\n            this.cleanUpActiveLinkDecoration(); // always remove previous link decoration as their can only be one\n            const occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n            if (occurrence) {\n                this.editor.changeDecorations((changeAccessor) => {\n                    occurrence.activate(changeAccessor, useMetaKey);\n                    this.activeLinkDecorationId = occurrence.decorationId;\n                });\n            }\n        }\n        else {\n            this.cleanUpActiveLinkDecoration();\n        }\n    }\n    cleanUpActiveLinkDecoration() {\n        const useMetaKey = (this.editor.getOption(77 /* EditorOption.multiCursorModifier */) === 'altKey');\n        if (this.activeLinkDecorationId) {\n            const occurrence = this.currentOccurrences[this.activeLinkDecorationId];\n            if (occurrence) {\n                this.editor.changeDecorations((changeAccessor) => {\n                    occurrence.deactivate(changeAccessor, useMetaKey);\n                });\n            }\n            this.activeLinkDecorationId = null;\n        }\n    }\n    onEditorMouseUp(mouseEvent) {\n        if (!this.isEnabled(mouseEvent)) {\n            return;\n        }\n        const occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n        if (!occurrence) {\n            return;\n        }\n        this.openLinkOccurrence(occurrence, mouseEvent.hasSideBySideModifier, true /* from user gesture */);\n    }\n    openLinkOccurrence(occurrence, openToSide, fromUserGesture = false) {\n        if (!this.openerService) {\n            return;\n        }\n        const { link } = occurrence;\n        link.resolve(CancellationToken.None).then(uri => {\n            // Support for relative file URIs of the shape file://./relativeFile.txt or file:///./relativeFile.txt\n            if (typeof uri === 'string' && this.editor.hasModel()) {\n                const modelUri = this.editor.getModel().uri;\n                if (modelUri.scheme === Schemas.file && uri.startsWith(`${Schemas.file}:`)) {\n                    const parsedUri = URI.parse(uri);\n                    if (parsedUri.scheme === Schemas.file) {\n                        const fsPath = resources.originalFSPath(parsedUri);\n                        let relativePath = null;\n                        if (fsPath.startsWith('/./')) {\n                            relativePath = `.${fsPath.substr(1)}`;\n                        }\n                        else if (fsPath.startsWith('//./')) {\n                            relativePath = `.${fsPath.substr(2)}`;\n                        }\n                        if (relativePath) {\n                            uri = resources.joinPath(modelUri, relativePath);\n                        }\n                    }\n                }\n            }\n            return this.openerService.open(uri, { openToSide, fromUserGesture, allowContributedOpeners: true, allowCommands: true, fromWorkspace: true });\n        }, err => {\n            const messageOrError = err instanceof Error ? err.message : err;\n            // different error cases\n            if (messageOrError === 'invalid') {\n                this.notificationService.warn(nls.localize('invalid.url', 'Failed to open this link because it is not well-formed: {0}', link.url.toString()));\n            }\n            else if (messageOrError === 'missing') {\n                this.notificationService.warn(nls.localize('missing.url', 'Failed to open this link because its target is missing.'));\n            }\n            else {\n                onUnexpectedError(err);\n            }\n        });\n    }\n    getLinkOccurrence(position) {\n        if (!this.editor.hasModel() || !position) {\n            return null;\n        }\n        const decorations = this.editor.getModel().getDecorationsInRange({\n            startLineNumber: position.lineNumber,\n            startColumn: position.column,\n            endLineNumber: position.lineNumber,\n            endColumn: position.column\n        }, 0, true);\n        for (const decoration of decorations) {\n            const currentOccurrence = this.currentOccurrences[decoration.id];\n            if (currentOccurrence) {\n                return currentOccurrence;\n            }\n        }\n        return null;\n    }\n    isEnabled(mouseEvent, withKey) {\n        return Boolean((mouseEvent.target.type === 6 /* MouseTargetType.CONTENT_TEXT */)\n            && (mouseEvent.hasTriggerModifier || (withKey && withKey.keyCodeIsTriggerKey)));\n    }\n    stop() {\n        var _a;\n        this.computeLinks.cancel();\n        if (this.activeLinksList) {\n            (_a = this.activeLinksList) === null || _a === void 0 ? void 0 : _a.dispose();\n            this.activeLinksList = null;\n        }\n        if (this.computePromise) {\n            this.computePromise.cancel();\n            this.computePromise = null;\n        }\n    }\n    dispose() {\n        super.dispose();\n        this.stop();\n    }\n};\nLinkDetector.ID = 'editor.linkDetector';\nLinkDetector = LinkDetector_1 = __decorate([\n    __param(1, IOpenerService),\n    __param(2, INotificationService),\n    __param(3, ILanguageFeaturesService),\n    __param(4, ILanguageFeatureDebounceService)\n], LinkDetector);\nexport { LinkDetector };\nconst decoration = {\n    general: ModelDecorationOptions.register({\n        description: 'detected-link',\n        stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link'\n    }),\n    active: ModelDecorationOptions.register({\n        description: 'detected-link-active',\n        stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link-active'\n    })\n};\nclass LinkOccurrence {\n    static decoration(link, useMetaKey) {\n        return {\n            range: link.range,\n            options: LinkOccurrence._getOptions(link, useMetaKey, false)\n        };\n    }\n    static _getOptions(link, useMetaKey, isActive) {\n        const options = Object.assign({}, (isActive ? decoration.active : decoration.general));\n        options.hoverMessage = getHoverMessage(link, useMetaKey);\n        return options;\n    }\n    constructor(link, decorationId) {\n        this.link = link;\n        this.decorationId = decorationId;\n    }\n    activate(changeAccessor, useMetaKey) {\n        changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, true));\n    }\n    deactivate(changeAccessor, useMetaKey) {\n        changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, false));\n    }\n}\nfunction getHoverMessage(link, useMetaKey) {\n    const executeCmd = link.url && /^command:/i.test(link.url.toString());\n    const label = link.tooltip\n        ? link.tooltip\n        : executeCmd\n            ? nls.localize('links.navigate.executeCmd', 'Execute command')\n            : nls.localize('links.navigate.follow', 'Follow link');\n    const kb = useMetaKey\n        ? platform.isMacintosh\n            ? nls.localize('links.navigate.kb.meta.mac', \"cmd + click\")\n            : nls.localize('links.navigate.kb.meta', \"ctrl + click\")\n        : platform.isMacintosh\n            ? nls.localize('links.navigate.kb.alt.mac', \"option + click\")\n            : nls.localize('links.navigate.kb.alt', \"alt + click\");\n    if (link.url) {\n        let nativeLabel = '';\n        if (/^command:/i.test(link.url.toString())) {\n            // Don't show complete command arguments in the native tooltip\n            const match = link.url.toString().match(/^command:([^?#]+)/);\n            if (match) {\n                const commandId = match[1];\n                nativeLabel = nls.localize('tooltip.explanation', \"Execute command {0}\", commandId);\n            }\n        }\n        const hoverMessage = new MarkdownString('', true)\n            .appendLink(link.url.toString(true).replace(/ /g, '%20'), label, nativeLabel)\n            .appendMarkdown(` (${kb})`);\n        return hoverMessage;\n    }\n    else {\n        return new MarkdownString().appendText(`${label} (${kb})`);\n    }\n}\nclass OpenLinkAction extends EditorAction {\n    constructor() {\n        super({\n            id: 'editor.action.openLink',\n            label: nls.localize('label', \"Open Link\"),\n            alias: 'Open Link',\n            precondition: undefined\n        });\n    }\n    run(accessor, editor) {\n        const linkDetector = LinkDetector.get(editor);\n        if (!linkDetector) {\n            return;\n        }\n        if (!editor.hasModel()) {\n            return;\n        }\n        const selections = editor.getSelections();\n        for (const sel of selections) {\n            const link = linkDetector.getLinkOccurrence(sel.getEndPosition());\n            if (link) {\n                linkDetector.openLinkOccurrence(link, false);\n            }\n        }\n    }\n}\nregisterEditorContribution(LinkDetector.ID, LinkDetector, 1 /* EditorContributionInstantiation.AfterFirstRender */);\nregisterEditorAction(OpenLinkAction);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}