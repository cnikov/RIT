{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nimport { $ } from '../../../../base/browser/dom.js';\nimport { ArrayQueue } from '../../../../base/common/arrays.js';\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Disposable, DisposableStore, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { autorun, autorunWithStore, derived, observableFromEvent, observableValue } from '../../../../base/common/observable.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { assertIsDefined } from '../../../../base/common/types.js';\nimport { applyFontInfo } from '../../config/domFontInfo.js';\nimport { StableEditorScrollState } from '../../stableEditorScroll.js';\nimport { diffDeleteDecoration, diffRemoveIcon } from './decorations.js';\nimport { DiffMapping } from './diffEditorViewModel.js';\nimport { InlineDiffDeletedCodeMargin } from './inlineDiffDeletedCodeMargin.js';\nimport { LineSource, RenderOptions, renderLines } from './renderLines.js';\nimport { animatedObservable, joinCombine } from './utils.js';\nimport { LineRange } from '../../../common/core/lineRange.js';\nimport { Position } from '../../../common/core/position.js';\nimport { InlineDecoration } from '../../../common/viewModel.js';\nimport { IClipboardService } from '../../../../platform/clipboard/common/clipboardService.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\n/**\n * Ensures both editors have the same height by aligning unchanged lines.\n * In inline view mode, inserts viewzones to show deleted code from the original text model in the modified code editor.\n * Synchronizes scrolling.\n */\nlet ViewZoneManager = class ViewZoneManager extends Disposable {\n  constructor(_editors, _diffModel, _options, _diffEditorWidget, _canIgnoreViewZoneUpdateEvent, _clipboardService, _contextMenuService) {\n    super();\n    this._editors = _editors;\n    this._diffModel = _diffModel;\n    this._options = _options;\n    this._diffEditorWidget = _diffEditorWidget;\n    this._canIgnoreViewZoneUpdateEvent = _canIgnoreViewZoneUpdateEvent;\n    this._clipboardService = _clipboardService;\n    this._contextMenuService = _contextMenuService;\n    this._originalTopPadding = observableValue(this, 0);\n    this._originalScrollOffset = observableValue(this, 0);\n    this._originalScrollOffsetAnimated = animatedObservable(this._originalScrollOffset, this._store);\n    this._modifiedTopPadding = observableValue(this, 0);\n    this._modifiedScrollOffset = observableValue(this, 0);\n    this._modifiedScrollOffsetAnimated = animatedObservable(this._modifiedScrollOffset, this._store);\n    let isChangingViewZones = false;\n    const state = observableValue('state', 0);\n    const updateImmediately = this._register(new RunOnceScheduler(() => {\n      state.set(state.get() + 1, undefined);\n    }, 0));\n    this._register(this._editors.original.onDidChangeViewZones(_args => {\n      if (!isChangingViewZones && !this._canIgnoreViewZoneUpdateEvent()) {\n        updateImmediately.schedule();\n      }\n    }));\n    this._register(this._editors.modified.onDidChangeViewZones(_args => {\n      if (!isChangingViewZones && !this._canIgnoreViewZoneUpdateEvent()) {\n        updateImmediately.schedule();\n      }\n    }));\n    this._register(this._editors.original.onDidChangeConfiguration(args => {\n      if (args.hasChanged(144 /* EditorOption.wrappingInfo */) || args.hasChanged(66 /* EditorOption.lineHeight */)) {\n        updateImmediately.schedule();\n      }\n    }));\n    this._register(this._editors.modified.onDidChangeConfiguration(args => {\n      if (args.hasChanged(144 /* EditorOption.wrappingInfo */) || args.hasChanged(66 /* EditorOption.lineHeight */)) {\n        updateImmediately.schedule();\n      }\n    }));\n    const originalModelTokenizationCompleted = this._diffModel.map(m => m ? observableFromEvent(m.model.original.onDidChangeTokens, () => m.model.original.tokenization.backgroundTokenizationState === 2 /* BackgroundTokenizationState.Completed */) : undefined).map((m, reader) => m === null || m === void 0 ? void 0 : m.read(reader));\n    const alignmentViewZoneIdsOrig = new Set();\n    const alignmentViewZoneIdsMod = new Set();\n    const alignments = derived(reader => {\n      /** @description alignments */\n      const diffModel = this._diffModel.read(reader);\n      const diff = diffModel === null || diffModel === void 0 ? void 0 : diffModel.diff.read(reader);\n      if (!diffModel || !diff) {\n        return null;\n      }\n      state.read(reader);\n      const renderSideBySide = this._options.renderSideBySide.read(reader);\n      const innerHunkAlignment = renderSideBySide;\n      return computeRangeAlignment(this._editors.original, this._editors.modified, diff.mappings, alignmentViewZoneIdsOrig, alignmentViewZoneIdsMod, innerHunkAlignment);\n    });\n    const alignmentsSyncedMovedText = derived(reader => {\n      var _a;\n      /** @description alignments */\n      const syncedMovedText = (_a = this._diffModel.read(reader)) === null || _a === void 0 ? void 0 : _a.movedTextToCompare.read(reader);\n      if (!syncedMovedText) {\n        return null;\n      }\n      state.read(reader);\n      const mappings = syncedMovedText.changes.map(c => new DiffMapping(c));\n      // TODO dont include alignments outside syncedMovedText\n      return computeRangeAlignment(this._editors.original, this._editors.modified, mappings, alignmentViewZoneIdsOrig, alignmentViewZoneIdsMod, true);\n    });\n    function createFakeLinesDiv() {\n      const r = document.createElement('div');\n      r.className = 'diagonal-fill';\n      return r;\n    }\n    const alignmentViewZonesDisposables = this._register(new DisposableStore());\n    const alignmentViewZones = derived(reader => {\n      var _a, _b, _c, _d, _e, _f, _g, _h;\n      /** @description alignment viewzones */\n      alignmentViewZonesDisposables.clear();\n      const alignmentsVal = alignments.read(reader) || [];\n      const origViewZones = [];\n      const modViewZones = [];\n      const modifiedTopPaddingVal = this._modifiedTopPadding.read(reader);\n      if (modifiedTopPaddingVal > 0) {\n        modViewZones.push({\n          afterLineNumber: 0,\n          domNode: document.createElement('div'),\n          heightInPx: modifiedTopPaddingVal,\n          showInHiddenAreas: true,\n          suppressMouseDown: true\n        });\n      }\n      const originalTopPaddingVal = this._originalTopPadding.read(reader);\n      if (originalTopPaddingVal > 0) {\n        origViewZones.push({\n          afterLineNumber: 0,\n          domNode: document.createElement('div'),\n          heightInPx: originalTopPaddingVal,\n          showInHiddenAreas: true,\n          suppressMouseDown: true\n        });\n      }\n      const renderSideBySide = this._options.renderSideBySide.read(reader);\n      const deletedCodeLineBreaksComputer = !renderSideBySide ? (_a = this._editors.modified._getViewModel()) === null || _a === void 0 ? void 0 : _a.createLineBreaksComputer() : undefined;\n      if (deletedCodeLineBreaksComputer) {\n        for (const a of alignmentsVal) {\n          if (a.diff) {\n            for (let i = a.originalRange.startLineNumber; i < a.originalRange.endLineNumberExclusive; i++) {\n              deletedCodeLineBreaksComputer === null || deletedCodeLineBreaksComputer === void 0 ? void 0 : deletedCodeLineBreaksComputer.addRequest(this._editors.original.getModel().getLineContent(i), null, null);\n            }\n          }\n        }\n      }\n      const lineBreakData = (_b = deletedCodeLineBreaksComputer === null || deletedCodeLineBreaksComputer === void 0 ? void 0 : deletedCodeLineBreaksComputer.finalize()) !== null && _b !== void 0 ? _b : [];\n      let lineBreakDataIdx = 0;\n      const modLineHeight = this._editors.modified.getOption(66 /* EditorOption.lineHeight */);\n      const syncedMovedText = (_c = this._diffModel.read(reader)) === null || _c === void 0 ? void 0 : _c.movedTextToCompare.read(reader);\n      const mightContainNonBasicASCII = (_e = (_d = this._editors.original.getModel()) === null || _d === void 0 ? void 0 : _d.mightContainNonBasicASCII()) !== null && _e !== void 0 ? _e : false;\n      const mightContainRTL = (_g = (_f = this._editors.original.getModel()) === null || _f === void 0 ? void 0 : _f.mightContainRTL()) !== null && _g !== void 0 ? _g : false;\n      const renderOptions = RenderOptions.fromEditor(this._editors.modified);\n      for (const a of alignmentsVal) {\n        if (a.diff && !renderSideBySide) {\n          if (!a.originalRange.isEmpty) {\n            originalModelTokenizationCompleted.read(reader); // Update view-zones once tokenization completes\n            const deletedCodeDomNode = document.createElement('div');\n            deletedCodeDomNode.classList.add('view-lines', 'line-delete', 'monaco-mouse-cursor-text');\n            const source = new LineSource(a.originalRange.mapToLineArray(l => this._editors.original.getModel().tokenization.getLineTokens(l)), a.originalRange.mapToLineArray(_ => lineBreakData[lineBreakDataIdx++]), mightContainNonBasicASCII, mightContainRTL);\n            const decorations = [];\n            for (const i of a.diff.innerChanges || []) {\n              decorations.push(new InlineDecoration(i.originalRange.delta(-(a.diff.original.startLineNumber - 1)), diffDeleteDecoration.className, 0 /* InlineDecorationType.Regular */));\n            }\n\n            const result = renderLines(source, renderOptions, decorations, deletedCodeDomNode);\n            const marginDomNode = document.createElement('div');\n            marginDomNode.className = 'inline-deleted-margin-view-zone';\n            applyFontInfo(marginDomNode, renderOptions.fontInfo);\n            if (this._options.renderIndicators.read(reader)) {\n              for (let i = 0; i < result.heightInLines; i++) {\n                const marginElement = document.createElement('div');\n                marginElement.className = `delete-sign ${ThemeIcon.asClassName(diffRemoveIcon)}`;\n                marginElement.setAttribute('style', `position:absolute;top:${i * modLineHeight}px;width:${renderOptions.lineDecorationsWidth}px;height:${modLineHeight}px;right:0;`);\n                marginDomNode.appendChild(marginElement);\n              }\n            }\n            let zoneId = undefined;\n            alignmentViewZonesDisposables.add(new InlineDiffDeletedCodeMargin(() => assertIsDefined(zoneId), marginDomNode, this._editors.modified, a.diff, this._diffEditorWidget, result.viewLineCounts, this._editors.original.getModel(), this._contextMenuService, this._clipboardService));\n            for (let i = 0; i < result.viewLineCounts.length; i++) {\n              const count = result.viewLineCounts[i];\n              // Account for wrapped lines in the (collapsed) original editor (which doesn't wrap lines).\n              if (count > 1) {\n                origViewZones.push({\n                  afterLineNumber: a.originalRange.startLineNumber + i,\n                  domNode: createFakeLinesDiv(),\n                  heightInPx: (count - 1) * modLineHeight,\n                  showInHiddenAreas: true,\n                  suppressMouseDown: true\n                });\n              }\n            }\n            modViewZones.push({\n              afterLineNumber: a.modifiedRange.startLineNumber - 1,\n              domNode: deletedCodeDomNode,\n              heightInPx: result.heightInLines * modLineHeight,\n              minWidthInPx: result.minWidthInPx,\n              marginDomNode,\n              setZoneId(id) {\n                zoneId = id;\n              },\n              showInHiddenAreas: true,\n              suppressMouseDown: true\n            });\n          }\n          const marginDomNode = document.createElement('div');\n          marginDomNode.className = 'gutter-delete';\n          origViewZones.push({\n            afterLineNumber: a.originalRange.endLineNumberExclusive - 1,\n            domNode: createFakeLinesDiv(),\n            heightInPx: a.modifiedHeightInPx,\n            marginDomNode,\n            showInHiddenAreas: true,\n            suppressMouseDown: true\n          });\n        } else {\n          const delta = a.modifiedHeightInPx - a.originalHeightInPx;\n          if (delta > 0) {\n            if (syncedMovedText === null || syncedMovedText === void 0 ? void 0 : syncedMovedText.lineRangeMapping.original.delta(-1).deltaLength(2).contains(a.originalRange.endLineNumberExclusive - 1)) {\n              continue;\n            }\n            origViewZones.push({\n              afterLineNumber: a.originalRange.endLineNumberExclusive - 1,\n              domNode: createFakeLinesDiv(),\n              heightInPx: delta,\n              showInHiddenAreas: true,\n              suppressMouseDown: true\n            });\n          } else {\n            if (syncedMovedText === null || syncedMovedText === void 0 ? void 0 : syncedMovedText.lineRangeMapping.modified.delta(-1).deltaLength(2).contains(a.modifiedRange.endLineNumberExclusive - 1)) {\n              continue;\n            }\n            function createViewZoneMarginArrow() {\n              const arrow = document.createElement('div');\n              arrow.className = 'arrow-revert-change ' + ThemeIcon.asClassName(Codicon.arrowRight);\n              return $('div', {}, arrow);\n            }\n            let marginDomNode = undefined;\n            if (a.diff && a.diff.modified.isEmpty && this._options.shouldRenderRevertArrows.read(reader)) {\n              marginDomNode = createViewZoneMarginArrow();\n            }\n            modViewZones.push({\n              afterLineNumber: a.modifiedRange.endLineNumberExclusive - 1,\n              domNode: createFakeLinesDiv(),\n              heightInPx: -delta,\n              marginDomNode,\n              showInHiddenAreas: true,\n              suppressMouseDown: true\n            });\n          }\n        }\n      }\n      for (const a of (_h = alignmentsSyncedMovedText.read(reader)) !== null && _h !== void 0 ? _h : []) {\n        if (!(syncedMovedText === null || syncedMovedText === void 0 ? void 0 : syncedMovedText.lineRangeMapping.original.intersect(a.originalRange)) || !(syncedMovedText === null || syncedMovedText === void 0 ? void 0 : syncedMovedText.lineRangeMapping.modified.intersect(a.modifiedRange))) {\n          // ignore unrelated alignments outside the synced moved text\n          continue;\n        }\n        const delta = a.modifiedHeightInPx - a.originalHeightInPx;\n        if (delta > 0) {\n          origViewZones.push({\n            afterLineNumber: a.originalRange.endLineNumberExclusive - 1,\n            domNode: createFakeLinesDiv(),\n            heightInPx: delta,\n            showInHiddenAreas: true,\n            suppressMouseDown: true\n          });\n        } else {\n          modViewZones.push({\n            afterLineNumber: a.modifiedRange.endLineNumberExclusive - 1,\n            domNode: createFakeLinesDiv(),\n            heightInPx: -delta,\n            showInHiddenAreas: true,\n            suppressMouseDown: true\n          });\n        }\n      }\n      return {\n        orig: origViewZones,\n        mod: modViewZones\n      };\n    });\n    this._register(autorunWithStore(reader => {\n      /** @description alignment viewzones */\n      const scrollState = StableEditorScrollState.capture(this._editors.modified);\n      const alignmentViewZones_ = alignmentViewZones.read(reader);\n      isChangingViewZones = true;\n      this._editors.original.changeViewZones(aOrig => {\n        for (const id of alignmentViewZoneIdsOrig) {\n          aOrig.removeZone(id);\n        }\n        alignmentViewZoneIdsOrig.clear();\n        for (const z of alignmentViewZones_.orig) {\n          const id = aOrig.addZone(z);\n          if (z.setZoneId) {\n            z.setZoneId(id);\n          }\n          alignmentViewZoneIdsOrig.add(id);\n        }\n      });\n      this._editors.modified.changeViewZones(aMod => {\n        for (const id of alignmentViewZoneIdsMod) {\n          aMod.removeZone(id);\n        }\n        alignmentViewZoneIdsMod.clear();\n        for (const z of alignmentViewZones_.mod) {\n          const id = aMod.addZone(z);\n          if (z.setZoneId) {\n            z.setZoneId(id);\n          }\n          alignmentViewZoneIdsMod.add(id);\n        }\n      });\n      isChangingViewZones = false;\n      scrollState.restore(this._editors.modified);\n    }));\n    this._register(toDisposable(() => {\n      this._editors.original.changeViewZones(a => {\n        for (const id of alignmentViewZoneIdsOrig) {\n          a.removeZone(id);\n        }\n        alignmentViewZoneIdsOrig.clear();\n      });\n      this._editors.modified.changeViewZones(a => {\n        for (const id of alignmentViewZoneIdsMod) {\n          a.removeZone(id);\n        }\n        alignmentViewZoneIdsMod.clear();\n      });\n    }));\n    let ignoreChange = false;\n    this._register(this._editors.original.onDidScrollChange(e => {\n      if (e.scrollLeftChanged && !ignoreChange) {\n        ignoreChange = true;\n        this._editors.modified.setScrollLeft(e.scrollLeft);\n        ignoreChange = false;\n      }\n    }));\n    this._register(this._editors.modified.onDidScrollChange(e => {\n      if (e.scrollLeftChanged && !ignoreChange) {\n        ignoreChange = true;\n        this._editors.original.setScrollLeft(e.scrollLeft);\n        ignoreChange = false;\n      }\n    }));\n    this._originalScrollTop = observableFromEvent(this._editors.original.onDidScrollChange, () => this._editors.original.getScrollTop());\n    this._modifiedScrollTop = observableFromEvent(this._editors.modified.onDidScrollChange, () => this._editors.modified.getScrollTop());\n    // origExtraHeight + origOffset - origScrollTop = modExtraHeight + modOffset - modScrollTop\n    // origScrollTop = origExtraHeight + origOffset - modExtraHeight - modOffset + modScrollTop\n    // modScrollTop = modExtraHeight + modOffset - origExtraHeight - origOffset + origScrollTop\n    // origOffset - modOffset = heightOfLines(1..Y) - heightOfLines(1..X)\n    // origScrollTop >= 0, modScrollTop >= 0\n    this._register(autorun(reader => {\n      /** @description update scroll modified */\n      const newScrollTopModified = this._originalScrollTop.read(reader) - (this._originalScrollOffsetAnimated.get() - this._modifiedScrollOffsetAnimated.read(reader)) - (this._originalTopPadding.get() - this._modifiedTopPadding.read(reader));\n      if (newScrollTopModified !== this._editors.modified.getScrollTop()) {\n        this._editors.modified.setScrollTop(newScrollTopModified, 1 /* ScrollType.Immediate */);\n      }\n    }));\n\n    this._register(autorun(reader => {\n      /** @description update scroll original */\n      const newScrollTopOriginal = this._modifiedScrollTop.read(reader) - (this._modifiedScrollOffsetAnimated.get() - this._originalScrollOffsetAnimated.read(reader)) - (this._modifiedTopPadding.get() - this._originalTopPadding.read(reader));\n      if (newScrollTopOriginal !== this._editors.original.getScrollTop()) {\n        this._editors.original.setScrollTop(newScrollTopOriginal, 1 /* ScrollType.Immediate */);\n      }\n    }));\n\n    this._register(autorun(reader => {\n      var _a;\n      /** @description update editor top offsets */\n      const m = (_a = this._diffModel.read(reader)) === null || _a === void 0 ? void 0 : _a.movedTextToCompare.read(reader);\n      let deltaOrigToMod = 0;\n      if (m) {\n        const trueTopOriginal = this._editors.original.getTopForLineNumber(m.lineRangeMapping.original.startLineNumber, true) - this._originalTopPadding.get();\n        const trueTopModified = this._editors.modified.getTopForLineNumber(m.lineRangeMapping.modified.startLineNumber, true) - this._modifiedTopPadding.get();\n        deltaOrigToMod = trueTopModified - trueTopOriginal;\n      }\n      if (deltaOrigToMod > 0) {\n        this._modifiedTopPadding.set(0, undefined);\n        this._originalTopPadding.set(deltaOrigToMod, undefined);\n      } else if (deltaOrigToMod < 0) {\n        this._modifiedTopPadding.set(-deltaOrigToMod, undefined);\n        this._originalTopPadding.set(0, undefined);\n      } else {\n        setTimeout(() => {\n          this._modifiedTopPadding.set(0, undefined);\n          this._originalTopPadding.set(0, undefined);\n        }, 400);\n      }\n      if (this._editors.modified.hasTextFocus()) {\n        this._originalScrollOffset.set(this._modifiedScrollOffset.get() - deltaOrigToMod, undefined, true);\n      } else {\n        this._modifiedScrollOffset.set(this._originalScrollOffset.get() + deltaOrigToMod, undefined, true);\n      }\n    }));\n  }\n};\nViewZoneManager = __decorate([__param(5, IClipboardService), __param(6, IContextMenuService)], ViewZoneManager);\nexport { ViewZoneManager };\nfunction computeRangeAlignment(originalEditor, modifiedEditor, diffs, originalEditorAlignmentViewZones, modifiedEditorAlignmentViewZones, innerHunkAlignment) {\n  const originalLineHeightOverrides = new ArrayQueue(getAdditionalLineHeights(originalEditor, originalEditorAlignmentViewZones));\n  const modifiedLineHeightOverrides = new ArrayQueue(getAdditionalLineHeights(modifiedEditor, modifiedEditorAlignmentViewZones));\n  const origLineHeight = originalEditor.getOption(66 /* EditorOption.lineHeight */);\n  const modLineHeight = modifiedEditor.getOption(66 /* EditorOption.lineHeight */);\n  const result = [];\n  let lastOriginalLineNumber = 0;\n  let lastModifiedLineNumber = 0;\n  function handleAlignmentsOutsideOfDiffs(untilOriginalLineNumberExclusive, untilModifiedLineNumberExclusive) {\n    while (true) {\n      let origNext = originalLineHeightOverrides.peek();\n      let modNext = modifiedLineHeightOverrides.peek();\n      if (origNext && origNext.lineNumber >= untilOriginalLineNumberExclusive) {\n        origNext = undefined;\n      }\n      if (modNext && modNext.lineNumber >= untilModifiedLineNumberExclusive) {\n        modNext = undefined;\n      }\n      if (!origNext && !modNext) {\n        break;\n      }\n      const distOrig = origNext ? origNext.lineNumber - lastOriginalLineNumber : Number.MAX_VALUE;\n      const distNext = modNext ? modNext.lineNumber - lastModifiedLineNumber : Number.MAX_VALUE;\n      if (distOrig < distNext) {\n        originalLineHeightOverrides.dequeue();\n        modNext = {\n          lineNumber: origNext.lineNumber - lastOriginalLineNumber + lastModifiedLineNumber,\n          heightInPx: 0\n        };\n      } else if (distOrig > distNext) {\n        modifiedLineHeightOverrides.dequeue();\n        origNext = {\n          lineNumber: modNext.lineNumber - lastModifiedLineNumber + lastOriginalLineNumber,\n          heightInPx: 0\n        };\n      } else {\n        originalLineHeightOverrides.dequeue();\n        modifiedLineHeightOverrides.dequeue();\n      }\n      result.push({\n        originalRange: LineRange.ofLength(origNext.lineNumber, 1),\n        modifiedRange: LineRange.ofLength(modNext.lineNumber, 1),\n        originalHeightInPx: origLineHeight + origNext.heightInPx,\n        modifiedHeightInPx: modLineHeight + modNext.heightInPx,\n        diff: undefined\n      });\n    }\n  }\n  for (const m of diffs) {\n    const c = m.lineRangeMapping;\n    handleAlignmentsOutsideOfDiffs(c.original.startLineNumber, c.modified.startLineNumber);\n    let first = true;\n    let lastModLineNumber = c.modified.startLineNumber;\n    let lastOrigLineNumber = c.original.startLineNumber;\n    function emitAlignment(origLineNumberExclusive, modLineNumberExclusive) {\n      var _a, _b, _c, _d;\n      if (origLineNumberExclusive < lastOrigLineNumber || modLineNumberExclusive < lastModLineNumber) {\n        return;\n      }\n      if (first) {\n        first = false;\n      } else if (origLineNumberExclusive === lastOrigLineNumber || modLineNumberExclusive === lastModLineNumber) {\n        return;\n      }\n      const originalRange = new LineRange(lastOrigLineNumber, origLineNumberExclusive);\n      const modifiedRange = new LineRange(lastModLineNumber, modLineNumberExclusive);\n      if (originalRange.isEmpty && modifiedRange.isEmpty) {\n        return;\n      }\n      const originalAdditionalHeight = (_b = (_a = originalLineHeightOverrides.takeWhile(v => v.lineNumber < origLineNumberExclusive)) === null || _a === void 0 ? void 0 : _a.reduce((p, c) => p + c.heightInPx, 0)) !== null && _b !== void 0 ? _b : 0;\n      const modifiedAdditionalHeight = (_d = (_c = modifiedLineHeightOverrides.takeWhile(v => v.lineNumber < modLineNumberExclusive)) === null || _c === void 0 ? void 0 : _c.reduce((p, c) => p + c.heightInPx, 0)) !== null && _d !== void 0 ? _d : 0;\n      result.push({\n        originalRange,\n        modifiedRange,\n        originalHeightInPx: originalRange.length * origLineHeight + originalAdditionalHeight,\n        modifiedHeightInPx: modifiedRange.length * modLineHeight + modifiedAdditionalHeight,\n        diff: m.lineRangeMapping\n      });\n      lastOrigLineNumber = origLineNumberExclusive;\n      lastModLineNumber = modLineNumberExclusive;\n    }\n    if (innerHunkAlignment) {\n      for (const i of c.innerChanges || []) {\n        if (i.originalRange.startColumn > 1 && i.modifiedRange.startColumn > 1) {\n          // There is some unmodified text on this line before the diff\n          emitAlignment(i.originalRange.startLineNumber, i.modifiedRange.startLineNumber);\n        }\n        if (i.originalRange.endColumn < originalEditor.getModel().getLineMaxColumn(i.originalRange.endLineNumber)) {\n          // // There is some unmodified text on this line after the diff\n          emitAlignment(i.originalRange.endLineNumber, i.modifiedRange.endLineNumber);\n        }\n      }\n    }\n    emitAlignment(c.original.endLineNumberExclusive, c.modified.endLineNumberExclusive);\n    lastOriginalLineNumber = c.original.endLineNumberExclusive;\n    lastModifiedLineNumber = c.modified.endLineNumberExclusive;\n  }\n  handleAlignmentsOutsideOfDiffs(Number.MAX_VALUE, Number.MAX_VALUE);\n  return result;\n}\nfunction getAdditionalLineHeights(editor, viewZonesToIgnore) {\n  const viewZoneHeights = [];\n  const wrappingZoneHeights = [];\n  const hasWrapping = editor.getOption(144 /* EditorOption.wrappingInfo */).wrappingColumn !== -1;\n  const coordinatesConverter = editor._getViewModel().coordinatesConverter;\n  const editorLineHeight = editor.getOption(66 /* EditorOption.lineHeight */);\n  if (hasWrapping) {\n    for (let i = 1; i <= editor.getModel().getLineCount(); i++) {\n      const lineCount = coordinatesConverter.getModelLineViewLineCount(i);\n      if (lineCount > 1) {\n        wrappingZoneHeights.push({\n          lineNumber: i,\n          heightInPx: editorLineHeight * (lineCount - 1)\n        });\n      }\n    }\n  }\n  for (const w of editor.getWhitespaces()) {\n    if (viewZonesToIgnore.has(w.id)) {\n      continue;\n    }\n    const modelLineNumber = w.afterLineNumber === 0 ? 0 : coordinatesConverter.convertViewPositionToModelPosition(new Position(w.afterLineNumber, 1)).lineNumber;\n    viewZoneHeights.push({\n      lineNumber: modelLineNumber,\n      heightInPx: w.height\n    });\n  }\n  const result = joinCombine(viewZoneHeights, wrappingZoneHeights, v => v.lineNumber, (v1, v2) => ({\n    lineNumber: v1.lineNumber,\n    heightInPx: v1.heightInPx + v2.heightInPx\n  }));\n  return result;\n}","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","$","ArrayQueue","RunOnceScheduler","Codicon","Disposable","DisposableStore","toDisposable","autorun","autorunWithStore","derived","observableFromEvent","observableValue","ThemeIcon","assertIsDefined","applyFontInfo","StableEditorScrollState","diffDeleteDecoration","diffRemoveIcon","DiffMapping","InlineDiffDeletedCodeMargin","LineSource","RenderOptions","renderLines","animatedObservable","joinCombine","LineRange","Position","InlineDecoration","IClipboardService","IContextMenuService","ViewZoneManager","constructor","_editors","_diffModel","_options","_diffEditorWidget","_canIgnoreViewZoneUpdateEvent","_clipboardService","_contextMenuService","_originalTopPadding","_originalScrollOffset","_originalScrollOffsetAnimated","_store","_modifiedTopPadding","_modifiedScrollOffset","_modifiedScrollOffsetAnimated","isChangingViewZones","state","updateImmediately","_register","set","get","undefined","original","onDidChangeViewZones","_args","schedule","modified","onDidChangeConfiguration","args","hasChanged","originalModelTokenizationCompleted","map","m","model","onDidChangeTokens","tokenization","backgroundTokenizationState","reader","read","alignmentViewZoneIdsOrig","Set","alignmentViewZoneIdsMod","alignments","diffModel","diff","renderSideBySide","innerHunkAlignment","computeRangeAlignment","mappings","alignmentsSyncedMovedText","_a","syncedMovedText","movedTextToCompare","changes","createFakeLinesDiv","document","createElement","className","alignmentViewZonesDisposables","alignmentViewZones","_b","_c","_d","_e","_f","_g","_h","clear","alignmentsVal","origViewZones","modViewZones","modifiedTopPaddingVal","push","afterLineNumber","domNode","heightInPx","showInHiddenAreas","suppressMouseDown","originalTopPaddingVal","deletedCodeLineBreaksComputer","_getViewModel","createLineBreaksComputer","a","originalRange","startLineNumber","endLineNumberExclusive","addRequest","getModel","getLineContent","lineBreakData","finalize","lineBreakDataIdx","modLineHeight","getOption","mightContainNonBasicASCII","mightContainRTL","renderOptions","fromEditor","isEmpty","deletedCodeDomNode","classList","add","source","mapToLineArray","l","getLineTokens","_","decorations","innerChanges","delta","result","marginDomNode","fontInfo","renderIndicators","heightInLines","marginElement","asClassName","setAttribute","lineDecorationsWidth","appendChild","zoneId","viewLineCounts","count","modifiedRange","minWidthInPx","setZoneId","id","modifiedHeightInPx","originalHeightInPx","lineRangeMapping","deltaLength","contains","createViewZoneMarginArrow","arrow","arrowRight","shouldRenderRevertArrows","intersect","orig","mod","scrollState","capture","alignmentViewZones_","changeViewZones","aOrig","removeZone","z","addZone","aMod","restore","ignoreChange","onDidScrollChange","e","scrollLeftChanged","setScrollLeft","scrollLeft","_originalScrollTop","getScrollTop","_modifiedScrollTop","newScrollTopModified","setScrollTop","newScrollTopOriginal","deltaOrigToMod","trueTopOriginal","getTopForLineNumber","trueTopModified","setTimeout","hasTextFocus","originalEditor","modifiedEditor","diffs","originalEditorAlignmentViewZones","modifiedEditorAlignmentViewZones","originalLineHeightOverrides","getAdditionalLineHeights","modifiedLineHeightOverrides","origLineHeight","lastOriginalLineNumber","lastModifiedLineNumber","handleAlignmentsOutsideOfDiffs","untilOriginalLineNumberExclusive","untilModifiedLineNumberExclusive","origNext","peek","modNext","lineNumber","distOrig","Number","MAX_VALUE","distNext","dequeue","ofLength","first","lastModLineNumber","lastOrigLineNumber","emitAlignment","origLineNumberExclusive","modLineNumberExclusive","originalAdditionalHeight","takeWhile","v","reduce","p","modifiedAdditionalHeight","startColumn","endColumn","getLineMaxColumn","endLineNumber","editor","viewZonesToIgnore","viewZoneHeights","wrappingZoneHeights","hasWrapping","wrappingColumn","coordinatesConverter","editorLineHeight","getLineCount","lineCount","getModelLineViewLineCount","w","getWhitespaces","has","modelLineNumber","convertViewPositionToModelPosition","height","v1","v2"],"sources":["/home/chlohest/work/website/my_web/node_modules/monaco-editor/esm/vs/editor/browser/widget/diffEditor/lineAlignment.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport { $ } from '../../../../base/browser/dom.js';\nimport { ArrayQueue } from '../../../../base/common/arrays.js';\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Disposable, DisposableStore, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { autorun, autorunWithStore, derived, observableFromEvent, observableValue } from '../../../../base/common/observable.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { assertIsDefined } from '../../../../base/common/types.js';\nimport { applyFontInfo } from '../../config/domFontInfo.js';\nimport { StableEditorScrollState } from '../../stableEditorScroll.js';\nimport { diffDeleteDecoration, diffRemoveIcon } from './decorations.js';\nimport { DiffMapping } from './diffEditorViewModel.js';\nimport { InlineDiffDeletedCodeMargin } from './inlineDiffDeletedCodeMargin.js';\nimport { LineSource, RenderOptions, renderLines } from './renderLines.js';\nimport { animatedObservable, joinCombine } from './utils.js';\nimport { LineRange } from '../../../common/core/lineRange.js';\nimport { Position } from '../../../common/core/position.js';\nimport { InlineDecoration } from '../../../common/viewModel.js';\nimport { IClipboardService } from '../../../../platform/clipboard/common/clipboardService.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\n/**\n * Ensures both editors have the same height by aligning unchanged lines.\n * In inline view mode, inserts viewzones to show deleted code from the original text model in the modified code editor.\n * Synchronizes scrolling.\n */\nlet ViewZoneManager = class ViewZoneManager extends Disposable {\n    constructor(_editors, _diffModel, _options, _diffEditorWidget, _canIgnoreViewZoneUpdateEvent, _clipboardService, _contextMenuService) {\n        super();\n        this._editors = _editors;\n        this._diffModel = _diffModel;\n        this._options = _options;\n        this._diffEditorWidget = _diffEditorWidget;\n        this._canIgnoreViewZoneUpdateEvent = _canIgnoreViewZoneUpdateEvent;\n        this._clipboardService = _clipboardService;\n        this._contextMenuService = _contextMenuService;\n        this._originalTopPadding = observableValue(this, 0);\n        this._originalScrollOffset = observableValue(this, 0);\n        this._originalScrollOffsetAnimated = animatedObservable(this._originalScrollOffset, this._store);\n        this._modifiedTopPadding = observableValue(this, 0);\n        this._modifiedScrollOffset = observableValue(this, 0);\n        this._modifiedScrollOffsetAnimated = animatedObservable(this._modifiedScrollOffset, this._store);\n        let isChangingViewZones = false;\n        const state = observableValue('state', 0);\n        const updateImmediately = this._register(new RunOnceScheduler(() => {\n            state.set(state.get() + 1, undefined);\n        }, 0));\n        this._register(this._editors.original.onDidChangeViewZones((_args) => { if (!isChangingViewZones && !this._canIgnoreViewZoneUpdateEvent()) {\n            updateImmediately.schedule();\n        } }));\n        this._register(this._editors.modified.onDidChangeViewZones((_args) => { if (!isChangingViewZones && !this._canIgnoreViewZoneUpdateEvent()) {\n            updateImmediately.schedule();\n        } }));\n        this._register(this._editors.original.onDidChangeConfiguration((args) => {\n            if (args.hasChanged(144 /* EditorOption.wrappingInfo */) || args.hasChanged(66 /* EditorOption.lineHeight */)) {\n                updateImmediately.schedule();\n            }\n        }));\n        this._register(this._editors.modified.onDidChangeConfiguration((args) => {\n            if (args.hasChanged(144 /* EditorOption.wrappingInfo */) || args.hasChanged(66 /* EditorOption.lineHeight */)) {\n                updateImmediately.schedule();\n            }\n        }));\n        const originalModelTokenizationCompleted = this._diffModel.map(m => m ? observableFromEvent(m.model.original.onDidChangeTokens, () => m.model.original.tokenization.backgroundTokenizationState === 2 /* BackgroundTokenizationState.Completed */) : undefined).map((m, reader) => m === null || m === void 0 ? void 0 : m.read(reader));\n        const alignmentViewZoneIdsOrig = new Set();\n        const alignmentViewZoneIdsMod = new Set();\n        const alignments = derived((reader) => {\n            /** @description alignments */\n            const diffModel = this._diffModel.read(reader);\n            const diff = diffModel === null || diffModel === void 0 ? void 0 : diffModel.diff.read(reader);\n            if (!diffModel || !diff) {\n                return null;\n            }\n            state.read(reader);\n            const renderSideBySide = this._options.renderSideBySide.read(reader);\n            const innerHunkAlignment = renderSideBySide;\n            return computeRangeAlignment(this._editors.original, this._editors.modified, diff.mappings, alignmentViewZoneIdsOrig, alignmentViewZoneIdsMod, innerHunkAlignment);\n        });\n        const alignmentsSyncedMovedText = derived((reader) => {\n            var _a;\n            /** @description alignments */\n            const syncedMovedText = (_a = this._diffModel.read(reader)) === null || _a === void 0 ? void 0 : _a.movedTextToCompare.read(reader);\n            if (!syncedMovedText) {\n                return null;\n            }\n            state.read(reader);\n            const mappings = syncedMovedText.changes.map(c => new DiffMapping(c));\n            // TODO dont include alignments outside syncedMovedText\n            return computeRangeAlignment(this._editors.original, this._editors.modified, mappings, alignmentViewZoneIdsOrig, alignmentViewZoneIdsMod, true);\n        });\n        function createFakeLinesDiv() {\n            const r = document.createElement('div');\n            r.className = 'diagonal-fill';\n            return r;\n        }\n        const alignmentViewZonesDisposables = this._register(new DisposableStore());\n        const alignmentViewZones = derived((reader) => {\n            var _a, _b, _c, _d, _e, _f, _g, _h;\n            /** @description alignment viewzones */\n            alignmentViewZonesDisposables.clear();\n            const alignmentsVal = alignments.read(reader) || [];\n            const origViewZones = [];\n            const modViewZones = [];\n            const modifiedTopPaddingVal = this._modifiedTopPadding.read(reader);\n            if (modifiedTopPaddingVal > 0) {\n                modViewZones.push({\n                    afterLineNumber: 0,\n                    domNode: document.createElement('div'),\n                    heightInPx: modifiedTopPaddingVal,\n                    showInHiddenAreas: true,\n                    suppressMouseDown: true,\n                });\n            }\n            const originalTopPaddingVal = this._originalTopPadding.read(reader);\n            if (originalTopPaddingVal > 0) {\n                origViewZones.push({\n                    afterLineNumber: 0,\n                    domNode: document.createElement('div'),\n                    heightInPx: originalTopPaddingVal,\n                    showInHiddenAreas: true,\n                    suppressMouseDown: true,\n                });\n            }\n            const renderSideBySide = this._options.renderSideBySide.read(reader);\n            const deletedCodeLineBreaksComputer = !renderSideBySide ? (_a = this._editors.modified._getViewModel()) === null || _a === void 0 ? void 0 : _a.createLineBreaksComputer() : undefined;\n            if (deletedCodeLineBreaksComputer) {\n                for (const a of alignmentsVal) {\n                    if (a.diff) {\n                        for (let i = a.originalRange.startLineNumber; i < a.originalRange.endLineNumberExclusive; i++) {\n                            deletedCodeLineBreaksComputer === null || deletedCodeLineBreaksComputer === void 0 ? void 0 : deletedCodeLineBreaksComputer.addRequest(this._editors.original.getModel().getLineContent(i), null, null);\n                        }\n                    }\n                }\n            }\n            const lineBreakData = (_b = deletedCodeLineBreaksComputer === null || deletedCodeLineBreaksComputer === void 0 ? void 0 : deletedCodeLineBreaksComputer.finalize()) !== null && _b !== void 0 ? _b : [];\n            let lineBreakDataIdx = 0;\n            const modLineHeight = this._editors.modified.getOption(66 /* EditorOption.lineHeight */);\n            const syncedMovedText = (_c = this._diffModel.read(reader)) === null || _c === void 0 ? void 0 : _c.movedTextToCompare.read(reader);\n            const mightContainNonBasicASCII = (_e = (_d = this._editors.original.getModel()) === null || _d === void 0 ? void 0 : _d.mightContainNonBasicASCII()) !== null && _e !== void 0 ? _e : false;\n            const mightContainRTL = (_g = (_f = this._editors.original.getModel()) === null || _f === void 0 ? void 0 : _f.mightContainRTL()) !== null && _g !== void 0 ? _g : false;\n            const renderOptions = RenderOptions.fromEditor(this._editors.modified);\n            for (const a of alignmentsVal) {\n                if (a.diff && !renderSideBySide) {\n                    if (!a.originalRange.isEmpty) {\n                        originalModelTokenizationCompleted.read(reader); // Update view-zones once tokenization completes\n                        const deletedCodeDomNode = document.createElement('div');\n                        deletedCodeDomNode.classList.add('view-lines', 'line-delete', 'monaco-mouse-cursor-text');\n                        const source = new LineSource(a.originalRange.mapToLineArray(l => this._editors.original.getModel().tokenization.getLineTokens(l)), a.originalRange.mapToLineArray(_ => lineBreakData[lineBreakDataIdx++]), mightContainNonBasicASCII, mightContainRTL);\n                        const decorations = [];\n                        for (const i of a.diff.innerChanges || []) {\n                            decorations.push(new InlineDecoration(i.originalRange.delta(-(a.diff.original.startLineNumber - 1)), diffDeleteDecoration.className, 0 /* InlineDecorationType.Regular */));\n                        }\n                        const result = renderLines(source, renderOptions, decorations, deletedCodeDomNode);\n                        const marginDomNode = document.createElement('div');\n                        marginDomNode.className = 'inline-deleted-margin-view-zone';\n                        applyFontInfo(marginDomNode, renderOptions.fontInfo);\n                        if (this._options.renderIndicators.read(reader)) {\n                            for (let i = 0; i < result.heightInLines; i++) {\n                                const marginElement = document.createElement('div');\n                                marginElement.className = `delete-sign ${ThemeIcon.asClassName(diffRemoveIcon)}`;\n                                marginElement.setAttribute('style', `position:absolute;top:${i * modLineHeight}px;width:${renderOptions.lineDecorationsWidth}px;height:${modLineHeight}px;right:0;`);\n                                marginDomNode.appendChild(marginElement);\n                            }\n                        }\n                        let zoneId = undefined;\n                        alignmentViewZonesDisposables.add(new InlineDiffDeletedCodeMargin(() => assertIsDefined(zoneId), marginDomNode, this._editors.modified, a.diff, this._diffEditorWidget, result.viewLineCounts, this._editors.original.getModel(), this._contextMenuService, this._clipboardService));\n                        for (let i = 0; i < result.viewLineCounts.length; i++) {\n                            const count = result.viewLineCounts[i];\n                            // Account for wrapped lines in the (collapsed) original editor (which doesn't wrap lines).\n                            if (count > 1) {\n                                origViewZones.push({\n                                    afterLineNumber: a.originalRange.startLineNumber + i,\n                                    domNode: createFakeLinesDiv(),\n                                    heightInPx: (count - 1) * modLineHeight,\n                                    showInHiddenAreas: true,\n                                    suppressMouseDown: true,\n                                });\n                            }\n                        }\n                        modViewZones.push({\n                            afterLineNumber: a.modifiedRange.startLineNumber - 1,\n                            domNode: deletedCodeDomNode,\n                            heightInPx: result.heightInLines * modLineHeight,\n                            minWidthInPx: result.minWidthInPx,\n                            marginDomNode,\n                            setZoneId(id) { zoneId = id; },\n                            showInHiddenAreas: true,\n                            suppressMouseDown: true,\n                        });\n                    }\n                    const marginDomNode = document.createElement('div');\n                    marginDomNode.className = 'gutter-delete';\n                    origViewZones.push({\n                        afterLineNumber: a.originalRange.endLineNumberExclusive - 1,\n                        domNode: createFakeLinesDiv(),\n                        heightInPx: a.modifiedHeightInPx,\n                        marginDomNode,\n                        showInHiddenAreas: true,\n                        suppressMouseDown: true,\n                    });\n                }\n                else {\n                    const delta = a.modifiedHeightInPx - a.originalHeightInPx;\n                    if (delta > 0) {\n                        if (syncedMovedText === null || syncedMovedText === void 0 ? void 0 : syncedMovedText.lineRangeMapping.original.delta(-1).deltaLength(2).contains(a.originalRange.endLineNumberExclusive - 1)) {\n                            continue;\n                        }\n                        origViewZones.push({\n                            afterLineNumber: a.originalRange.endLineNumberExclusive - 1,\n                            domNode: createFakeLinesDiv(),\n                            heightInPx: delta,\n                            showInHiddenAreas: true,\n                            suppressMouseDown: true,\n                        });\n                    }\n                    else {\n                        if (syncedMovedText === null || syncedMovedText === void 0 ? void 0 : syncedMovedText.lineRangeMapping.modified.delta(-1).deltaLength(2).contains(a.modifiedRange.endLineNumberExclusive - 1)) {\n                            continue;\n                        }\n                        function createViewZoneMarginArrow() {\n                            const arrow = document.createElement('div');\n                            arrow.className = 'arrow-revert-change ' + ThemeIcon.asClassName(Codicon.arrowRight);\n                            return $('div', {}, arrow);\n                        }\n                        let marginDomNode = undefined;\n                        if (a.diff && a.diff.modified.isEmpty && this._options.shouldRenderRevertArrows.read(reader)) {\n                            marginDomNode = createViewZoneMarginArrow();\n                        }\n                        modViewZones.push({\n                            afterLineNumber: a.modifiedRange.endLineNumberExclusive - 1,\n                            domNode: createFakeLinesDiv(),\n                            heightInPx: -delta,\n                            marginDomNode,\n                            showInHiddenAreas: true,\n                            suppressMouseDown: true,\n                        });\n                    }\n                }\n            }\n            for (const a of (_h = alignmentsSyncedMovedText.read(reader)) !== null && _h !== void 0 ? _h : []) {\n                if (!(syncedMovedText === null || syncedMovedText === void 0 ? void 0 : syncedMovedText.lineRangeMapping.original.intersect(a.originalRange))\n                    || !(syncedMovedText === null || syncedMovedText === void 0 ? void 0 : syncedMovedText.lineRangeMapping.modified.intersect(a.modifiedRange))) {\n                    // ignore unrelated alignments outside the synced moved text\n                    continue;\n                }\n                const delta = a.modifiedHeightInPx - a.originalHeightInPx;\n                if (delta > 0) {\n                    origViewZones.push({\n                        afterLineNumber: a.originalRange.endLineNumberExclusive - 1,\n                        domNode: createFakeLinesDiv(),\n                        heightInPx: delta,\n                        showInHiddenAreas: true,\n                        suppressMouseDown: true,\n                    });\n                }\n                else {\n                    modViewZones.push({\n                        afterLineNumber: a.modifiedRange.endLineNumberExclusive - 1,\n                        domNode: createFakeLinesDiv(),\n                        heightInPx: -delta,\n                        showInHiddenAreas: true,\n                        suppressMouseDown: true,\n                    });\n                }\n            }\n            return { orig: origViewZones, mod: modViewZones };\n        });\n        this._register(autorunWithStore((reader) => {\n            /** @description alignment viewzones */\n            const scrollState = StableEditorScrollState.capture(this._editors.modified);\n            const alignmentViewZones_ = alignmentViewZones.read(reader);\n            isChangingViewZones = true;\n            this._editors.original.changeViewZones((aOrig) => {\n                for (const id of alignmentViewZoneIdsOrig) {\n                    aOrig.removeZone(id);\n                }\n                alignmentViewZoneIdsOrig.clear();\n                for (const z of alignmentViewZones_.orig) {\n                    const id = aOrig.addZone(z);\n                    if (z.setZoneId) {\n                        z.setZoneId(id);\n                    }\n                    alignmentViewZoneIdsOrig.add(id);\n                }\n            });\n            this._editors.modified.changeViewZones(aMod => {\n                for (const id of alignmentViewZoneIdsMod) {\n                    aMod.removeZone(id);\n                }\n                alignmentViewZoneIdsMod.clear();\n                for (const z of alignmentViewZones_.mod) {\n                    const id = aMod.addZone(z);\n                    if (z.setZoneId) {\n                        z.setZoneId(id);\n                    }\n                    alignmentViewZoneIdsMod.add(id);\n                }\n            });\n            isChangingViewZones = false;\n            scrollState.restore(this._editors.modified);\n        }));\n        this._register(toDisposable(() => {\n            this._editors.original.changeViewZones((a) => {\n                for (const id of alignmentViewZoneIdsOrig) {\n                    a.removeZone(id);\n                }\n                alignmentViewZoneIdsOrig.clear();\n            });\n            this._editors.modified.changeViewZones((a) => {\n                for (const id of alignmentViewZoneIdsMod) {\n                    a.removeZone(id);\n                }\n                alignmentViewZoneIdsMod.clear();\n            });\n        }));\n        let ignoreChange = false;\n        this._register(this._editors.original.onDidScrollChange(e => {\n            if (e.scrollLeftChanged && !ignoreChange) {\n                ignoreChange = true;\n                this._editors.modified.setScrollLeft(e.scrollLeft);\n                ignoreChange = false;\n            }\n        }));\n        this._register(this._editors.modified.onDidScrollChange(e => {\n            if (e.scrollLeftChanged && !ignoreChange) {\n                ignoreChange = true;\n                this._editors.original.setScrollLeft(e.scrollLeft);\n                ignoreChange = false;\n            }\n        }));\n        this._originalScrollTop = observableFromEvent(this._editors.original.onDidScrollChange, () => this._editors.original.getScrollTop());\n        this._modifiedScrollTop = observableFromEvent(this._editors.modified.onDidScrollChange, () => this._editors.modified.getScrollTop());\n        // origExtraHeight + origOffset - origScrollTop = modExtraHeight + modOffset - modScrollTop\n        // origScrollTop = origExtraHeight + origOffset - modExtraHeight - modOffset + modScrollTop\n        // modScrollTop = modExtraHeight + modOffset - origExtraHeight - origOffset + origScrollTop\n        // origOffset - modOffset = heightOfLines(1..Y) - heightOfLines(1..X)\n        // origScrollTop >= 0, modScrollTop >= 0\n        this._register(autorun(reader => {\n            /** @description update scroll modified */\n            const newScrollTopModified = this._originalScrollTop.read(reader)\n                - (this._originalScrollOffsetAnimated.get() - this._modifiedScrollOffsetAnimated.read(reader))\n                - (this._originalTopPadding.get() - this._modifiedTopPadding.read(reader));\n            if (newScrollTopModified !== this._editors.modified.getScrollTop()) {\n                this._editors.modified.setScrollTop(newScrollTopModified, 1 /* ScrollType.Immediate */);\n            }\n        }));\n        this._register(autorun(reader => {\n            /** @description update scroll original */\n            const newScrollTopOriginal = this._modifiedScrollTop.read(reader)\n                - (this._modifiedScrollOffsetAnimated.get() - this._originalScrollOffsetAnimated.read(reader))\n                - (this._modifiedTopPadding.get() - this._originalTopPadding.read(reader));\n            if (newScrollTopOriginal !== this._editors.original.getScrollTop()) {\n                this._editors.original.setScrollTop(newScrollTopOriginal, 1 /* ScrollType.Immediate */);\n            }\n        }));\n        this._register(autorun(reader => {\n            var _a;\n            /** @description update editor top offsets */\n            const m = (_a = this._diffModel.read(reader)) === null || _a === void 0 ? void 0 : _a.movedTextToCompare.read(reader);\n            let deltaOrigToMod = 0;\n            if (m) {\n                const trueTopOriginal = this._editors.original.getTopForLineNumber(m.lineRangeMapping.original.startLineNumber, true) - this._originalTopPadding.get();\n                const trueTopModified = this._editors.modified.getTopForLineNumber(m.lineRangeMapping.modified.startLineNumber, true) - this._modifiedTopPadding.get();\n                deltaOrigToMod = trueTopModified - trueTopOriginal;\n            }\n            if (deltaOrigToMod > 0) {\n                this._modifiedTopPadding.set(0, undefined);\n                this._originalTopPadding.set(deltaOrigToMod, undefined);\n            }\n            else if (deltaOrigToMod < 0) {\n                this._modifiedTopPadding.set(-deltaOrigToMod, undefined);\n                this._originalTopPadding.set(0, undefined);\n            }\n            else {\n                setTimeout(() => {\n                    this._modifiedTopPadding.set(0, undefined);\n                    this._originalTopPadding.set(0, undefined);\n                }, 400);\n            }\n            if (this._editors.modified.hasTextFocus()) {\n                this._originalScrollOffset.set(this._modifiedScrollOffset.get() - deltaOrigToMod, undefined, true);\n            }\n            else {\n                this._modifiedScrollOffset.set(this._originalScrollOffset.get() + deltaOrigToMod, undefined, true);\n            }\n        }));\n    }\n};\nViewZoneManager = __decorate([\n    __param(5, IClipboardService),\n    __param(6, IContextMenuService)\n], ViewZoneManager);\nexport { ViewZoneManager };\nfunction computeRangeAlignment(originalEditor, modifiedEditor, diffs, originalEditorAlignmentViewZones, modifiedEditorAlignmentViewZones, innerHunkAlignment) {\n    const originalLineHeightOverrides = new ArrayQueue(getAdditionalLineHeights(originalEditor, originalEditorAlignmentViewZones));\n    const modifiedLineHeightOverrides = new ArrayQueue(getAdditionalLineHeights(modifiedEditor, modifiedEditorAlignmentViewZones));\n    const origLineHeight = originalEditor.getOption(66 /* EditorOption.lineHeight */);\n    const modLineHeight = modifiedEditor.getOption(66 /* EditorOption.lineHeight */);\n    const result = [];\n    let lastOriginalLineNumber = 0;\n    let lastModifiedLineNumber = 0;\n    function handleAlignmentsOutsideOfDiffs(untilOriginalLineNumberExclusive, untilModifiedLineNumberExclusive) {\n        while (true) {\n            let origNext = originalLineHeightOverrides.peek();\n            let modNext = modifiedLineHeightOverrides.peek();\n            if (origNext && origNext.lineNumber >= untilOriginalLineNumberExclusive) {\n                origNext = undefined;\n            }\n            if (modNext && modNext.lineNumber >= untilModifiedLineNumberExclusive) {\n                modNext = undefined;\n            }\n            if (!origNext && !modNext) {\n                break;\n            }\n            const distOrig = origNext ? origNext.lineNumber - lastOriginalLineNumber : Number.MAX_VALUE;\n            const distNext = modNext ? modNext.lineNumber - lastModifiedLineNumber : Number.MAX_VALUE;\n            if (distOrig < distNext) {\n                originalLineHeightOverrides.dequeue();\n                modNext = {\n                    lineNumber: origNext.lineNumber - lastOriginalLineNumber + lastModifiedLineNumber,\n                    heightInPx: 0,\n                };\n            }\n            else if (distOrig > distNext) {\n                modifiedLineHeightOverrides.dequeue();\n                origNext = {\n                    lineNumber: modNext.lineNumber - lastModifiedLineNumber + lastOriginalLineNumber,\n                    heightInPx: 0,\n                };\n            }\n            else {\n                originalLineHeightOverrides.dequeue();\n                modifiedLineHeightOverrides.dequeue();\n            }\n            result.push({\n                originalRange: LineRange.ofLength(origNext.lineNumber, 1),\n                modifiedRange: LineRange.ofLength(modNext.lineNumber, 1),\n                originalHeightInPx: origLineHeight + origNext.heightInPx,\n                modifiedHeightInPx: modLineHeight + modNext.heightInPx,\n                diff: undefined,\n            });\n        }\n    }\n    for (const m of diffs) {\n        const c = m.lineRangeMapping;\n        handleAlignmentsOutsideOfDiffs(c.original.startLineNumber, c.modified.startLineNumber);\n        let first = true;\n        let lastModLineNumber = c.modified.startLineNumber;\n        let lastOrigLineNumber = c.original.startLineNumber;\n        function emitAlignment(origLineNumberExclusive, modLineNumberExclusive) {\n            var _a, _b, _c, _d;\n            if (origLineNumberExclusive < lastOrigLineNumber || modLineNumberExclusive < lastModLineNumber) {\n                return;\n            }\n            if (first) {\n                first = false;\n            }\n            else if (origLineNumberExclusive === lastOrigLineNumber || modLineNumberExclusive === lastModLineNumber) {\n                return;\n            }\n            const originalRange = new LineRange(lastOrigLineNumber, origLineNumberExclusive);\n            const modifiedRange = new LineRange(lastModLineNumber, modLineNumberExclusive);\n            if (originalRange.isEmpty && modifiedRange.isEmpty) {\n                return;\n            }\n            const originalAdditionalHeight = (_b = (_a = originalLineHeightOverrides\n                .takeWhile(v => v.lineNumber < origLineNumberExclusive)) === null || _a === void 0 ? void 0 : _a.reduce((p, c) => p + c.heightInPx, 0)) !== null && _b !== void 0 ? _b : 0;\n            const modifiedAdditionalHeight = (_d = (_c = modifiedLineHeightOverrides\n                .takeWhile(v => v.lineNumber < modLineNumberExclusive)) === null || _c === void 0 ? void 0 : _c.reduce((p, c) => p + c.heightInPx, 0)) !== null && _d !== void 0 ? _d : 0;\n            result.push({\n                originalRange,\n                modifiedRange,\n                originalHeightInPx: originalRange.length * origLineHeight + originalAdditionalHeight,\n                modifiedHeightInPx: modifiedRange.length * modLineHeight + modifiedAdditionalHeight,\n                diff: m.lineRangeMapping,\n            });\n            lastOrigLineNumber = origLineNumberExclusive;\n            lastModLineNumber = modLineNumberExclusive;\n        }\n        if (innerHunkAlignment) {\n            for (const i of c.innerChanges || []) {\n                if (i.originalRange.startColumn > 1 && i.modifiedRange.startColumn > 1) {\n                    // There is some unmodified text on this line before the diff\n                    emitAlignment(i.originalRange.startLineNumber, i.modifiedRange.startLineNumber);\n                }\n                if (i.originalRange.endColumn < originalEditor.getModel().getLineMaxColumn(i.originalRange.endLineNumber)) {\n                    // // There is some unmodified text on this line after the diff\n                    emitAlignment(i.originalRange.endLineNumber, i.modifiedRange.endLineNumber);\n                }\n            }\n        }\n        emitAlignment(c.original.endLineNumberExclusive, c.modified.endLineNumberExclusive);\n        lastOriginalLineNumber = c.original.endLineNumberExclusive;\n        lastModifiedLineNumber = c.modified.endLineNumberExclusive;\n    }\n    handleAlignmentsOutsideOfDiffs(Number.MAX_VALUE, Number.MAX_VALUE);\n    return result;\n}\nfunction getAdditionalLineHeights(editor, viewZonesToIgnore) {\n    const viewZoneHeights = [];\n    const wrappingZoneHeights = [];\n    const hasWrapping = editor.getOption(144 /* EditorOption.wrappingInfo */).wrappingColumn !== -1;\n    const coordinatesConverter = editor._getViewModel().coordinatesConverter;\n    const editorLineHeight = editor.getOption(66 /* EditorOption.lineHeight */);\n    if (hasWrapping) {\n        for (let i = 1; i <= editor.getModel().getLineCount(); i++) {\n            const lineCount = coordinatesConverter.getModelLineViewLineCount(i);\n            if (lineCount > 1) {\n                wrappingZoneHeights.push({ lineNumber: i, heightInPx: editorLineHeight * (lineCount - 1) });\n            }\n        }\n    }\n    for (const w of editor.getWhitespaces()) {\n        if (viewZonesToIgnore.has(w.id)) {\n            continue;\n        }\n        const modelLineNumber = w.afterLineNumber === 0 ? 0 : coordinatesConverter.convertViewPositionToModelPosition(new Position(w.afterLineNumber, 1)).lineNumber;\n        viewZoneHeights.push({ lineNumber: modelLineNumber, heightInPx: w.height });\n    }\n    const result = joinCombine(viewZoneHeights, wrappingZoneHeights, v => v.lineNumber, (v1, v2) => ({ lineNumber: v1.lineNumber, heightInPx: v1.heightInPx + v2.heightInPx }));\n    return result;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}