{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nimport { IntervalTimer, timeout } from '../../../base/common/async.js';\nimport { Disposable, dispose, toDisposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport { SimpleWorkerClient, logOnceWebWorkerWarning } from '../../../base/common/worker/simpleWorker.js';\nimport { DefaultWorkerFactory } from '../../../base/browser/defaultWorkerFactory.js';\nimport { Range } from '../../common/core/range.js';\nimport { ILanguageConfigurationService } from '../../common/languages/languageConfigurationRegistry.js';\nimport { EditorSimpleWorker } from '../../common/services/editorSimpleWorker.js';\nimport { IModelService } from '../../common/services/model.js';\nimport { ITextResourceConfigurationService } from '../../common/services/textResourceConfiguration.js';\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { StopWatch } from '../../../base/common/stopwatch.js';\nimport { canceled } from '../../../base/common/errors.js';\nimport { ILanguageFeaturesService } from '../../common/services/languageFeatures.js';\nimport { MovedText } from '../../common/diff/linesDiffComputer.js';\nimport { DetailedLineRangeMapping, RangeMapping, LineRangeMapping } from '../../common/diff/rangeMapping.js';\nimport { LineRange } from '../../common/core/lineRange.js';\n/**\n * Stop syncing a model to the worker if it was not needed for 1 min.\n */\nconst STOP_SYNC_MODEL_DELTA_TIME_MS = 60 * 1000;\n/**\n * Stop the worker if it was not needed for 5 min.\n */\nconst STOP_WORKER_DELTA_TIME_MS = 5 * 60 * 1000;\nfunction canSyncModel(modelService, resource) {\n  const model = modelService.getModel(resource);\n  if (!model) {\n    return false;\n  }\n  if (model.isTooLargeForSyncing()) {\n    return false;\n  }\n  return true;\n}\nlet EditorWorkerService = class EditorWorkerService extends Disposable {\n  constructor(modelService, configurationService, logService, languageConfigurationService, languageFeaturesService) {\n    super();\n    this._modelService = modelService;\n    this._workerManager = this._register(new WorkerManager(this._modelService, languageConfigurationService));\n    this._logService = logService;\n    // register default link-provider and default completions-provider\n    this._register(languageFeaturesService.linkProvider.register({\n      language: '*',\n      hasAccessToAllModels: true\n    }, {\n      provideLinks: (model, token) => {\n        if (!canSyncModel(this._modelService, model.uri)) {\n          return Promise.resolve({\n            links: []\n          }); // File too large\n        }\n\n        return this._workerManager.withWorker().then(client => client.computeLinks(model.uri)).then(links => {\n          return links && {\n            links\n          };\n        });\n      }\n    }));\n    this._register(languageFeaturesService.completionProvider.register('*', new WordBasedCompletionItemProvider(this._workerManager, configurationService, this._modelService, languageConfigurationService)));\n  }\n  dispose() {\n    super.dispose();\n  }\n  canComputeUnicodeHighlights(uri) {\n    return canSyncModel(this._modelService, uri);\n  }\n  computedUnicodeHighlights(uri, options, range) {\n    return this._workerManager.withWorker().then(client => client.computedUnicodeHighlights(uri, options, range));\n  }\n  computeDiff(original, modified, options, algorithm) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const result = yield this._workerManager.withWorker().then(client => client.computeDiff(original, modified, options, algorithm));\n      if (!result) {\n        return null;\n      }\n      // Convert from space efficient JSON data to rich objects.\n      const diff = {\n        identical: result.identical,\n        quitEarly: result.quitEarly,\n        changes: toLineRangeMappings(result.changes),\n        moves: result.moves.map(m => new MovedText(new LineRangeMapping(new LineRange(m[0], m[1]), new LineRange(m[2], m[3])), toLineRangeMappings(m[4])))\n      };\n      return diff;\n      function toLineRangeMappings(changes) {\n        return changes.map(c => {\n          var _a;\n          return new DetailedLineRangeMapping(new LineRange(c[0], c[1]), new LineRange(c[2], c[3]), (_a = c[4]) === null || _a === void 0 ? void 0 : _a.map(c => new RangeMapping(new Range(c[0], c[1], c[2], c[3]), new Range(c[4], c[5], c[6], c[7]))));\n        });\n      }\n    });\n  }\n  computeMoreMinimalEdits(resource, edits, pretty = false) {\n    if (isNonEmptyArray(edits)) {\n      if (!canSyncModel(this._modelService, resource)) {\n        return Promise.resolve(edits); // File too large\n      }\n\n      const sw = StopWatch.create();\n      const result = this._workerManager.withWorker().then(client => client.computeMoreMinimalEdits(resource, edits, pretty));\n      result.finally(() => this._logService.trace('FORMAT#computeMoreMinimalEdits', resource.toString(true), sw.elapsed()));\n      return Promise.race([result, timeout(1000).then(() => edits)]);\n    } else {\n      return Promise.resolve(undefined);\n    }\n  }\n  canNavigateValueSet(resource) {\n    return canSyncModel(this._modelService, resource);\n  }\n  navigateValueSet(resource, range, up) {\n    return this._workerManager.withWorker().then(client => client.navigateValueSet(resource, range, up));\n  }\n  canComputeWordRanges(resource) {\n    return canSyncModel(this._modelService, resource);\n  }\n  computeWordRanges(resource, range) {\n    return this._workerManager.withWorker().then(client => client.computeWordRanges(resource, range));\n  }\n};\nEditorWorkerService = __decorate([__param(0, IModelService), __param(1, ITextResourceConfigurationService), __param(2, ILogService), __param(3, ILanguageConfigurationService), __param(4, ILanguageFeaturesService)], EditorWorkerService);\nexport { EditorWorkerService };\nclass WordBasedCompletionItemProvider {\n  constructor(workerManager, configurationService, modelService, languageConfigurationService) {\n    this.languageConfigurationService = languageConfigurationService;\n    this._debugDisplayName = 'wordbasedCompletions';\n    this._workerManager = workerManager;\n    this._configurationService = configurationService;\n    this._modelService = modelService;\n  }\n  provideCompletionItems(model, position) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const config = this._configurationService.getValue(model.uri, position, 'editor');\n      if (!config.wordBasedSuggestions) {\n        return undefined;\n      }\n      const models = [];\n      if (config.wordBasedSuggestionsMode === 'currentDocument') {\n        // only current file and only if not too large\n        if (canSyncModel(this._modelService, model.uri)) {\n          models.push(model.uri);\n        }\n      } else {\n        // either all files or files of same language\n        for (const candidate of this._modelService.getModels()) {\n          if (!canSyncModel(this._modelService, candidate.uri)) {\n            continue;\n          }\n          if (candidate === model) {\n            models.unshift(candidate.uri);\n          } else if (config.wordBasedSuggestionsMode === 'allDocuments' || candidate.getLanguageId() === model.getLanguageId()) {\n            models.push(candidate.uri);\n          }\n        }\n      }\n      if (models.length === 0) {\n        return undefined; // File too large, no other files\n      }\n\n      const wordDefRegExp = this.languageConfigurationService.getLanguageConfiguration(model.getLanguageId()).getWordDefinition();\n      const word = model.getWordAtPosition(position);\n      const replace = !word ? Range.fromPositions(position) : new Range(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn);\n      const insert = replace.setEndPosition(position.lineNumber, position.column);\n      const client = yield this._workerManager.withWorker();\n      const data = yield client.textualSuggest(models, word === null || word === void 0 ? void 0 : word.word, wordDefRegExp);\n      if (!data) {\n        return undefined;\n      }\n      return {\n        duration: data.duration,\n        suggestions: data.words.map(word => {\n          return {\n            kind: 18 /* languages.CompletionItemKind.Text */,\n            label: word,\n            insertText: word,\n            range: {\n              insert,\n              replace\n            }\n          };\n        })\n      };\n    });\n  }\n}\nclass WorkerManager extends Disposable {\n  constructor(modelService, languageConfigurationService) {\n    super();\n    this.languageConfigurationService = languageConfigurationService;\n    this._modelService = modelService;\n    this._editorWorkerClient = null;\n    this._lastWorkerUsedTime = new Date().getTime();\n    const stopWorkerInterval = this._register(new IntervalTimer());\n    stopWorkerInterval.cancelAndSet(() => this._checkStopIdleWorker(), Math.round(STOP_WORKER_DELTA_TIME_MS / 2));\n    this._register(this._modelService.onModelRemoved(_ => this._checkStopEmptyWorker()));\n  }\n  dispose() {\n    if (this._editorWorkerClient) {\n      this._editorWorkerClient.dispose();\n      this._editorWorkerClient = null;\n    }\n    super.dispose();\n  }\n  /**\n   * Check if the model service has no more models and stop the worker if that is the case.\n   */\n  _checkStopEmptyWorker() {\n    if (!this._editorWorkerClient) {\n      return;\n    }\n    const models = this._modelService.getModels();\n    if (models.length === 0) {\n      // There are no more models => nothing possible for me to do\n      this._editorWorkerClient.dispose();\n      this._editorWorkerClient = null;\n    }\n  }\n  /**\n   * Check if the worker has been idle for a while and then stop it.\n   */\n  _checkStopIdleWorker() {\n    if (!this._editorWorkerClient) {\n      return;\n    }\n    const timeSinceLastWorkerUsedTime = new Date().getTime() - this._lastWorkerUsedTime;\n    if (timeSinceLastWorkerUsedTime > STOP_WORKER_DELTA_TIME_MS) {\n      this._editorWorkerClient.dispose();\n      this._editorWorkerClient = null;\n    }\n  }\n  withWorker() {\n    this._lastWorkerUsedTime = new Date().getTime();\n    if (!this._editorWorkerClient) {\n      this._editorWorkerClient = new EditorWorkerClient(this._modelService, false, 'editorWorkerService', this.languageConfigurationService);\n    }\n    return Promise.resolve(this._editorWorkerClient);\n  }\n}\nclass EditorModelManager extends Disposable {\n  constructor(proxy, modelService, keepIdleModels) {\n    super();\n    this._syncedModels = Object.create(null);\n    this._syncedModelsLastUsedTime = Object.create(null);\n    this._proxy = proxy;\n    this._modelService = modelService;\n    if (!keepIdleModels) {\n      const timer = new IntervalTimer();\n      timer.cancelAndSet(() => this._checkStopModelSync(), Math.round(STOP_SYNC_MODEL_DELTA_TIME_MS / 2));\n      this._register(timer);\n    }\n  }\n  dispose() {\n    for (const modelUrl in this._syncedModels) {\n      dispose(this._syncedModels[modelUrl]);\n    }\n    this._syncedModels = Object.create(null);\n    this._syncedModelsLastUsedTime = Object.create(null);\n    super.dispose();\n  }\n  ensureSyncedResources(resources, forceLargeModels) {\n    for (const resource of resources) {\n      const resourceStr = resource.toString();\n      if (!this._syncedModels[resourceStr]) {\n        this._beginModelSync(resource, forceLargeModels);\n      }\n      if (this._syncedModels[resourceStr]) {\n        this._syncedModelsLastUsedTime[resourceStr] = new Date().getTime();\n      }\n    }\n  }\n  _checkStopModelSync() {\n    const currentTime = new Date().getTime();\n    const toRemove = [];\n    for (const modelUrl in this._syncedModelsLastUsedTime) {\n      const elapsedTime = currentTime - this._syncedModelsLastUsedTime[modelUrl];\n      if (elapsedTime > STOP_SYNC_MODEL_DELTA_TIME_MS) {\n        toRemove.push(modelUrl);\n      }\n    }\n    for (const e of toRemove) {\n      this._stopModelSync(e);\n    }\n  }\n  _beginModelSync(resource, forceLargeModels) {\n    const model = this._modelService.getModel(resource);\n    if (!model) {\n      return;\n    }\n    if (!forceLargeModels && model.isTooLargeForSyncing()) {\n      return;\n    }\n    const modelUrl = resource.toString();\n    this._proxy.acceptNewModel({\n      url: model.uri.toString(),\n      lines: model.getLinesContent(),\n      EOL: model.getEOL(),\n      versionId: model.getVersionId()\n    });\n    const toDispose = new DisposableStore();\n    toDispose.add(model.onDidChangeContent(e => {\n      this._proxy.acceptModelChanged(modelUrl.toString(), e);\n    }));\n    toDispose.add(model.onWillDispose(() => {\n      this._stopModelSync(modelUrl);\n    }));\n    toDispose.add(toDisposable(() => {\n      this._proxy.acceptRemovedModel(modelUrl);\n    }));\n    this._syncedModels[modelUrl] = toDispose;\n  }\n  _stopModelSync(modelUrl) {\n    const toDispose = this._syncedModels[modelUrl];\n    delete this._syncedModels[modelUrl];\n    delete this._syncedModelsLastUsedTime[modelUrl];\n    dispose(toDispose);\n  }\n}\nclass SynchronousWorkerClient {\n  constructor(instance) {\n    this._instance = instance;\n    this._proxyObj = Promise.resolve(this._instance);\n  }\n  dispose() {\n    this._instance.dispose();\n  }\n  getProxyObject() {\n    return this._proxyObj;\n  }\n}\nexport class EditorWorkerHost {\n  constructor(workerClient) {\n    this._workerClient = workerClient;\n  }\n  // foreign host request\n  fhr(method, args) {\n    return this._workerClient.fhr(method, args);\n  }\n}\nexport class EditorWorkerClient extends Disposable {\n  constructor(modelService, keepIdleModels, label, languageConfigurationService) {\n    super();\n    this.languageConfigurationService = languageConfigurationService;\n    this._disposed = false;\n    this._modelService = modelService;\n    this._keepIdleModels = keepIdleModels;\n    this._workerFactory = new DefaultWorkerFactory(label);\n    this._worker = null;\n    this._modelManager = null;\n  }\n  // foreign host request\n  fhr(method, args) {\n    throw new Error(`Not implemented!`);\n  }\n  _getOrCreateWorker() {\n    if (!this._worker) {\n      try {\n        this._worker = this._register(new SimpleWorkerClient(this._workerFactory, 'vs/editor/common/services/editorSimpleWorker', new EditorWorkerHost(this)));\n      } catch (err) {\n        logOnceWebWorkerWarning(err);\n        this._worker = new SynchronousWorkerClient(new EditorSimpleWorker(new EditorWorkerHost(this), null));\n      }\n    }\n    return this._worker;\n  }\n  _getProxy() {\n    return this._getOrCreateWorker().getProxyObject().then(undefined, err => {\n      logOnceWebWorkerWarning(err);\n      this._worker = new SynchronousWorkerClient(new EditorSimpleWorker(new EditorWorkerHost(this), null));\n      return this._getOrCreateWorker().getProxyObject();\n    });\n  }\n  _getOrCreateModelManager(proxy) {\n    if (!this._modelManager) {\n      this._modelManager = this._register(new EditorModelManager(proxy, this._modelService, this._keepIdleModels));\n    }\n    return this._modelManager;\n  }\n  _withSyncedResources(resources, forceLargeModels = false) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this._disposed) {\n        return Promise.reject(canceled());\n      }\n      return this._getProxy().then(proxy => {\n        this._getOrCreateModelManager(proxy).ensureSyncedResources(resources, forceLargeModels);\n        return proxy;\n      });\n    });\n  }\n  computedUnicodeHighlights(uri, options, range) {\n    return this._withSyncedResources([uri]).then(proxy => {\n      return proxy.computeUnicodeHighlights(uri.toString(), options, range);\n    });\n  }\n  computeDiff(original, modified, options, algorithm) {\n    return this._withSyncedResources([original, modified], /* forceLargeModels */true).then(proxy => {\n      return proxy.computeDiff(original.toString(), modified.toString(), options, algorithm);\n    });\n  }\n  computeMoreMinimalEdits(resource, edits, pretty) {\n    return this._withSyncedResources([resource]).then(proxy => {\n      return proxy.computeMoreMinimalEdits(resource.toString(), edits, pretty);\n    });\n  }\n  computeLinks(resource) {\n    return this._withSyncedResources([resource]).then(proxy => {\n      return proxy.computeLinks(resource.toString());\n    });\n  }\n  computeDefaultDocumentColors(resource) {\n    return this._withSyncedResources([resource]).then(proxy => {\n      return proxy.computeDefaultDocumentColors(resource.toString());\n    });\n  }\n  textualSuggest(resources, leadingWord, wordDefRegExp) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const proxy = yield this._withSyncedResources(resources);\n      const wordDef = wordDefRegExp.source;\n      const wordDefFlags = wordDefRegExp.flags;\n      return proxy.textualSuggest(resources.map(r => r.toString()), leadingWord, wordDef, wordDefFlags);\n    });\n  }\n  computeWordRanges(resource, range) {\n    return this._withSyncedResources([resource]).then(proxy => {\n      const model = this._modelService.getModel(resource);\n      if (!model) {\n        return Promise.resolve(null);\n      }\n      const wordDefRegExp = this.languageConfigurationService.getLanguageConfiguration(model.getLanguageId()).getWordDefinition();\n      const wordDef = wordDefRegExp.source;\n      const wordDefFlags = wordDefRegExp.flags;\n      return proxy.computeWordRanges(resource.toString(), range, wordDef, wordDefFlags);\n    });\n  }\n  navigateValueSet(resource, range, up) {\n    return this._withSyncedResources([resource]).then(proxy => {\n      const model = this._modelService.getModel(resource);\n      if (!model) {\n        return null;\n      }\n      const wordDefRegExp = this.languageConfigurationService.getLanguageConfiguration(model.getLanguageId()).getWordDefinition();\n      const wordDef = wordDefRegExp.source;\n      const wordDefFlags = wordDefRegExp.flags;\n      return proxy.navigateValueSet(resource.toString(), range, up, wordDef, wordDefFlags);\n    });\n  }\n  dispose() {\n    super.dispose();\n    this._disposed = true;\n  }\n}","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","IntervalTimer","timeout","Disposable","dispose","toDisposable","DisposableStore","SimpleWorkerClient","logOnceWebWorkerWarning","DefaultWorkerFactory","Range","ILanguageConfigurationService","EditorSimpleWorker","IModelService","ITextResourceConfigurationService","isNonEmptyArray","ILogService","StopWatch","canceled","ILanguageFeaturesService","MovedText","DetailedLineRangeMapping","RangeMapping","LineRangeMapping","LineRange","STOP_SYNC_MODEL_DELTA_TIME_MS","STOP_WORKER_DELTA_TIME_MS","canSyncModel","modelService","resource","model","getModel","isTooLargeForSyncing","EditorWorkerService","constructor","configurationService","logService","languageConfigurationService","languageFeaturesService","_modelService","_workerManager","_register","WorkerManager","_logService","linkProvider","register","language","hasAccessToAllModels","provideLinks","token","uri","links","withWorker","client","computeLinks","completionProvider","WordBasedCompletionItemProvider","canComputeUnicodeHighlights","computedUnicodeHighlights","options","range","computeDiff","original","modified","algorithm","diff","identical","quitEarly","changes","toLineRangeMappings","moves","map","m","_a","computeMoreMinimalEdits","edits","pretty","sw","create","finally","trace","toString","elapsed","race","undefined","canNavigateValueSet","navigateValueSet","up","canComputeWordRanges","computeWordRanges","workerManager","_debugDisplayName","_configurationService","provideCompletionItems","position","config","getValue","wordBasedSuggestions","models","wordBasedSuggestionsMode","push","candidate","getModels","unshift","getLanguageId","wordDefRegExp","getLanguageConfiguration","getWordDefinition","word","getWordAtPosition","replace","fromPositions","lineNumber","startColumn","endColumn","insert","setEndPosition","column","data","textualSuggest","duration","suggestions","words","kind","label","insertText","_editorWorkerClient","_lastWorkerUsedTime","Date","getTime","stopWorkerInterval","cancelAndSet","_checkStopIdleWorker","Math","round","onModelRemoved","_","_checkStopEmptyWorker","timeSinceLastWorkerUsedTime","EditorWorkerClient","EditorModelManager","proxy","keepIdleModels","_syncedModels","_syncedModelsLastUsedTime","_proxy","timer","_checkStopModelSync","modelUrl","ensureSyncedResources","resources","forceLargeModels","resourceStr","_beginModelSync","currentTime","toRemove","elapsedTime","_stopModelSync","acceptNewModel","url","lines","getLinesContent","EOL","getEOL","versionId","getVersionId","toDispose","add","onDidChangeContent","acceptModelChanged","onWillDispose","acceptRemovedModel","SynchronousWorkerClient","instance","_instance","_proxyObj","getProxyObject","EditorWorkerHost","workerClient","_workerClient","fhr","method","args","_disposed","_keepIdleModels","_workerFactory","_worker","_modelManager","Error","_getOrCreateWorker","err","_getProxy","_getOrCreateModelManager","_withSyncedResources","computeUnicodeHighlights","computeDefaultDocumentColors","leadingWord","wordDef","source","wordDefFlags","flags"],"sources":["/home/chlohest/work/website/my_web/node_modules/monaco-editor/esm/vs/editor/browser/services/editorWorkerService.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { IntervalTimer, timeout } from '../../../base/common/async.js';\nimport { Disposable, dispose, toDisposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport { SimpleWorkerClient, logOnceWebWorkerWarning } from '../../../base/common/worker/simpleWorker.js';\nimport { DefaultWorkerFactory } from '../../../base/browser/defaultWorkerFactory.js';\nimport { Range } from '../../common/core/range.js';\nimport { ILanguageConfigurationService } from '../../common/languages/languageConfigurationRegistry.js';\nimport { EditorSimpleWorker } from '../../common/services/editorSimpleWorker.js';\nimport { IModelService } from '../../common/services/model.js';\nimport { ITextResourceConfigurationService } from '../../common/services/textResourceConfiguration.js';\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { StopWatch } from '../../../base/common/stopwatch.js';\nimport { canceled } from '../../../base/common/errors.js';\nimport { ILanguageFeaturesService } from '../../common/services/languageFeatures.js';\nimport { MovedText } from '../../common/diff/linesDiffComputer.js';\nimport { DetailedLineRangeMapping, RangeMapping, LineRangeMapping } from '../../common/diff/rangeMapping.js';\nimport { LineRange } from '../../common/core/lineRange.js';\n/**\n * Stop syncing a model to the worker if it was not needed for 1 min.\n */\nconst STOP_SYNC_MODEL_DELTA_TIME_MS = 60 * 1000;\n/**\n * Stop the worker if it was not needed for 5 min.\n */\nconst STOP_WORKER_DELTA_TIME_MS = 5 * 60 * 1000;\nfunction canSyncModel(modelService, resource) {\n    const model = modelService.getModel(resource);\n    if (!model) {\n        return false;\n    }\n    if (model.isTooLargeForSyncing()) {\n        return false;\n    }\n    return true;\n}\nlet EditorWorkerService = class EditorWorkerService extends Disposable {\n    constructor(modelService, configurationService, logService, languageConfigurationService, languageFeaturesService) {\n        super();\n        this._modelService = modelService;\n        this._workerManager = this._register(new WorkerManager(this._modelService, languageConfigurationService));\n        this._logService = logService;\n        // register default link-provider and default completions-provider\n        this._register(languageFeaturesService.linkProvider.register({ language: '*', hasAccessToAllModels: true }, {\n            provideLinks: (model, token) => {\n                if (!canSyncModel(this._modelService, model.uri)) {\n                    return Promise.resolve({ links: [] }); // File too large\n                }\n                return this._workerManager.withWorker().then(client => client.computeLinks(model.uri)).then(links => {\n                    return links && { links };\n                });\n            }\n        }));\n        this._register(languageFeaturesService.completionProvider.register('*', new WordBasedCompletionItemProvider(this._workerManager, configurationService, this._modelService, languageConfigurationService)));\n    }\n    dispose() {\n        super.dispose();\n    }\n    canComputeUnicodeHighlights(uri) {\n        return canSyncModel(this._modelService, uri);\n    }\n    computedUnicodeHighlights(uri, options, range) {\n        return this._workerManager.withWorker().then(client => client.computedUnicodeHighlights(uri, options, range));\n    }\n    computeDiff(original, modified, options, algorithm) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const result = yield this._workerManager.withWorker().then(client => client.computeDiff(original, modified, options, algorithm));\n            if (!result) {\n                return null;\n            }\n            // Convert from space efficient JSON data to rich objects.\n            const diff = {\n                identical: result.identical,\n                quitEarly: result.quitEarly,\n                changes: toLineRangeMappings(result.changes),\n                moves: result.moves.map(m => new MovedText(new LineRangeMapping(new LineRange(m[0], m[1]), new LineRange(m[2], m[3])), toLineRangeMappings(m[4])))\n            };\n            return diff;\n            function toLineRangeMappings(changes) {\n                return changes.map((c) => {\n                    var _a;\n                    return new DetailedLineRangeMapping(new LineRange(c[0], c[1]), new LineRange(c[2], c[3]), (_a = c[4]) === null || _a === void 0 ? void 0 : _a.map((c) => new RangeMapping(new Range(c[0], c[1], c[2], c[3]), new Range(c[4], c[5], c[6], c[7]))));\n                });\n            }\n        });\n    }\n    computeMoreMinimalEdits(resource, edits, pretty = false) {\n        if (isNonEmptyArray(edits)) {\n            if (!canSyncModel(this._modelService, resource)) {\n                return Promise.resolve(edits); // File too large\n            }\n            const sw = StopWatch.create();\n            const result = this._workerManager.withWorker().then(client => client.computeMoreMinimalEdits(resource, edits, pretty));\n            result.finally(() => this._logService.trace('FORMAT#computeMoreMinimalEdits', resource.toString(true), sw.elapsed()));\n            return Promise.race([result, timeout(1000).then(() => edits)]);\n        }\n        else {\n            return Promise.resolve(undefined);\n        }\n    }\n    canNavigateValueSet(resource) {\n        return (canSyncModel(this._modelService, resource));\n    }\n    navigateValueSet(resource, range, up) {\n        return this._workerManager.withWorker().then(client => client.navigateValueSet(resource, range, up));\n    }\n    canComputeWordRanges(resource) {\n        return canSyncModel(this._modelService, resource);\n    }\n    computeWordRanges(resource, range) {\n        return this._workerManager.withWorker().then(client => client.computeWordRanges(resource, range));\n    }\n};\nEditorWorkerService = __decorate([\n    __param(0, IModelService),\n    __param(1, ITextResourceConfigurationService),\n    __param(2, ILogService),\n    __param(3, ILanguageConfigurationService),\n    __param(4, ILanguageFeaturesService)\n], EditorWorkerService);\nexport { EditorWorkerService };\nclass WordBasedCompletionItemProvider {\n    constructor(workerManager, configurationService, modelService, languageConfigurationService) {\n        this.languageConfigurationService = languageConfigurationService;\n        this._debugDisplayName = 'wordbasedCompletions';\n        this._workerManager = workerManager;\n        this._configurationService = configurationService;\n        this._modelService = modelService;\n    }\n    provideCompletionItems(model, position) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const config = this._configurationService.getValue(model.uri, position, 'editor');\n            if (!config.wordBasedSuggestions) {\n                return undefined;\n            }\n            const models = [];\n            if (config.wordBasedSuggestionsMode === 'currentDocument') {\n                // only current file and only if not too large\n                if (canSyncModel(this._modelService, model.uri)) {\n                    models.push(model.uri);\n                }\n            }\n            else {\n                // either all files or files of same language\n                for (const candidate of this._modelService.getModels()) {\n                    if (!canSyncModel(this._modelService, candidate.uri)) {\n                        continue;\n                    }\n                    if (candidate === model) {\n                        models.unshift(candidate.uri);\n                    }\n                    else if (config.wordBasedSuggestionsMode === 'allDocuments' || candidate.getLanguageId() === model.getLanguageId()) {\n                        models.push(candidate.uri);\n                    }\n                }\n            }\n            if (models.length === 0) {\n                return undefined; // File too large, no other files\n            }\n            const wordDefRegExp = this.languageConfigurationService.getLanguageConfiguration(model.getLanguageId()).getWordDefinition();\n            const word = model.getWordAtPosition(position);\n            const replace = !word ? Range.fromPositions(position) : new Range(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn);\n            const insert = replace.setEndPosition(position.lineNumber, position.column);\n            const client = yield this._workerManager.withWorker();\n            const data = yield client.textualSuggest(models, word === null || word === void 0 ? void 0 : word.word, wordDefRegExp);\n            if (!data) {\n                return undefined;\n            }\n            return {\n                duration: data.duration,\n                suggestions: data.words.map((word) => {\n                    return {\n                        kind: 18 /* languages.CompletionItemKind.Text */,\n                        label: word,\n                        insertText: word,\n                        range: { insert, replace }\n                    };\n                }),\n            };\n        });\n    }\n}\nclass WorkerManager extends Disposable {\n    constructor(modelService, languageConfigurationService) {\n        super();\n        this.languageConfigurationService = languageConfigurationService;\n        this._modelService = modelService;\n        this._editorWorkerClient = null;\n        this._lastWorkerUsedTime = (new Date()).getTime();\n        const stopWorkerInterval = this._register(new IntervalTimer());\n        stopWorkerInterval.cancelAndSet(() => this._checkStopIdleWorker(), Math.round(STOP_WORKER_DELTA_TIME_MS / 2));\n        this._register(this._modelService.onModelRemoved(_ => this._checkStopEmptyWorker()));\n    }\n    dispose() {\n        if (this._editorWorkerClient) {\n            this._editorWorkerClient.dispose();\n            this._editorWorkerClient = null;\n        }\n        super.dispose();\n    }\n    /**\n     * Check if the model service has no more models and stop the worker if that is the case.\n     */\n    _checkStopEmptyWorker() {\n        if (!this._editorWorkerClient) {\n            return;\n        }\n        const models = this._modelService.getModels();\n        if (models.length === 0) {\n            // There are no more models => nothing possible for me to do\n            this._editorWorkerClient.dispose();\n            this._editorWorkerClient = null;\n        }\n    }\n    /**\n     * Check if the worker has been idle for a while and then stop it.\n     */\n    _checkStopIdleWorker() {\n        if (!this._editorWorkerClient) {\n            return;\n        }\n        const timeSinceLastWorkerUsedTime = (new Date()).getTime() - this._lastWorkerUsedTime;\n        if (timeSinceLastWorkerUsedTime > STOP_WORKER_DELTA_TIME_MS) {\n            this._editorWorkerClient.dispose();\n            this._editorWorkerClient = null;\n        }\n    }\n    withWorker() {\n        this._lastWorkerUsedTime = (new Date()).getTime();\n        if (!this._editorWorkerClient) {\n            this._editorWorkerClient = new EditorWorkerClient(this._modelService, false, 'editorWorkerService', this.languageConfigurationService);\n        }\n        return Promise.resolve(this._editorWorkerClient);\n    }\n}\nclass EditorModelManager extends Disposable {\n    constructor(proxy, modelService, keepIdleModels) {\n        super();\n        this._syncedModels = Object.create(null);\n        this._syncedModelsLastUsedTime = Object.create(null);\n        this._proxy = proxy;\n        this._modelService = modelService;\n        if (!keepIdleModels) {\n            const timer = new IntervalTimer();\n            timer.cancelAndSet(() => this._checkStopModelSync(), Math.round(STOP_SYNC_MODEL_DELTA_TIME_MS / 2));\n            this._register(timer);\n        }\n    }\n    dispose() {\n        for (const modelUrl in this._syncedModels) {\n            dispose(this._syncedModels[modelUrl]);\n        }\n        this._syncedModels = Object.create(null);\n        this._syncedModelsLastUsedTime = Object.create(null);\n        super.dispose();\n    }\n    ensureSyncedResources(resources, forceLargeModels) {\n        for (const resource of resources) {\n            const resourceStr = resource.toString();\n            if (!this._syncedModels[resourceStr]) {\n                this._beginModelSync(resource, forceLargeModels);\n            }\n            if (this._syncedModels[resourceStr]) {\n                this._syncedModelsLastUsedTime[resourceStr] = (new Date()).getTime();\n            }\n        }\n    }\n    _checkStopModelSync() {\n        const currentTime = (new Date()).getTime();\n        const toRemove = [];\n        for (const modelUrl in this._syncedModelsLastUsedTime) {\n            const elapsedTime = currentTime - this._syncedModelsLastUsedTime[modelUrl];\n            if (elapsedTime > STOP_SYNC_MODEL_DELTA_TIME_MS) {\n                toRemove.push(modelUrl);\n            }\n        }\n        for (const e of toRemove) {\n            this._stopModelSync(e);\n        }\n    }\n    _beginModelSync(resource, forceLargeModels) {\n        const model = this._modelService.getModel(resource);\n        if (!model) {\n            return;\n        }\n        if (!forceLargeModels && model.isTooLargeForSyncing()) {\n            return;\n        }\n        const modelUrl = resource.toString();\n        this._proxy.acceptNewModel({\n            url: model.uri.toString(),\n            lines: model.getLinesContent(),\n            EOL: model.getEOL(),\n            versionId: model.getVersionId()\n        });\n        const toDispose = new DisposableStore();\n        toDispose.add(model.onDidChangeContent((e) => {\n            this._proxy.acceptModelChanged(modelUrl.toString(), e);\n        }));\n        toDispose.add(model.onWillDispose(() => {\n            this._stopModelSync(modelUrl);\n        }));\n        toDispose.add(toDisposable(() => {\n            this._proxy.acceptRemovedModel(modelUrl);\n        }));\n        this._syncedModels[modelUrl] = toDispose;\n    }\n    _stopModelSync(modelUrl) {\n        const toDispose = this._syncedModels[modelUrl];\n        delete this._syncedModels[modelUrl];\n        delete this._syncedModelsLastUsedTime[modelUrl];\n        dispose(toDispose);\n    }\n}\nclass SynchronousWorkerClient {\n    constructor(instance) {\n        this._instance = instance;\n        this._proxyObj = Promise.resolve(this._instance);\n    }\n    dispose() {\n        this._instance.dispose();\n    }\n    getProxyObject() {\n        return this._proxyObj;\n    }\n}\nexport class EditorWorkerHost {\n    constructor(workerClient) {\n        this._workerClient = workerClient;\n    }\n    // foreign host request\n    fhr(method, args) {\n        return this._workerClient.fhr(method, args);\n    }\n}\nexport class EditorWorkerClient extends Disposable {\n    constructor(modelService, keepIdleModels, label, languageConfigurationService) {\n        super();\n        this.languageConfigurationService = languageConfigurationService;\n        this._disposed = false;\n        this._modelService = modelService;\n        this._keepIdleModels = keepIdleModels;\n        this._workerFactory = new DefaultWorkerFactory(label);\n        this._worker = null;\n        this._modelManager = null;\n    }\n    // foreign host request\n    fhr(method, args) {\n        throw new Error(`Not implemented!`);\n    }\n    _getOrCreateWorker() {\n        if (!this._worker) {\n            try {\n                this._worker = this._register(new SimpleWorkerClient(this._workerFactory, 'vs/editor/common/services/editorSimpleWorker', new EditorWorkerHost(this)));\n            }\n            catch (err) {\n                logOnceWebWorkerWarning(err);\n                this._worker = new SynchronousWorkerClient(new EditorSimpleWorker(new EditorWorkerHost(this), null));\n            }\n        }\n        return this._worker;\n    }\n    _getProxy() {\n        return this._getOrCreateWorker().getProxyObject().then(undefined, (err) => {\n            logOnceWebWorkerWarning(err);\n            this._worker = new SynchronousWorkerClient(new EditorSimpleWorker(new EditorWorkerHost(this), null));\n            return this._getOrCreateWorker().getProxyObject();\n        });\n    }\n    _getOrCreateModelManager(proxy) {\n        if (!this._modelManager) {\n            this._modelManager = this._register(new EditorModelManager(proxy, this._modelService, this._keepIdleModels));\n        }\n        return this._modelManager;\n    }\n    _withSyncedResources(resources, forceLargeModels = false) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._disposed) {\n                return Promise.reject(canceled());\n            }\n            return this._getProxy().then((proxy) => {\n                this._getOrCreateModelManager(proxy).ensureSyncedResources(resources, forceLargeModels);\n                return proxy;\n            });\n        });\n    }\n    computedUnicodeHighlights(uri, options, range) {\n        return this._withSyncedResources([uri]).then(proxy => {\n            return proxy.computeUnicodeHighlights(uri.toString(), options, range);\n        });\n    }\n    computeDiff(original, modified, options, algorithm) {\n        return this._withSyncedResources([original, modified], /* forceLargeModels */ true).then(proxy => {\n            return proxy.computeDiff(original.toString(), modified.toString(), options, algorithm);\n        });\n    }\n    computeMoreMinimalEdits(resource, edits, pretty) {\n        return this._withSyncedResources([resource]).then(proxy => {\n            return proxy.computeMoreMinimalEdits(resource.toString(), edits, pretty);\n        });\n    }\n    computeLinks(resource) {\n        return this._withSyncedResources([resource]).then(proxy => {\n            return proxy.computeLinks(resource.toString());\n        });\n    }\n    computeDefaultDocumentColors(resource) {\n        return this._withSyncedResources([resource]).then(proxy => {\n            return proxy.computeDefaultDocumentColors(resource.toString());\n        });\n    }\n    textualSuggest(resources, leadingWord, wordDefRegExp) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const proxy = yield this._withSyncedResources(resources);\n            const wordDef = wordDefRegExp.source;\n            const wordDefFlags = wordDefRegExp.flags;\n            return proxy.textualSuggest(resources.map(r => r.toString()), leadingWord, wordDef, wordDefFlags);\n        });\n    }\n    computeWordRanges(resource, range) {\n        return this._withSyncedResources([resource]).then(proxy => {\n            const model = this._modelService.getModel(resource);\n            if (!model) {\n                return Promise.resolve(null);\n            }\n            const wordDefRegExp = this.languageConfigurationService.getLanguageConfiguration(model.getLanguageId()).getWordDefinition();\n            const wordDef = wordDefRegExp.source;\n            const wordDefFlags = wordDefRegExp.flags;\n            return proxy.computeWordRanges(resource.toString(), range, wordDef, wordDefFlags);\n        });\n    }\n    navigateValueSet(resource, range, up) {\n        return this._withSyncedResources([resource]).then(proxy => {\n            const model = this._modelService.getModel(resource);\n            if (!model) {\n                return null;\n            }\n            const wordDefRegExp = this.languageConfigurationService.getLanguageConfiguration(model.getLanguageId()).getWordDefinition();\n            const wordDef = wordDefRegExp.source;\n            const wordDefFlags = wordDefRegExp.flags;\n            return proxy.navigateValueSet(resource.toString(), range, up, wordDef, wordDefFlags);\n        });\n    }\n    dispose() {\n        super.dispose();\n        this._disposed = true;\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}