{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar StickyScrollController_1;\nimport { Disposable, DisposableStore, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { StickyScrollWidget, StickyScrollWidgetState } from './stickyScrollWidget.js';\nimport { StickyLineCandidateProvider } from './stickyScrollProvider.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { MenuId } from '../../../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { EditorContextKeys } from '../../../common/editorContextKeys.js';\nimport { ClickLinkGesture } from '../../gotoSymbol/browser/link/clickLinkGesture.js';\nimport { Range } from '../../../common/core/range.js';\nimport { getDefinitionsAtPosition } from '../../gotoSymbol/browser/goToSymbol.js';\nimport { goToDefinitionWithLocation } from '../../inlayHints/browser/inlayHintsLocations.js';\nimport { Position } from '../../../common/core/position.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { ILanguageConfigurationService } from '../../../common/languages/languageConfigurationRegistry.js';\nimport { ILanguageFeatureDebounceService } from '../../../common/services/languageFeatureDebounce.js';\nimport * as dom from '../../../../base/browser/dom.js';\nimport { StickyRange } from './stickyScrollElement.js';\nimport { StandardMouseEvent } from '../../../../base/browser/mouseEvent.js';\nimport { FoldingController } from '../../folding/browser/folding.js';\nimport { toggleCollapseState } from '../../folding/browser/foldingModel.js';\nlet StickyScrollController = StickyScrollController_1 = class StickyScrollController extends Disposable {\n  constructor(_editor, _contextMenuService, _languageFeaturesService, _instaService, _languageConfigurationService, _languageFeatureDebounceService, _contextKeyService) {\n    super();\n    this._editor = _editor;\n    this._contextMenuService = _contextMenuService;\n    this._languageFeaturesService = _languageFeaturesService;\n    this._instaService = _instaService;\n    this._contextKeyService = _contextKeyService;\n    this._sessionStore = new DisposableStore();\n    this._foldingModel = null;\n    this._maxStickyLines = Number.MAX_SAFE_INTEGER;\n    this._candidateDefinitionsLength = -1;\n    this._focusedStickyElementIndex = -1;\n    this._enabled = false;\n    this._focused = false;\n    this._positionRevealed = false;\n    this._onMouseDown = false;\n    this._endLineNumbers = [];\n    this._showEndForLine = null;\n    this._stickyScrollWidget = new StickyScrollWidget(this._editor);\n    this._stickyLineCandidateProvider = new StickyLineCandidateProvider(this._editor, _languageFeaturesService, _languageConfigurationService);\n    this._register(this._stickyScrollWidget);\n    this._register(this._stickyLineCandidateProvider);\n    this._widgetState = new StickyScrollWidgetState([], [], 0);\n    this._readConfiguration();\n    const stickyScrollDomNode = this._stickyScrollWidget.getDomNode();\n    this._register(this._editor.onDidChangeConfiguration(e => {\n      if (e.hasChanged(114 /* EditorOption.stickyScroll */) || e.hasChanged(72 /* EditorOption.minimap */) || e.hasChanged(66 /* EditorOption.lineHeight */) || e.hasChanged(109 /* EditorOption.showFoldingControls */)) {\n        this._readConfiguration();\n      }\n    }));\n    this._register(dom.addDisposableListener(stickyScrollDomNode, dom.EventType.CONTEXT_MENU, event => __awaiter(this, void 0, void 0, function* () {\n      this._onContextMenu(event);\n    })));\n    this._stickyScrollFocusedContextKey = EditorContextKeys.stickyScrollFocused.bindTo(this._contextKeyService);\n    this._stickyScrollVisibleContextKey = EditorContextKeys.stickyScrollVisible.bindTo(this._contextKeyService);\n    const focusTracker = this._register(dom.trackFocus(stickyScrollDomNode));\n    this._register(focusTracker.onDidBlur(_ => {\n      // Suppose that the blurring is caused by scrolling, then keep the focus on the sticky scroll\n      // This is determined by the fact that the height of the widget has become zero and there has been no position revealing\n      if (this._positionRevealed === false && stickyScrollDomNode.clientHeight === 0) {\n        this._focusedStickyElementIndex = -1;\n        this.focus();\n      }\n      // In all other casees, dispose the focus on the sticky scroll\n      else {\n        this._disposeFocusStickyScrollStore();\n      }\n    }));\n    this._register(focusTracker.onDidFocus(_ => {\n      this.focus();\n    }));\n    this._registerMouseListeners();\n    // Suppose that mouse down on the sticky scroll, then do not focus on the sticky scroll because this will be followed by the revealing of a position\n    this._register(dom.addDisposableListener(stickyScrollDomNode, dom.EventType.MOUSE_DOWN, e => {\n      this._onMouseDown = true;\n    }));\n  }\n  static get(editor) {\n    return editor.getContribution(StickyScrollController_1.ID);\n  }\n  _disposeFocusStickyScrollStore() {\n    var _a;\n    this._stickyScrollFocusedContextKey.set(false);\n    (_a = this._focusDisposableStore) === null || _a === void 0 ? void 0 : _a.dispose();\n    this._focused = false;\n    this._positionRevealed = false;\n    this._onMouseDown = false;\n  }\n  focus() {\n    // If the mouse is down, do not focus on the sticky scroll\n    if (this._onMouseDown) {\n      this._onMouseDown = false;\n      this._editor.focus();\n      return;\n    }\n    const focusState = this._stickyScrollFocusedContextKey.get();\n    if (focusState === true) {\n      return;\n    }\n    this._focused = true;\n    this._focusDisposableStore = new DisposableStore();\n    this._stickyScrollFocusedContextKey.set(true);\n    this._focusedStickyElementIndex = this._stickyScrollWidget.lineNumbers.length - 1;\n    this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);\n  }\n  focusNext() {\n    if (this._focusedStickyElementIndex < this._stickyScrollWidget.lineNumberCount - 1) {\n      this._focusNav(true);\n    }\n  }\n  focusPrevious() {\n    if (this._focusedStickyElementIndex > 0) {\n      this._focusNav(false);\n    }\n  }\n  selectEditor() {\n    this._editor.focus();\n  }\n  // True is next, false is previous\n  _focusNav(direction) {\n    this._focusedStickyElementIndex = direction ? this._focusedStickyElementIndex + 1 : this._focusedStickyElementIndex - 1;\n    this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);\n  }\n  goToFocused() {\n    const lineNumbers = this._stickyScrollWidget.lineNumbers;\n    this._disposeFocusStickyScrollStore();\n    this._revealPosition({\n      lineNumber: lineNumbers[this._focusedStickyElementIndex],\n      column: 1\n    });\n  }\n  _revealPosition(position) {\n    this._reveaInEditor(position, () => this._editor.revealPosition(position));\n  }\n  _revealLineInCenterIfOutsideViewport(position) {\n    this._reveaInEditor(position, () => this._editor.revealLineInCenterIfOutsideViewport(position.lineNumber, 0 /* ScrollType.Smooth */));\n  }\n\n  _reveaInEditor(position, revealFunction) {\n    if (this._focused) {\n      this._disposeFocusStickyScrollStore();\n    }\n    this._positionRevealed = true;\n    revealFunction();\n    this._editor.setSelection(Range.fromPositions(position));\n    this._editor.focus();\n  }\n  _registerMouseListeners() {\n    const sessionStore = this._register(new DisposableStore());\n    const gesture = this._register(new ClickLinkGesture(this._editor, {\n      extractLineNumberFromMouseEvent: e => {\n        const position = this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);\n        return position ? position.lineNumber : 0;\n      }\n    }));\n    const getMouseEventTarget = mouseEvent => {\n      if (!this._editor.hasModel()) {\n        return null;\n      }\n      if (mouseEvent.target.type !== 12 /* MouseTargetType.OVERLAY_WIDGET */ || mouseEvent.target.detail !== this._stickyScrollWidget.getId()) {\n        // not hovering over our widget\n        return null;\n      }\n      const mouseTargetElement = mouseEvent.target.element;\n      if (!mouseTargetElement || mouseTargetElement.innerText !== mouseTargetElement.innerHTML) {\n        // not on a span element rendering text\n        return null;\n      }\n      const position = this._stickyScrollWidget.getEditorPositionFromNode(mouseTargetElement);\n      if (!position) {\n        // not hovering a sticky scroll line\n        return null;\n      }\n      return {\n        range: new Range(position.lineNumber, position.column, position.lineNumber, position.column + mouseTargetElement.innerText.length),\n        textElement: mouseTargetElement\n      };\n    };\n    const stickyScrollWidgetDomNode = this._stickyScrollWidget.getDomNode();\n    this._register(dom.addStandardDisposableListener(stickyScrollWidgetDomNode, dom.EventType.CLICK, mouseEvent => {\n      if (mouseEvent.ctrlKey || mouseEvent.altKey || mouseEvent.metaKey) {\n        // modifier pressed\n        return;\n      }\n      if (!mouseEvent.leftButton) {\n        // not left click\n        return;\n      }\n      if (mouseEvent.shiftKey) {\n        // shift click\n        const lineIndex = this._stickyScrollWidget.getLineIndexFromChildDomNode(mouseEvent.target);\n        if (lineIndex === null) {\n          return;\n        }\n        const position = new Position(this._endLineNumbers[lineIndex], 1);\n        this._revealLineInCenterIfOutsideViewport(position);\n        return;\n      }\n      const isInFoldingIconDomNode = this._stickyScrollWidget.isInFoldingIconDomNode(mouseEvent.target);\n      if (isInFoldingIconDomNode) {\n        // clicked on folding icon\n        const lineNumber = this._stickyScrollWidget.getLineNumberFromChildDomNode(mouseEvent.target);\n        this._toggleFoldingRegionForLine(lineNumber);\n        return;\n      }\n      const isInStickyLine = this._stickyScrollWidget.isInStickyLine(mouseEvent.target);\n      if (!isInStickyLine) {\n        return;\n      }\n      // normal click\n      let position = this._stickyScrollWidget.getEditorPositionFromNode(mouseEvent.target);\n      if (!position) {\n        const lineNumber = this._stickyScrollWidget.getLineNumberFromChildDomNode(mouseEvent.target);\n        if (lineNumber === null) {\n          // not hovering a sticky scroll line\n          return;\n        }\n        position = new Position(lineNumber, 1);\n      }\n      this._revealPosition(position);\n    }));\n    this._register(dom.addStandardDisposableListener(stickyScrollWidgetDomNode, dom.EventType.MOUSE_MOVE, mouseEvent => {\n      if (mouseEvent.shiftKey) {\n        const currentEndForLineIndex = this._stickyScrollWidget.getLineIndexFromChildDomNode(mouseEvent.target);\n        if (currentEndForLineIndex === null || this._showEndForLine !== null && this._showEndForLine === currentEndForLineIndex) {\n          return;\n        }\n        this._showEndForLine = currentEndForLineIndex;\n        this._renderStickyScroll();\n        return;\n      }\n      if (this._showEndForLine !== null) {\n        this._showEndForLine = null;\n        this._renderStickyScroll();\n      }\n    }));\n    this._register(dom.addDisposableListener(stickyScrollWidgetDomNode, dom.EventType.MOUSE_LEAVE, e => {\n      if (this._showEndForLine !== null) {\n        this._showEndForLine = null;\n        this._renderStickyScroll();\n      }\n    }));\n    this._register(gesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, _keyboardEvent]) => {\n      const mouseTarget = getMouseEventTarget(mouseEvent);\n      if (!mouseTarget || !mouseEvent.hasTriggerModifier || !this._editor.hasModel()) {\n        sessionStore.clear();\n        return;\n      }\n      const {\n        range,\n        textElement\n      } = mouseTarget;\n      if (!range.equalsRange(this._stickyRangeProjectedOnEditor)) {\n        this._stickyRangeProjectedOnEditor = range;\n        sessionStore.clear();\n      } else if (textElement.style.textDecoration === 'underline') {\n        return;\n      }\n      const cancellationToken = new CancellationTokenSource();\n      sessionStore.add(toDisposable(() => cancellationToken.dispose(true)));\n      let currentHTMLChild;\n      getDefinitionsAtPosition(this._languageFeaturesService.definitionProvider, this._editor.getModel(), new Position(range.startLineNumber, range.startColumn + 1), cancellationToken.token).then(candidateDefinitions => {\n        if (cancellationToken.token.isCancellationRequested) {\n          return;\n        }\n        if (candidateDefinitions.length !== 0) {\n          this._candidateDefinitionsLength = candidateDefinitions.length;\n          const childHTML = textElement;\n          if (currentHTMLChild !== childHTML) {\n            sessionStore.clear();\n            currentHTMLChild = childHTML;\n            currentHTMLChild.style.textDecoration = 'underline';\n            sessionStore.add(toDisposable(() => {\n              currentHTMLChild.style.textDecoration = 'none';\n            }));\n          } else if (!currentHTMLChild) {\n            currentHTMLChild = childHTML;\n            currentHTMLChild.style.textDecoration = 'underline';\n            sessionStore.add(toDisposable(() => {\n              currentHTMLChild.style.textDecoration = 'none';\n            }));\n          }\n        } else {\n          sessionStore.clear();\n        }\n      });\n    }));\n    this._register(gesture.onCancel(() => {\n      sessionStore.clear();\n    }));\n    this._register(gesture.onExecute(e => __awaiter(this, void 0, void 0, function* () {\n      if (e.target.type !== 12 /* MouseTargetType.OVERLAY_WIDGET */ || e.target.detail !== this._stickyScrollWidget.getId()) {\n        // not hovering over our widget\n        return;\n      }\n      const position = this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);\n      if (!position) {\n        // not hovering a sticky scroll line\n        return;\n      }\n      if (this._candidateDefinitionsLength > 1) {\n        if (this._focused) {\n          this._disposeFocusStickyScrollStore();\n        }\n        this._revealPosition({\n          lineNumber: position.lineNumber,\n          column: 1\n        });\n      }\n      this._instaService.invokeFunction(goToDefinitionWithLocation, e, this._editor, {\n        uri: this._editor.getModel().uri,\n        range: this._stickyRangeProjectedOnEditor\n      });\n    })));\n  }\n  _onContextMenu(e) {\n    const event = new StandardMouseEvent(e);\n    this._contextMenuService.showContextMenu({\n      menuId: MenuId.StickyScrollContext,\n      getAnchor: () => event\n    });\n  }\n  _toggleFoldingRegionForLine(line) {\n    if (!this._foldingModel || line === null) {\n      return;\n    }\n    const stickyLine = this._stickyScrollWidget.getStickyLineForLine(line);\n    const foldingIcon = stickyLine === null || stickyLine === void 0 ? void 0 : stickyLine.foldingIcon;\n    if (!foldingIcon) {\n      return;\n    }\n    toggleCollapseState(this._foldingModel, Number.MAX_VALUE, [line]);\n    foldingIcon.isCollapsed = !foldingIcon.isCollapsed;\n    const scrollTop = (foldingIcon.isCollapsed ? this._editor.getTopForLineNumber(foldingIcon.foldingEndLine) : this._editor.getTopForLineNumber(foldingIcon.foldingStartLine)) - this._editor.getOption(66 /* EditorOption.lineHeight */) * stickyLine.index + 1;\n    this._editor.setScrollTop(scrollTop);\n    this._renderStickyScroll(line);\n  }\n  _readConfiguration() {\n    const options = this._editor.getOption(114 /* EditorOption.stickyScroll */);\n    if (options.enabled === false) {\n      this._editor.removeOverlayWidget(this._stickyScrollWidget);\n      this._sessionStore.clear();\n      this._enabled = false;\n      return;\n    } else if (options.enabled && !this._enabled) {\n      // When sticky scroll was just enabled, add the listeners on the sticky scroll\n      this._editor.addOverlayWidget(this._stickyScrollWidget);\n      this._sessionStore.add(this._editor.onDidScrollChange(e => {\n        if (e.scrollTopChanged) {\n          this._showEndForLine = null;\n          this._renderStickyScroll();\n        }\n      }));\n      this._sessionStore.add(this._editor.onDidLayoutChange(() => this._onDidResize()));\n      this._sessionStore.add(this._editor.onDidChangeModelTokens(e => this._onTokensChange(e)));\n      this._sessionStore.add(this._stickyLineCandidateProvider.onDidChangeStickyScroll(() => {\n        this._showEndForLine = null;\n        this._renderStickyScroll();\n      }));\n      this._enabled = true;\n    }\n    const lineNumberOption = this._editor.getOption(67 /* EditorOption.lineNumbers */);\n    if (lineNumberOption.renderType === 2 /* RenderLineNumbersType.Relative */) {\n      this._sessionStore.add(this._editor.onDidChangeCursorPosition(() => {\n        this._showEndForLine = null;\n        this._renderStickyScroll();\n      }));\n    }\n  }\n  _needsUpdate(event) {\n    const stickyLineNumbers = this._stickyScrollWidget.getCurrentLines();\n    for (const stickyLineNumber of stickyLineNumbers) {\n      for (const range of event.ranges) {\n        if (stickyLineNumber >= range.fromLineNumber && stickyLineNumber <= range.toLineNumber) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n  _onTokensChange(event) {\n    if (this._needsUpdate(event)) {\n      // Rebuilding the whole widget from line -1\n      this._renderStickyScroll(-1);\n    }\n  }\n  _onDidResize() {\n    const layoutInfo = this._editor.getLayoutInfo();\n    // Make sure sticky scroll doesn't take up more than 25% of the editor\n    const theoreticalLines = layoutInfo.height / this._editor.getOption(66 /* EditorOption.lineHeight */);\n    this._maxStickyLines = Math.round(theoreticalLines * .25);\n  }\n  _renderStickyScroll(rebuildFromLine = Infinity) {\n    var _a, _b;\n    return __awaiter(this, void 0, void 0, function* () {\n      const model = this._editor.getModel();\n      if (!model || model.isTooLargeForTokenization()) {\n        this._foldingModel = null;\n        this._stickyScrollWidget.setState(undefined, null, rebuildFromLine);\n        return;\n      }\n      const stickyLineVersion = this._stickyLineCandidateProvider.getVersionId();\n      if (stickyLineVersion === undefined || stickyLineVersion === model.getVersionId()) {\n        this._foldingModel = (_b = yield (_a = FoldingController.get(this._editor)) === null || _a === void 0 ? void 0 : _a.getFoldingModel()) !== null && _b !== void 0 ? _b : null;\n        this._widgetState = this.findScrollWidgetState();\n        this._stickyScrollVisibleContextKey.set(!(this._widgetState.startLineNumbers.length === 0));\n        if (!this._focused) {\n          this._stickyScrollWidget.setState(this._widgetState, this._foldingModel, rebuildFromLine);\n        } else {\n          // Suppose that previously the sticky scroll widget had height 0, then if there are visible lines, set the last line as focused\n          if (this._focusedStickyElementIndex === -1) {\n            this._stickyScrollWidget.setState(this._widgetState, this._foldingModel, rebuildFromLine);\n            this._focusedStickyElementIndex = this._stickyScrollWidget.lineNumberCount - 1;\n            if (this._focusedStickyElementIndex !== -1) {\n              this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);\n            }\n          } else {\n            const focusedStickyElementLineNumber = this._stickyScrollWidget.lineNumbers[this._focusedStickyElementIndex];\n            this._stickyScrollWidget.setState(this._widgetState, this._foldingModel, rebuildFromLine);\n            // Suppose that after setting the state, there are no sticky lines, set the focused index to -1\n            if (this._stickyScrollWidget.lineNumberCount === 0) {\n              this._focusedStickyElementIndex = -1;\n            } else {\n              const previousFocusedLineNumberExists = this._stickyScrollWidget.lineNumbers.includes(focusedStickyElementLineNumber);\n              // If the line number is still there, do not change anything\n              // If the line number is not there, set the new focused line to be the last line\n              if (!previousFocusedLineNumberExists) {\n                this._focusedStickyElementIndex = this._stickyScrollWidget.lineNumberCount - 1;\n              }\n              this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);\n            }\n          }\n        }\n      }\n    });\n  }\n  findScrollWidgetState() {\n    const lineHeight = this._editor.getOption(66 /* EditorOption.lineHeight */);\n    const maxNumberStickyLines = Math.min(this._maxStickyLines, this._editor.getOption(114 /* EditorOption.stickyScroll */).maxLineCount);\n    const scrollTop = this._editor.getScrollTop();\n    let lastLineRelativePosition = 0;\n    const startLineNumbers = [];\n    const endLineNumbers = [];\n    const arrayVisibleRanges = this._editor.getVisibleRanges();\n    if (arrayVisibleRanges.length !== 0) {\n      const fullVisibleRange = new StickyRange(arrayVisibleRanges[0].startLineNumber, arrayVisibleRanges[arrayVisibleRanges.length - 1].endLineNumber);\n      const candidateRanges = this._stickyLineCandidateProvider.getCandidateStickyLinesIntersecting(fullVisibleRange);\n      for (const range of candidateRanges) {\n        const start = range.startLineNumber;\n        const end = range.endLineNumber;\n        const depth = range.nestingDepth;\n        if (end - start > 0) {\n          const topOfElementAtDepth = (depth - 1) * lineHeight;\n          const bottomOfElementAtDepth = depth * lineHeight;\n          const bottomOfBeginningLine = this._editor.getBottomForLineNumber(start) - scrollTop;\n          const topOfEndLine = this._editor.getTopForLineNumber(end) - scrollTop;\n          const bottomOfEndLine = this._editor.getBottomForLineNumber(end) - scrollTop;\n          if (topOfElementAtDepth > topOfEndLine && topOfElementAtDepth <= bottomOfEndLine) {\n            startLineNumbers.push(start);\n            endLineNumbers.push(end + 1);\n            lastLineRelativePosition = bottomOfEndLine - bottomOfElementAtDepth;\n            break;\n          } else if (bottomOfElementAtDepth > bottomOfBeginningLine && bottomOfElementAtDepth <= bottomOfEndLine) {\n            startLineNumbers.push(start);\n            endLineNumbers.push(end + 1);\n          }\n          if (startLineNumbers.length === maxNumberStickyLines) {\n            break;\n          }\n        }\n      }\n    }\n    this._endLineNumbers = endLineNumbers;\n    return new StickyScrollWidgetState(startLineNumbers, endLineNumbers, lastLineRelativePosition, this._showEndForLine);\n  }\n  dispose() {\n    super.dispose();\n    this._sessionStore.dispose();\n  }\n};\nStickyScrollController.ID = 'store.contrib.stickyScrollController';\nStickyScrollController = StickyScrollController_1 = __decorate([__param(1, IContextMenuService), __param(2, ILanguageFeaturesService), __param(3, IInstantiationService), __param(4, ILanguageConfigurationService), __param(5, ILanguageFeatureDebounceService), __param(6, IContextKeyService)], StickyScrollController);\nexport { StickyScrollController };","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","StickyScrollController_1","Disposable","DisposableStore","toDisposable","ILanguageFeaturesService","StickyScrollWidget","StickyScrollWidgetState","StickyLineCandidateProvider","IInstantiationService","IContextMenuService","MenuId","IContextKeyService","EditorContextKeys","ClickLinkGesture","Range","getDefinitionsAtPosition","goToDefinitionWithLocation","Position","CancellationTokenSource","ILanguageConfigurationService","ILanguageFeatureDebounceService","dom","StickyRange","StandardMouseEvent","FoldingController","toggleCollapseState","StickyScrollController","constructor","_editor","_contextMenuService","_languageFeaturesService","_instaService","_languageConfigurationService","_languageFeatureDebounceService","_contextKeyService","_sessionStore","_foldingModel","_maxStickyLines","Number","MAX_SAFE_INTEGER","_candidateDefinitionsLength","_focusedStickyElementIndex","_enabled","_focused","_positionRevealed","_onMouseDown","_endLineNumbers","_showEndForLine","_stickyScrollWidget","_stickyLineCandidateProvider","_register","_widgetState","_readConfiguration","stickyScrollDomNode","getDomNode","onDidChangeConfiguration","hasChanged","addDisposableListener","EventType","CONTEXT_MENU","event","_onContextMenu","_stickyScrollFocusedContextKey","stickyScrollFocused","bindTo","_stickyScrollVisibleContextKey","stickyScrollVisible","focusTracker","trackFocus","onDidBlur","_","clientHeight","focus","_disposeFocusStickyScrollStore","onDidFocus","_registerMouseListeners","MOUSE_DOWN","get","editor","getContribution","ID","_a","set","_focusDisposableStore","dispose","focusState","lineNumbers","focusLineWithIndex","focusNext","lineNumberCount","_focusNav","focusPrevious","selectEditor","direction","goToFocused","_revealPosition","lineNumber","column","position","_reveaInEditor","revealPosition","_revealLineInCenterIfOutsideViewport","revealLineInCenterIfOutsideViewport","revealFunction","setSelection","fromPositions","sessionStore","gesture","extractLineNumberFromMouseEvent","getEditorPositionFromNode","element","getMouseEventTarget","mouseEvent","hasModel","type","detail","getId","mouseTargetElement","innerText","innerHTML","range","textElement","stickyScrollWidgetDomNode","addStandardDisposableListener","CLICK","ctrlKey","altKey","metaKey","leftButton","shiftKey","lineIndex","getLineIndexFromChildDomNode","isInFoldingIconDomNode","getLineNumberFromChildDomNode","_toggleFoldingRegionForLine","isInStickyLine","MOUSE_MOVE","currentEndForLineIndex","_renderStickyScroll","MOUSE_LEAVE","onMouseMoveOrRelevantKeyDown","_keyboardEvent","mouseTarget","hasTriggerModifier","clear","equalsRange","_stickyRangeProjectedOnEditor","style","textDecoration","cancellationToken","add","currentHTMLChild","definitionProvider","getModel","startLineNumber","startColumn","token","candidateDefinitions","isCancellationRequested","childHTML","onCancel","onExecute","invokeFunction","uri","showContextMenu","menuId","StickyScrollContext","getAnchor","line","stickyLine","getStickyLineForLine","foldingIcon","MAX_VALUE","isCollapsed","scrollTop","getTopForLineNumber","foldingEndLine","foldingStartLine","getOption","index","setScrollTop","options","enabled","removeOverlayWidget","addOverlayWidget","onDidScrollChange","scrollTopChanged","onDidLayoutChange","_onDidResize","onDidChangeModelTokens","_onTokensChange","onDidChangeStickyScroll","lineNumberOption","renderType","onDidChangeCursorPosition","_needsUpdate","stickyLineNumbers","getCurrentLines","stickyLineNumber","ranges","fromLineNumber","toLineNumber","layoutInfo","getLayoutInfo","theoreticalLines","height","Math","round","rebuildFromLine","Infinity","_b","model","isTooLargeForTokenization","setState","undefined","stickyLineVersion","getVersionId","getFoldingModel","findScrollWidgetState","startLineNumbers","focusedStickyElementLineNumber","previousFocusedLineNumberExists","includes","lineHeight","maxNumberStickyLines","min","maxLineCount","getScrollTop","lastLineRelativePosition","endLineNumbers","arrayVisibleRanges","getVisibleRanges","fullVisibleRange","endLineNumber","candidateRanges","getCandidateStickyLinesIntersecting","start","end","depth","nestingDepth","topOfElementAtDepth","bottomOfElementAtDepth","bottomOfBeginningLine","getBottomForLineNumber","topOfEndLine","bottomOfEndLine","push"],"sources":["/home/chlohest/work/website/my_web/node_modules/monaco-editor/esm/vs/editor/contrib/stickyScroll/browser/stickyScrollController.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar StickyScrollController_1;\nimport { Disposable, DisposableStore, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { StickyScrollWidget, StickyScrollWidgetState } from './stickyScrollWidget.js';\nimport { StickyLineCandidateProvider } from './stickyScrollProvider.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { MenuId } from '../../../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { EditorContextKeys } from '../../../common/editorContextKeys.js';\nimport { ClickLinkGesture } from '../../gotoSymbol/browser/link/clickLinkGesture.js';\nimport { Range } from '../../../common/core/range.js';\nimport { getDefinitionsAtPosition } from '../../gotoSymbol/browser/goToSymbol.js';\nimport { goToDefinitionWithLocation } from '../../inlayHints/browser/inlayHintsLocations.js';\nimport { Position } from '../../../common/core/position.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { ILanguageConfigurationService } from '../../../common/languages/languageConfigurationRegistry.js';\nimport { ILanguageFeatureDebounceService } from '../../../common/services/languageFeatureDebounce.js';\nimport * as dom from '../../../../base/browser/dom.js';\nimport { StickyRange } from './stickyScrollElement.js';\nimport { StandardMouseEvent } from '../../../../base/browser/mouseEvent.js';\nimport { FoldingController } from '../../folding/browser/folding.js';\nimport { toggleCollapseState } from '../../folding/browser/foldingModel.js';\nlet StickyScrollController = StickyScrollController_1 = class StickyScrollController extends Disposable {\n    constructor(_editor, _contextMenuService, _languageFeaturesService, _instaService, _languageConfigurationService, _languageFeatureDebounceService, _contextKeyService) {\n        super();\n        this._editor = _editor;\n        this._contextMenuService = _contextMenuService;\n        this._languageFeaturesService = _languageFeaturesService;\n        this._instaService = _instaService;\n        this._contextKeyService = _contextKeyService;\n        this._sessionStore = new DisposableStore();\n        this._foldingModel = null;\n        this._maxStickyLines = Number.MAX_SAFE_INTEGER;\n        this._candidateDefinitionsLength = -1;\n        this._focusedStickyElementIndex = -1;\n        this._enabled = false;\n        this._focused = false;\n        this._positionRevealed = false;\n        this._onMouseDown = false;\n        this._endLineNumbers = [];\n        this._showEndForLine = null;\n        this._stickyScrollWidget = new StickyScrollWidget(this._editor);\n        this._stickyLineCandidateProvider = new StickyLineCandidateProvider(this._editor, _languageFeaturesService, _languageConfigurationService);\n        this._register(this._stickyScrollWidget);\n        this._register(this._stickyLineCandidateProvider);\n        this._widgetState = new StickyScrollWidgetState([], [], 0);\n        this._readConfiguration();\n        const stickyScrollDomNode = this._stickyScrollWidget.getDomNode();\n        this._register(this._editor.onDidChangeConfiguration(e => {\n            if (e.hasChanged(114 /* EditorOption.stickyScroll */)\n                || e.hasChanged(72 /* EditorOption.minimap */)\n                || e.hasChanged(66 /* EditorOption.lineHeight */)\n                || e.hasChanged(109 /* EditorOption.showFoldingControls */)) {\n                this._readConfiguration();\n            }\n        }));\n        this._register(dom.addDisposableListener(stickyScrollDomNode, dom.EventType.CONTEXT_MENU, (event) => __awaiter(this, void 0, void 0, function* () {\n            this._onContextMenu(event);\n        })));\n        this._stickyScrollFocusedContextKey = EditorContextKeys.stickyScrollFocused.bindTo(this._contextKeyService);\n        this._stickyScrollVisibleContextKey = EditorContextKeys.stickyScrollVisible.bindTo(this._contextKeyService);\n        const focusTracker = this._register(dom.trackFocus(stickyScrollDomNode));\n        this._register(focusTracker.onDidBlur(_ => {\n            // Suppose that the blurring is caused by scrolling, then keep the focus on the sticky scroll\n            // This is determined by the fact that the height of the widget has become zero and there has been no position revealing\n            if (this._positionRevealed === false && stickyScrollDomNode.clientHeight === 0) {\n                this._focusedStickyElementIndex = -1;\n                this.focus();\n            }\n            // In all other casees, dispose the focus on the sticky scroll\n            else {\n                this._disposeFocusStickyScrollStore();\n            }\n        }));\n        this._register(focusTracker.onDidFocus(_ => {\n            this.focus();\n        }));\n        this._registerMouseListeners();\n        // Suppose that mouse down on the sticky scroll, then do not focus on the sticky scroll because this will be followed by the revealing of a position\n        this._register(dom.addDisposableListener(stickyScrollDomNode, dom.EventType.MOUSE_DOWN, (e) => {\n            this._onMouseDown = true;\n        }));\n    }\n    static get(editor) {\n        return editor.getContribution(StickyScrollController_1.ID);\n    }\n    _disposeFocusStickyScrollStore() {\n        var _a;\n        this._stickyScrollFocusedContextKey.set(false);\n        (_a = this._focusDisposableStore) === null || _a === void 0 ? void 0 : _a.dispose();\n        this._focused = false;\n        this._positionRevealed = false;\n        this._onMouseDown = false;\n    }\n    focus() {\n        // If the mouse is down, do not focus on the sticky scroll\n        if (this._onMouseDown) {\n            this._onMouseDown = false;\n            this._editor.focus();\n            return;\n        }\n        const focusState = this._stickyScrollFocusedContextKey.get();\n        if (focusState === true) {\n            return;\n        }\n        this._focused = true;\n        this._focusDisposableStore = new DisposableStore();\n        this._stickyScrollFocusedContextKey.set(true);\n        this._focusedStickyElementIndex = this._stickyScrollWidget.lineNumbers.length - 1;\n        this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);\n    }\n    focusNext() {\n        if (this._focusedStickyElementIndex < this._stickyScrollWidget.lineNumberCount - 1) {\n            this._focusNav(true);\n        }\n    }\n    focusPrevious() {\n        if (this._focusedStickyElementIndex > 0) {\n            this._focusNav(false);\n        }\n    }\n    selectEditor() {\n        this._editor.focus();\n    }\n    // True is next, false is previous\n    _focusNav(direction) {\n        this._focusedStickyElementIndex = direction ? this._focusedStickyElementIndex + 1 : this._focusedStickyElementIndex - 1;\n        this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);\n    }\n    goToFocused() {\n        const lineNumbers = this._stickyScrollWidget.lineNumbers;\n        this._disposeFocusStickyScrollStore();\n        this._revealPosition({ lineNumber: lineNumbers[this._focusedStickyElementIndex], column: 1 });\n    }\n    _revealPosition(position) {\n        this._reveaInEditor(position, () => this._editor.revealPosition(position));\n    }\n    _revealLineInCenterIfOutsideViewport(position) {\n        this._reveaInEditor(position, () => this._editor.revealLineInCenterIfOutsideViewport(position.lineNumber, 0 /* ScrollType.Smooth */));\n    }\n    _reveaInEditor(position, revealFunction) {\n        if (this._focused) {\n            this._disposeFocusStickyScrollStore();\n        }\n        this._positionRevealed = true;\n        revealFunction();\n        this._editor.setSelection(Range.fromPositions(position));\n        this._editor.focus();\n    }\n    _registerMouseListeners() {\n        const sessionStore = this._register(new DisposableStore());\n        const gesture = this._register(new ClickLinkGesture(this._editor, {\n            extractLineNumberFromMouseEvent: (e) => {\n                const position = this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);\n                return position ? position.lineNumber : 0;\n            }\n        }));\n        const getMouseEventTarget = (mouseEvent) => {\n            if (!this._editor.hasModel()) {\n                return null;\n            }\n            if (mouseEvent.target.type !== 12 /* MouseTargetType.OVERLAY_WIDGET */ || mouseEvent.target.detail !== this._stickyScrollWidget.getId()) {\n                // not hovering over our widget\n                return null;\n            }\n            const mouseTargetElement = mouseEvent.target.element;\n            if (!mouseTargetElement || mouseTargetElement.innerText !== mouseTargetElement.innerHTML) {\n                // not on a span element rendering text\n                return null;\n            }\n            const position = this._stickyScrollWidget.getEditorPositionFromNode(mouseTargetElement);\n            if (!position) {\n                // not hovering a sticky scroll line\n                return null;\n            }\n            return {\n                range: new Range(position.lineNumber, position.column, position.lineNumber, position.column + mouseTargetElement.innerText.length),\n                textElement: mouseTargetElement\n            };\n        };\n        const stickyScrollWidgetDomNode = this._stickyScrollWidget.getDomNode();\n        this._register(dom.addStandardDisposableListener(stickyScrollWidgetDomNode, dom.EventType.CLICK, (mouseEvent) => {\n            if (mouseEvent.ctrlKey || mouseEvent.altKey || mouseEvent.metaKey) {\n                // modifier pressed\n                return;\n            }\n            if (!mouseEvent.leftButton) {\n                // not left click\n                return;\n            }\n            if (mouseEvent.shiftKey) {\n                // shift click\n                const lineIndex = this._stickyScrollWidget.getLineIndexFromChildDomNode(mouseEvent.target);\n                if (lineIndex === null) {\n                    return;\n                }\n                const position = new Position(this._endLineNumbers[lineIndex], 1);\n                this._revealLineInCenterIfOutsideViewport(position);\n                return;\n            }\n            const isInFoldingIconDomNode = this._stickyScrollWidget.isInFoldingIconDomNode(mouseEvent.target);\n            if (isInFoldingIconDomNode) {\n                // clicked on folding icon\n                const lineNumber = this._stickyScrollWidget.getLineNumberFromChildDomNode(mouseEvent.target);\n                this._toggleFoldingRegionForLine(lineNumber);\n                return;\n            }\n            const isInStickyLine = this._stickyScrollWidget.isInStickyLine(mouseEvent.target);\n            if (!isInStickyLine) {\n                return;\n            }\n            // normal click\n            let position = this._stickyScrollWidget.getEditorPositionFromNode(mouseEvent.target);\n            if (!position) {\n                const lineNumber = this._stickyScrollWidget.getLineNumberFromChildDomNode(mouseEvent.target);\n                if (lineNumber === null) {\n                    // not hovering a sticky scroll line\n                    return;\n                }\n                position = new Position(lineNumber, 1);\n            }\n            this._revealPosition(position);\n        }));\n        this._register(dom.addStandardDisposableListener(stickyScrollWidgetDomNode, dom.EventType.MOUSE_MOVE, (mouseEvent) => {\n            if (mouseEvent.shiftKey) {\n                const currentEndForLineIndex = this._stickyScrollWidget.getLineIndexFromChildDomNode(mouseEvent.target);\n                if (currentEndForLineIndex === null || this._showEndForLine !== null && this._showEndForLine === currentEndForLineIndex) {\n                    return;\n                }\n                this._showEndForLine = currentEndForLineIndex;\n                this._renderStickyScroll();\n                return;\n            }\n            if (this._showEndForLine !== null) {\n                this._showEndForLine = null;\n                this._renderStickyScroll();\n            }\n        }));\n        this._register(dom.addDisposableListener(stickyScrollWidgetDomNode, dom.EventType.MOUSE_LEAVE, (e) => {\n            if (this._showEndForLine !== null) {\n                this._showEndForLine = null;\n                this._renderStickyScroll();\n            }\n        }));\n        this._register(gesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, _keyboardEvent]) => {\n            const mouseTarget = getMouseEventTarget(mouseEvent);\n            if (!mouseTarget || !mouseEvent.hasTriggerModifier || !this._editor.hasModel()) {\n                sessionStore.clear();\n                return;\n            }\n            const { range, textElement } = mouseTarget;\n            if (!range.equalsRange(this._stickyRangeProjectedOnEditor)) {\n                this._stickyRangeProjectedOnEditor = range;\n                sessionStore.clear();\n            }\n            else if (textElement.style.textDecoration === 'underline') {\n                return;\n            }\n            const cancellationToken = new CancellationTokenSource();\n            sessionStore.add(toDisposable(() => cancellationToken.dispose(true)));\n            let currentHTMLChild;\n            getDefinitionsAtPosition(this._languageFeaturesService.definitionProvider, this._editor.getModel(), new Position(range.startLineNumber, range.startColumn + 1), cancellationToken.token).then((candidateDefinitions => {\n                if (cancellationToken.token.isCancellationRequested) {\n                    return;\n                }\n                if (candidateDefinitions.length !== 0) {\n                    this._candidateDefinitionsLength = candidateDefinitions.length;\n                    const childHTML = textElement;\n                    if (currentHTMLChild !== childHTML) {\n                        sessionStore.clear();\n                        currentHTMLChild = childHTML;\n                        currentHTMLChild.style.textDecoration = 'underline';\n                        sessionStore.add(toDisposable(() => {\n                            currentHTMLChild.style.textDecoration = 'none';\n                        }));\n                    }\n                    else if (!currentHTMLChild) {\n                        currentHTMLChild = childHTML;\n                        currentHTMLChild.style.textDecoration = 'underline';\n                        sessionStore.add(toDisposable(() => {\n                            currentHTMLChild.style.textDecoration = 'none';\n                        }));\n                    }\n                }\n                else {\n                    sessionStore.clear();\n                }\n            }));\n        }));\n        this._register(gesture.onCancel(() => {\n            sessionStore.clear();\n        }));\n        this._register(gesture.onExecute((e) => __awaiter(this, void 0, void 0, function* () {\n            if (e.target.type !== 12 /* MouseTargetType.OVERLAY_WIDGET */ || e.target.detail !== this._stickyScrollWidget.getId()) {\n                // not hovering over our widget\n                return;\n            }\n            const position = this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);\n            if (!position) {\n                // not hovering a sticky scroll line\n                return;\n            }\n            if (this._candidateDefinitionsLength > 1) {\n                if (this._focused) {\n                    this._disposeFocusStickyScrollStore();\n                }\n                this._revealPosition({ lineNumber: position.lineNumber, column: 1 });\n            }\n            this._instaService.invokeFunction(goToDefinitionWithLocation, e, this._editor, { uri: this._editor.getModel().uri, range: this._stickyRangeProjectedOnEditor });\n        })));\n    }\n    _onContextMenu(e) {\n        const event = new StandardMouseEvent(e);\n        this._contextMenuService.showContextMenu({\n            menuId: MenuId.StickyScrollContext,\n            getAnchor: () => event,\n        });\n    }\n    _toggleFoldingRegionForLine(line) {\n        if (!this._foldingModel || line === null) {\n            return;\n        }\n        const stickyLine = this._stickyScrollWidget.getStickyLineForLine(line);\n        const foldingIcon = stickyLine === null || stickyLine === void 0 ? void 0 : stickyLine.foldingIcon;\n        if (!foldingIcon) {\n            return;\n        }\n        toggleCollapseState(this._foldingModel, Number.MAX_VALUE, [line]);\n        foldingIcon.isCollapsed = !foldingIcon.isCollapsed;\n        const scrollTop = (foldingIcon.isCollapsed ?\n            this._editor.getTopForLineNumber(foldingIcon.foldingEndLine)\n            : this._editor.getTopForLineNumber(foldingIcon.foldingStartLine))\n            - this._editor.getOption(66 /* EditorOption.lineHeight */) * stickyLine.index + 1;\n        this._editor.setScrollTop(scrollTop);\n        this._renderStickyScroll(line);\n    }\n    _readConfiguration() {\n        const options = this._editor.getOption(114 /* EditorOption.stickyScroll */);\n        if (options.enabled === false) {\n            this._editor.removeOverlayWidget(this._stickyScrollWidget);\n            this._sessionStore.clear();\n            this._enabled = false;\n            return;\n        }\n        else if (options.enabled && !this._enabled) {\n            // When sticky scroll was just enabled, add the listeners on the sticky scroll\n            this._editor.addOverlayWidget(this._stickyScrollWidget);\n            this._sessionStore.add(this._editor.onDidScrollChange((e) => {\n                if (e.scrollTopChanged) {\n                    this._showEndForLine = null;\n                    this._renderStickyScroll();\n                }\n            }));\n            this._sessionStore.add(this._editor.onDidLayoutChange(() => this._onDidResize()));\n            this._sessionStore.add(this._editor.onDidChangeModelTokens((e) => this._onTokensChange(e)));\n            this._sessionStore.add(this._stickyLineCandidateProvider.onDidChangeStickyScroll(() => {\n                this._showEndForLine = null;\n                this._renderStickyScroll();\n            }));\n            this._enabled = true;\n        }\n        const lineNumberOption = this._editor.getOption(67 /* EditorOption.lineNumbers */);\n        if (lineNumberOption.renderType === 2 /* RenderLineNumbersType.Relative */) {\n            this._sessionStore.add(this._editor.onDidChangeCursorPosition(() => {\n                this._showEndForLine = null;\n                this._renderStickyScroll();\n            }));\n        }\n    }\n    _needsUpdate(event) {\n        const stickyLineNumbers = this._stickyScrollWidget.getCurrentLines();\n        for (const stickyLineNumber of stickyLineNumbers) {\n            for (const range of event.ranges) {\n                if (stickyLineNumber >= range.fromLineNumber && stickyLineNumber <= range.toLineNumber) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n    _onTokensChange(event) {\n        if (this._needsUpdate(event)) {\n            // Rebuilding the whole widget from line -1\n            this._renderStickyScroll(-1);\n        }\n    }\n    _onDidResize() {\n        const layoutInfo = this._editor.getLayoutInfo();\n        // Make sure sticky scroll doesn't take up more than 25% of the editor\n        const theoreticalLines = layoutInfo.height / this._editor.getOption(66 /* EditorOption.lineHeight */);\n        this._maxStickyLines = Math.round(theoreticalLines * .25);\n    }\n    _renderStickyScroll(rebuildFromLine = Infinity) {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function* () {\n            const model = this._editor.getModel();\n            if (!model || model.isTooLargeForTokenization()) {\n                this._foldingModel = null;\n                this._stickyScrollWidget.setState(undefined, null, rebuildFromLine);\n                return;\n            }\n            const stickyLineVersion = this._stickyLineCandidateProvider.getVersionId();\n            if (stickyLineVersion === undefined || stickyLineVersion === model.getVersionId()) {\n                this._foldingModel = (_b = yield ((_a = FoldingController.get(this._editor)) === null || _a === void 0 ? void 0 : _a.getFoldingModel())) !== null && _b !== void 0 ? _b : null;\n                this._widgetState = this.findScrollWidgetState();\n                this._stickyScrollVisibleContextKey.set(!(this._widgetState.startLineNumbers.length === 0));\n                if (!this._focused) {\n                    this._stickyScrollWidget.setState(this._widgetState, this._foldingModel, rebuildFromLine);\n                }\n                else {\n                    // Suppose that previously the sticky scroll widget had height 0, then if there are visible lines, set the last line as focused\n                    if (this._focusedStickyElementIndex === -1) {\n                        this._stickyScrollWidget.setState(this._widgetState, this._foldingModel, rebuildFromLine);\n                        this._focusedStickyElementIndex = this._stickyScrollWidget.lineNumberCount - 1;\n                        if (this._focusedStickyElementIndex !== -1) {\n                            this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);\n                        }\n                    }\n                    else {\n                        const focusedStickyElementLineNumber = this._stickyScrollWidget.lineNumbers[this._focusedStickyElementIndex];\n                        this._stickyScrollWidget.setState(this._widgetState, this._foldingModel, rebuildFromLine);\n                        // Suppose that after setting the state, there are no sticky lines, set the focused index to -1\n                        if (this._stickyScrollWidget.lineNumberCount === 0) {\n                            this._focusedStickyElementIndex = -1;\n                        }\n                        else {\n                            const previousFocusedLineNumberExists = this._stickyScrollWidget.lineNumbers.includes(focusedStickyElementLineNumber);\n                            // If the line number is still there, do not change anything\n                            // If the line number is not there, set the new focused line to be the last line\n                            if (!previousFocusedLineNumberExists) {\n                                this._focusedStickyElementIndex = this._stickyScrollWidget.lineNumberCount - 1;\n                            }\n                            this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);\n                        }\n                    }\n                }\n            }\n        });\n    }\n    findScrollWidgetState() {\n        const lineHeight = this._editor.getOption(66 /* EditorOption.lineHeight */);\n        const maxNumberStickyLines = Math.min(this._maxStickyLines, this._editor.getOption(114 /* EditorOption.stickyScroll */).maxLineCount);\n        const scrollTop = this._editor.getScrollTop();\n        let lastLineRelativePosition = 0;\n        const startLineNumbers = [];\n        const endLineNumbers = [];\n        const arrayVisibleRanges = this._editor.getVisibleRanges();\n        if (arrayVisibleRanges.length !== 0) {\n            const fullVisibleRange = new StickyRange(arrayVisibleRanges[0].startLineNumber, arrayVisibleRanges[arrayVisibleRanges.length - 1].endLineNumber);\n            const candidateRanges = this._stickyLineCandidateProvider.getCandidateStickyLinesIntersecting(fullVisibleRange);\n            for (const range of candidateRanges) {\n                const start = range.startLineNumber;\n                const end = range.endLineNumber;\n                const depth = range.nestingDepth;\n                if (end - start > 0) {\n                    const topOfElementAtDepth = (depth - 1) * lineHeight;\n                    const bottomOfElementAtDepth = depth * lineHeight;\n                    const bottomOfBeginningLine = this._editor.getBottomForLineNumber(start) - scrollTop;\n                    const topOfEndLine = this._editor.getTopForLineNumber(end) - scrollTop;\n                    const bottomOfEndLine = this._editor.getBottomForLineNumber(end) - scrollTop;\n                    if (topOfElementAtDepth > topOfEndLine && topOfElementAtDepth <= bottomOfEndLine) {\n                        startLineNumbers.push(start);\n                        endLineNumbers.push(end + 1);\n                        lastLineRelativePosition = bottomOfEndLine - bottomOfElementAtDepth;\n                        break;\n                    }\n                    else if (bottomOfElementAtDepth > bottomOfBeginningLine && bottomOfElementAtDepth <= bottomOfEndLine) {\n                        startLineNumbers.push(start);\n                        endLineNumbers.push(end + 1);\n                    }\n                    if (startLineNumbers.length === maxNumberStickyLines) {\n                        break;\n                    }\n                }\n            }\n        }\n        this._endLineNumbers = endLineNumbers;\n        return new StickyScrollWidgetState(startLineNumbers, endLineNumbers, lastLineRelativePosition, this._showEndForLine);\n    }\n    dispose() {\n        super.dispose();\n        this._sessionStore.dispose();\n    }\n};\nStickyScrollController.ID = 'store.contrib.stickyScrollController';\nStickyScrollController = StickyScrollController_1 = __decorate([\n    __param(1, IContextMenuService),\n    __param(2, ILanguageFeaturesService),\n    __param(3, IInstantiationService),\n    __param(4, ILanguageConfigurationService),\n    __param(5, ILanguageFeatureDebounceService),\n    __param(6, IContextKeyService)\n], StickyScrollController);\nexport { StickyScrollController };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}