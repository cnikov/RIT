{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { $, h } from '../../../../base/browser/dom.js';\nimport { findLast } from '../../../../base/common/arraysFind.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { toDisposable } from '../../../../base/common/lifecycle.js';\nimport { autorun, autorunWithStore, derived, derivedWithStore, disposableObservableValue, recomputeInitiallyAndOnChange, observableValue, transaction } from '../../../../base/common/observable.js';\nimport './style.css';\nimport { EditorExtensionsRegistry } from '../../editorExtensions.js';\nimport { ICodeEditorService } from '../../services/codeEditorService.js';\nimport { CodeEditorWidget } from '../codeEditorWidget.js';\nimport { AccessibleDiffViewer } from './accessibleDiffViewer.js';\nimport { DiffEditorDecorations } from './diffEditorDecorations.js';\nimport { DiffEditorSash } from './diffEditorSash.js';\nimport { HideUnchangedRegionsFeature } from './hideUnchangedRegionsFeature.js';\nimport { ViewZoneManager } from './lineAlignment.js';\nimport { MovedBlocksLinesPart } from './movedBlocksLines.js';\nimport { OverviewRulerPart } from './overviewRulerPart.js';\nimport { ObservableElementSizeObserver, applyStyle, readHotReloadableExport } from './utils.js';\nimport { Position } from '../../../common/core/position.js';\nimport { Range } from '../../../common/core/range.js';\nimport { EditorType } from '../../../common/editorCommon.js';\nimport { EditorContextKeys } from '../../../common/editorContextKeys.js';\nimport { LengthObj } from '../../../common/model/bracketPairsTextModelPart/bracketPairsTree/length.js';\nimport { AudioCue, IAudioCueService } from '../../../../platform/audioCues/browser/audioCueService.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { IEditorProgressService } from '../../../../platform/progress/common/progress.js';\nimport './colors.js';\nimport { DelegatingEditor } from './delegatingEditorImpl.js';\nimport { DiffEditorEditors } from './diffEditorEditors.js';\nimport { DiffEditorOptions } from './diffEditorOptions.js';\nimport { DiffEditorViewModel } from './diffEditorViewModel.js';\nlet DiffEditorWidget = class DiffEditorWidget extends DelegatingEditor {\n  constructor(_domElement, options, codeEditorWidgetOptions, _parentContextKeyService, _parentInstantiationService, codeEditorService, _audioCueService, _editorProgressService) {\n    var _a;\n    super();\n    this._domElement = _domElement;\n    this._parentContextKeyService = _parentContextKeyService;\n    this._parentInstantiationService = _parentInstantiationService;\n    this._audioCueService = _audioCueService;\n    this._editorProgressService = _editorProgressService;\n    this.elements = h('div.monaco-diff-editor.side-by-side', {\n      style: {\n        position: 'relative',\n        height: '100%'\n      }\n    }, [h('div.noModificationsOverlay@overlay', {\n      style: {\n        position: 'absolute',\n        height: '100%',\n        visibility: 'hidden'\n      }\n    }, [$('span', {}, 'No Changes')]), h('div.editor.original@original', {\n      style: {\n        position: 'absolute',\n        height: '100%'\n      }\n    }), h('div.editor.modified@modified', {\n      style: {\n        position: 'absolute',\n        height: '100%'\n      }\n    }), h('div.accessibleDiffViewer@accessibleDiffViewer', {\n      style: {\n        position: 'absolute',\n        height: '100%'\n      }\n    })]);\n    this._diffModel = this._register(disposableObservableValue('diffModel', undefined));\n    this.onDidChangeModel = Event.fromObservableLight(this._diffModel);\n    this._contextKeyService = this._register(this._parentContextKeyService.createScoped(this._domElement));\n    this._instantiationService = this._parentInstantiationService.createChild(new ServiceCollection([IContextKeyService, this._contextKeyService]));\n    this._boundarySashes = observableValue(this, undefined);\n    this._accessibleDiffViewerShouldBeVisible = observableValue(this, false);\n    this._accessibleDiffViewerVisible = derived(this, reader => this._options.onlyShowAccessibleDiffViewer.read(reader) ? true : this._accessibleDiffViewerShouldBeVisible.read(reader));\n    this.movedBlocksLinesPart = observableValue(this, undefined);\n    this._layoutInfo = derived(this, reader => {\n      var _a, _b, _c;\n      const width = this._rootSizeObserver.width.read(reader);\n      const height = this._rootSizeObserver.height.read(reader);\n      const sashLeft = (_a = this._sash.read(reader)) === null || _a === void 0 ? void 0 : _a.sashLeft.read(reader);\n      const originalWidth = sashLeft !== null && sashLeft !== void 0 ? sashLeft : Math.max(5, this._editors.original.getLayoutInfo().decorationsLeft);\n      const modifiedWidth = width - originalWidth - (this._options.renderOverviewRuler.read(reader) ? OverviewRulerPart.ENTIRE_DIFF_OVERVIEW_WIDTH : 0);\n      const movedBlocksLinesWidth = (_c = (_b = this.movedBlocksLinesPart.read(reader)) === null || _b === void 0 ? void 0 : _b.width.read(reader)) !== null && _c !== void 0 ? _c : 0;\n      const originalWidthWithoutMovedBlockLines = originalWidth - movedBlocksLinesWidth;\n      this.elements.original.style.width = originalWidthWithoutMovedBlockLines + 'px';\n      this.elements.original.style.left = '0px';\n      this.elements.modified.style.width = modifiedWidth + 'px';\n      this.elements.modified.style.left = originalWidth + 'px';\n      this._editors.original.layout({\n        width: originalWidthWithoutMovedBlockLines,\n        height\n      });\n      this._editors.modified.layout({\n        width: modifiedWidth,\n        height\n      });\n      return {\n        modifiedEditor: this._editors.modified.getLayoutInfo(),\n        originalEditor: this._editors.original.getLayoutInfo()\n      };\n    });\n    this._diffValue = this._diffModel.map((m, r) => m === null || m === void 0 ? void 0 : m.diff.read(r));\n    this.onDidUpdateDiff = Event.fromObservableLight(this._diffValue);\n    codeEditorService.willCreateDiffEditor();\n    this._contextKeyService.createKey('isInDiffEditor', true);\n    this._domElement.appendChild(this.elements.root);\n    this._register(toDisposable(() => this._domElement.removeChild(this.elements.root)));\n    this._rootSizeObserver = this._register(new ObservableElementSizeObserver(this.elements.root, options.dimension));\n    this._rootSizeObserver.setAutomaticLayout((_a = options.automaticLayout) !== null && _a !== void 0 ? _a : false);\n    this._options = new DiffEditorOptions(options, this._rootSizeObserver.width);\n    this._contextKeyService.createKey(EditorContextKeys.isEmbeddedDiffEditor.key, false);\n    const isEmbeddedDiffEditorKey = EditorContextKeys.isEmbeddedDiffEditor.bindTo(this._contextKeyService);\n    this._register(autorun(reader => {\n      /** @description update isEmbeddedDiffEditorKey */\n      isEmbeddedDiffEditorKey.set(this._options.isInEmbeddedEditor.read(reader));\n    }));\n    const comparingMovedCodeKey = EditorContextKeys.comparingMovedCode.bindTo(this._contextKeyService);\n    this._register(autorun(reader => {\n      var _a;\n      /** @description update comparingMovedCodeKey */\n      comparingMovedCodeKey.set(!!((_a = this._diffModel.read(reader)) === null || _a === void 0 ? void 0 : _a.movedTextToCompare.read(reader)));\n    }));\n    const diffEditorRenderSideBySideInlineBreakpointReachedContextKeyValue = EditorContextKeys.diffEditorRenderSideBySideInlineBreakpointReached.bindTo(this._contextKeyService);\n    this._register(autorun(reader => {\n      /** @description update accessibleDiffViewerVisible context key */\n      diffEditorRenderSideBySideInlineBreakpointReachedContextKeyValue.set(this._options.couldShowInlineViewBecauseOfSize.read(reader));\n    }));\n    this._editors = this._register(this._instantiationService.createInstance(DiffEditorEditors, this.elements.original, this.elements.modified, this._options, codeEditorWidgetOptions, (i, c, o, o2) => this._createInnerEditor(i, c, o, o2)));\n    this._sash = derivedWithStore(this, (reader, store) => {\n      const showSash = this._options.renderSideBySide.read(reader);\n      this.elements.root.classList.toggle('side-by-side', showSash);\n      if (!showSash) {\n        return undefined;\n      }\n      const result = store.add(new DiffEditorSash(this._options, this.elements.root, {\n        height: this._rootSizeObserver.height,\n        width: this._rootSizeObserver.width.map((w, reader) => w - (this._options.renderOverviewRuler.read(reader) ? OverviewRulerPart.ENTIRE_DIFF_OVERVIEW_WIDTH : 0))\n      }));\n      store.add(autorun(reader => {\n        /** @description setBoundarySashes */\n        const boundarySashes = this._boundarySashes.read(reader);\n        if (boundarySashes) {\n          result.setBoundarySashes(boundarySashes);\n        }\n      }));\n      return result;\n    });\n    this._register(recomputeInitiallyAndOnChange(this._sash));\n    this._register(autorunWithStore((reader, store) => {\n      /** @description UnchangedRangesFeature */\n      this.unchangedRangesFeature = store.add(this._instantiationService.createInstance(readHotReloadableExport(HideUnchangedRegionsFeature, reader), this._editors, this._diffModel, this._options));\n    }));\n    this._register(autorunWithStore((reader, store) => {\n      /** @description DiffEditorDecorations */\n      store.add(new (readHotReloadableExport(DiffEditorDecorations, reader))(this._editors, this._diffModel, this._options));\n    }));\n    this._register(autorunWithStore((reader, store) => {\n      /** @description ViewZoneManager */\n      store.add(this._instantiationService.createInstance(readHotReloadableExport(ViewZoneManager, reader), this._editors, this._diffModel, this._options, this, () => this.unchangedRangesFeature.isUpdatingViewZones));\n    }));\n    this._register(autorunWithStore((reader, store) => {\n      /** @description OverviewRulerPart */\n      store.add(this._instantiationService.createInstance(readHotReloadableExport(OverviewRulerPart, reader), this._editors, this.elements.root, this._diffModel, this._rootSizeObserver.width, this._rootSizeObserver.height, this._layoutInfo.map(i => i.modifiedEditor), this._options));\n    }));\n    this._register(autorunWithStore((reader, store) => {\n      /** @description _accessibleDiffViewer */\n      this._accessibleDiffViewer = store.add(this._register(this._instantiationService.createInstance(readHotReloadableExport(AccessibleDiffViewer, reader), this.elements.accessibleDiffViewer, this._accessibleDiffViewerVisible, (visible, tx) => this._accessibleDiffViewerShouldBeVisible.set(visible, tx), this._options.onlyShowAccessibleDiffViewer.map(v => !v), this._rootSizeObserver.width, this._rootSizeObserver.height, this._diffModel.map((m, r) => {\n        var _a;\n        return (_a = m === null || m === void 0 ? void 0 : m.diff.read(r)) === null || _a === void 0 ? void 0 : _a.mappings.map(m => m.lineRangeMapping);\n      }), this._editors)));\n    }));\n    const visibility = this._accessibleDiffViewerVisible.map(v => v ? 'hidden' : 'visible');\n    this._register(applyStyle(this.elements.modified, {\n      visibility\n    }));\n    this._register(applyStyle(this.elements.original, {\n      visibility\n    }));\n    this._createDiffEditorContributions();\n    codeEditorService.addDiffEditor(this);\n    this._register(recomputeInitiallyAndOnChange(this._layoutInfo));\n    this._register(autorunWithStore((reader, store) => {\n      this.movedBlocksLinesPart.set(store.add(new (readHotReloadableExport(MovedBlocksLinesPart, reader))(this.elements.root, this._diffModel, this._layoutInfo.map(i => i.originalEditor), this._layoutInfo.map(i => i.modifiedEditor), this._editors)), undefined);\n    }));\n    this._register(applyStyle(this.elements.overlay, {\n      width: this._layoutInfo.map((i, r) => i.originalEditor.width + (this._options.renderSideBySide.read(r) ? 0 : i.modifiedEditor.width)),\n      visibility: derived(reader => /** @description visibility */{\n        var _a, _b;\n        return this._options.hideUnchangedRegions.read(reader) && ((_b = (_a = this._diffModel.read(reader)) === null || _a === void 0 ? void 0 : _a.diff.read(reader)) === null || _b === void 0 ? void 0 : _b.mappings.length) === 0 ? 'visible' : 'hidden';\n      })\n    }));\n    // Revert change when an arrow is clicked.\n    this._register(this._editors.modified.onMouseDown(event => {\n      var _a, _b;\n      if (!event.event.rightButton && event.target.position && ((_a = event.target.element) === null || _a === void 0 ? void 0 : _a.className.includes('arrow-revert-change'))) {\n        const lineNumber = event.target.position.lineNumber;\n        const viewZone = event.target;\n        const model = this._diffModel.get();\n        if (!model) {\n          return;\n        }\n        const diffs = (_b = model.diff.get()) === null || _b === void 0 ? void 0 : _b.mappings;\n        if (!diffs) {\n          return;\n        }\n        const diff = diffs.find(d => (viewZone === null || viewZone === void 0 ? void 0 : viewZone.detail.afterLineNumber) === d.lineRangeMapping.modified.startLineNumber - 1 || d.lineRangeMapping.modified.startLineNumber === lineNumber);\n        if (!diff) {\n          return;\n        }\n        this.revert(diff.lineRangeMapping);\n        event.event.stopPropagation();\n      }\n    }));\n    this._register(Event.runAndSubscribe(this._editors.modified.onDidChangeCursorPosition, e => {\n      var _a, _b;\n      if ((e === null || e === void 0 ? void 0 : e.reason) === 3 /* CursorChangeReason.Explicit */) {\n        const diff = (_b = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.diff.get()) === null || _b === void 0 ? void 0 : _b.mappings.find(m => m.lineRangeMapping.modified.contains(e.position.lineNumber));\n        if (diff === null || diff === void 0 ? void 0 : diff.lineRangeMapping.modified.isEmpty) {\n          this._audioCueService.playAudioCue(AudioCue.diffLineDeleted, {\n            source: 'diffEditor.cursorPositionChanged'\n          });\n        } else if (diff === null || diff === void 0 ? void 0 : diff.lineRangeMapping.original.isEmpty) {\n          this._audioCueService.playAudioCue(AudioCue.diffLineInserted, {\n            source: 'diffEditor.cursorPositionChanged'\n          });\n        } else if (diff) {\n          this._audioCueService.playAudioCue(AudioCue.diffLineModified, {\n            source: 'diffEditor.cursorPositionChanged'\n          });\n        }\n      }\n    }));\n    const isDiffUpToDate = this._diffModel.map((m, reader) => m === null || m === void 0 ? void 0 : m.isDiffUpToDate.read(reader));\n    this._register(autorunWithStore((reader, store) => {\n      if (isDiffUpToDate.read(reader) === false) {\n        const r = this._editorProgressService.show(true, 1000);\n        store.add(toDisposable(() => r.done()));\n      }\n    }));\n  }\n  _createInnerEditor(instantiationService, container, options, editorWidgetOptions) {\n    const editor = instantiationService.createInstance(CodeEditorWidget, container, options, editorWidgetOptions);\n    return editor;\n  }\n  _createDiffEditorContributions() {\n    const contributions = EditorExtensionsRegistry.getDiffEditorContributions();\n    for (const desc of contributions) {\n      try {\n        this._register(this._instantiationService.createInstance(desc.ctor, this));\n      } catch (err) {\n        onUnexpectedError(err);\n      }\n    }\n  }\n  get _targetEditor() {\n    return this._editors.modified;\n  }\n  getEditorType() {\n    return EditorType.IDiffEditor;\n  }\n  layout(dimension) {\n    this._rootSizeObserver.observe(dimension);\n  }\n  hasTextFocus() {\n    return this._editors.original.hasTextFocus() || this._editors.modified.hasTextFocus();\n  }\n  saveViewState() {\n    var _a;\n    const originalViewState = this._editors.original.saveViewState();\n    const modifiedViewState = this._editors.modified.saveViewState();\n    return {\n      original: originalViewState,\n      modified: modifiedViewState,\n      modelState: (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.serializeState()\n    };\n  }\n  restoreViewState(s) {\n    var _a;\n    if (s && s.original && s.modified) {\n      const diffEditorState = s;\n      this._editors.original.restoreViewState(diffEditorState.original);\n      this._editors.modified.restoreViewState(diffEditorState.modified);\n      if (diffEditorState.modelState) {\n        (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.restoreSerializedState(diffEditorState.modelState);\n      }\n    }\n  }\n  createViewModel(model) {\n    return this._instantiationService.createInstance(DiffEditorViewModel, model, this._options, this);\n  }\n  getModel() {\n    var _a, _b;\n    return (_b = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.model) !== null && _b !== void 0 ? _b : null;\n  }\n  setModel(model) {\n    if (!model && this._diffModel.get()) {\n      // Transitioning from a model to no-model\n      this._accessibleDiffViewer.close();\n    }\n    const vm = model ? 'model' in model ? model : this.createViewModel(model) : undefined;\n    this._editors.original.setModel(vm ? vm.model.original : null);\n    this._editors.modified.setModel(vm ? vm.model.modified : null);\n    transaction(tx => {\n      this._diffModel.set(vm, tx);\n    });\n  }\n  /**\n   * @param changedOptions Only has values for top-level options that have actually changed.\n   */\n  updateOptions(changedOptions) {\n    this._options.updateOptions(changedOptions);\n  }\n  getContainerDomNode() {\n    return this._domElement;\n  }\n  getOriginalEditor() {\n    return this._editors.original;\n  }\n  getModifiedEditor() {\n    return this._editors.modified;\n  }\n  /**\n   * @deprecated Use `this.getDiffComputationResult().changes2` instead.\n   */\n  getLineChanges() {\n    var _a;\n    const diffState = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.diff.get();\n    if (!diffState) {\n      return null;\n    }\n    return toLineChanges(diffState);\n  }\n  revert(diff) {\n    var _a;\n    const model = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.model;\n    if (!model) {\n      return;\n    }\n    const changes = diff.innerChanges ? diff.innerChanges.map(c => ({\n      range: c.modifiedRange,\n      text: model.original.getValueInRange(c.originalRange)\n    })) : [{\n      range: diff.modified.toExclusiveRange(),\n      text: model.original.getValueInRange(diff.original.toExclusiveRange())\n    }];\n    this._editors.modified.executeEdits('diffEditor', changes);\n  }\n  accessibleDiffViewerNext() {\n    this._accessibleDiffViewer.next();\n  }\n  accessibleDiffViewerPrev() {\n    this._accessibleDiffViewer.prev();\n  }\n  mapToOtherSide() {\n    var _a, _b;\n    const isModifiedFocus = this._editors.modified.hasWidgetFocus();\n    const source = isModifiedFocus ? this._editors.modified : this._editors.original;\n    const destination = isModifiedFocus ? this._editors.original : this._editors.modified;\n    let destinationSelection;\n    const sourceSelection = source.getSelection();\n    if (sourceSelection) {\n      const mappings = (_b = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.diff.get()) === null || _b === void 0 ? void 0 : _b.mappings.map(m => isModifiedFocus ? m.lineRangeMapping.flip() : m.lineRangeMapping);\n      if (mappings) {\n        const newRange1 = translatePosition(sourceSelection.getStartPosition(), mappings);\n        const newRange2 = translatePosition(sourceSelection.getEndPosition(), mappings);\n        destinationSelection = Range.plusRange(newRange1, newRange2);\n      }\n    }\n    return {\n      destination,\n      destinationSelection\n    };\n  }\n  switchSide() {\n    const {\n      destination,\n      destinationSelection\n    } = this.mapToOtherSide();\n    destination.focus();\n    if (destinationSelection) {\n      destination.setSelection(destinationSelection);\n    }\n  }\n  exitCompareMove() {\n    const model = this._diffModel.get();\n    if (!model) {\n      return;\n    }\n    model.movedTextToCompare.set(undefined, undefined);\n  }\n  collapseAllUnchangedRegions() {\n    var _a;\n    const unchangedRegions = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.unchangedRegions.get();\n    if (!unchangedRegions) {\n      return;\n    }\n    transaction(tx => {\n      for (const region of unchangedRegions) {\n        region.collapseAll(tx);\n      }\n    });\n  }\n  showAllUnchangedRegions() {\n    var _a;\n    const unchangedRegions = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.unchangedRegions.get();\n    if (!unchangedRegions) {\n      return;\n    }\n    transaction(tx => {\n      for (const region of unchangedRegions) {\n        region.showAll(tx);\n      }\n    });\n  }\n};\nDiffEditorWidget = __decorate([__param(3, IContextKeyService), __param(4, IInstantiationService), __param(5, ICodeEditorService), __param(6, IAudioCueService), __param(7, IEditorProgressService)], DiffEditorWidget);\nexport { DiffEditorWidget };\nfunction translatePosition(posInOriginal, mappings) {\n  const mapping = findLast(mappings, m => m.original.startLineNumber <= posInOriginal.lineNumber);\n  if (!mapping) {\n    // No changes before the position\n    return Range.fromPositions(posInOriginal);\n  }\n  if (mapping.original.endLineNumberExclusive <= posInOriginal.lineNumber) {\n    const newLineNumber = posInOriginal.lineNumber - mapping.original.endLineNumberExclusive + mapping.modified.endLineNumberExclusive;\n    return Range.fromPositions(new Position(newLineNumber, posInOriginal.column));\n  }\n  if (!mapping.innerChanges) {\n    // Only for legacy algorithm\n    return Range.fromPositions(new Position(mapping.modified.startLineNumber, 1));\n  }\n  const innerMapping = findLast(mapping.innerChanges, m => m.originalRange.getStartPosition().isBeforeOrEqual(posInOriginal));\n  if (!innerMapping) {\n    const newLineNumber = posInOriginal.lineNumber - mapping.original.startLineNumber + mapping.modified.startLineNumber;\n    return Range.fromPositions(new Position(newLineNumber, posInOriginal.column));\n  }\n  if (innerMapping.originalRange.containsPosition(posInOriginal)) {\n    return innerMapping.modifiedRange;\n  } else {\n    const l = lengthBetweenPositions(innerMapping.originalRange.getEndPosition(), posInOriginal);\n    return Range.fromPositions(addLength(innerMapping.modifiedRange.getEndPosition(), l));\n  }\n}\nfunction lengthBetweenPositions(position1, position2) {\n  if (position1.lineNumber === position2.lineNumber) {\n    return new LengthObj(0, position2.column - position1.column);\n  } else {\n    return new LengthObj(position2.lineNumber - position1.lineNumber, position2.column - 1);\n  }\n}\nfunction addLength(position, length) {\n  if (length.lineCount === 0) {\n    return new Position(position.lineNumber, position.column + length.columnCount);\n  } else {\n    return new Position(position.lineNumber + length.lineCount, length.columnCount + 1);\n  }\n}\nfunction toLineChanges(state) {\n  return state.mappings.map(x => {\n    const m = x.lineRangeMapping;\n    let originalStartLineNumber;\n    let originalEndLineNumber;\n    let modifiedStartLineNumber;\n    let modifiedEndLineNumber;\n    let innerChanges = m.innerChanges;\n    if (m.original.isEmpty) {\n      // Insertion\n      originalStartLineNumber = m.original.startLineNumber - 1;\n      originalEndLineNumber = 0;\n      innerChanges = undefined;\n    } else {\n      originalStartLineNumber = m.original.startLineNumber;\n      originalEndLineNumber = m.original.endLineNumberExclusive - 1;\n    }\n    if (m.modified.isEmpty) {\n      // Deletion\n      modifiedStartLineNumber = m.modified.startLineNumber - 1;\n      modifiedEndLineNumber = 0;\n      innerChanges = undefined;\n    } else {\n      modifiedStartLineNumber = m.modified.startLineNumber;\n      modifiedEndLineNumber = m.modified.endLineNumberExclusive - 1;\n    }\n    return {\n      originalStartLineNumber,\n      originalEndLineNumber,\n      modifiedStartLineNumber,\n      modifiedEndLineNumber,\n      charChanges: innerChanges === null || innerChanges === void 0 ? void 0 : innerChanges.map(m => ({\n        originalStartLineNumber: m.originalRange.startLineNumber,\n        originalStartColumn: m.originalRange.startColumn,\n        originalEndLineNumber: m.originalRange.endLineNumber,\n        originalEndColumn: m.originalRange.endColumn,\n        modifiedStartLineNumber: m.modifiedRange.startLineNumber,\n        modifiedStartColumn: m.modifiedRange.startColumn,\n        modifiedEndLineNumber: m.modifiedRange.endLineNumber,\n        modifiedEndColumn: m.modifiedRange.endColumn\n      }))\n    };\n  });\n}","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","$","h","findLast","onUnexpectedError","Event","toDisposable","autorun","autorunWithStore","derived","derivedWithStore","disposableObservableValue","recomputeInitiallyAndOnChange","observableValue","transaction","EditorExtensionsRegistry","ICodeEditorService","CodeEditorWidget","AccessibleDiffViewer","DiffEditorDecorations","DiffEditorSash","HideUnchangedRegionsFeature","ViewZoneManager","MovedBlocksLinesPart","OverviewRulerPart","ObservableElementSizeObserver","applyStyle","readHotReloadableExport","Position","Range","EditorType","EditorContextKeys","LengthObj","AudioCue","IAudioCueService","IContextKeyService","IInstantiationService","ServiceCollection","IEditorProgressService","DelegatingEditor","DiffEditorEditors","DiffEditorOptions","DiffEditorViewModel","DiffEditorWidget","constructor","_domElement","options","codeEditorWidgetOptions","_parentContextKeyService","_parentInstantiationService","codeEditorService","_audioCueService","_editorProgressService","_a","elements","style","position","height","visibility","_diffModel","_register","undefined","onDidChangeModel","fromObservableLight","_contextKeyService","createScoped","_instantiationService","createChild","_boundarySashes","_accessibleDiffViewerShouldBeVisible","_accessibleDiffViewerVisible","reader","_options","onlyShowAccessibleDiffViewer","read","movedBlocksLinesPart","_layoutInfo","_b","_c","width","_rootSizeObserver","sashLeft","_sash","originalWidth","Math","max","_editors","original","getLayoutInfo","decorationsLeft","modifiedWidth","renderOverviewRuler","ENTIRE_DIFF_OVERVIEW_WIDTH","movedBlocksLinesWidth","originalWidthWithoutMovedBlockLines","left","modified","layout","modifiedEditor","originalEditor","_diffValue","map","m","diff","onDidUpdateDiff","willCreateDiffEditor","createKey","appendChild","root","removeChild","dimension","setAutomaticLayout","automaticLayout","isEmbeddedDiffEditor","isEmbeddedDiffEditorKey","bindTo","set","isInEmbeddedEditor","comparingMovedCodeKey","comparingMovedCode","movedTextToCompare","diffEditorRenderSideBySideInlineBreakpointReachedContextKeyValue","diffEditorRenderSideBySideInlineBreakpointReached","couldShowInlineViewBecauseOfSize","createInstance","o","o2","_createInnerEditor","store","showSash","renderSideBySide","classList","toggle","result","add","w","boundarySashes","setBoundarySashes","unchangedRangesFeature","isUpdatingViewZones","_accessibleDiffViewer","accessibleDiffViewer","visible","tx","v","mappings","lineRangeMapping","_createDiffEditorContributions","addDiffEditor","overlay","hideUnchangedRegions","onMouseDown","event","rightButton","element","className","includes","lineNumber","viewZone","model","get","diffs","find","detail","afterLineNumber","startLineNumber","revert","stopPropagation","runAndSubscribe","onDidChangeCursorPosition","e","reason","contains","isEmpty","playAudioCue","diffLineDeleted","source","diffLineInserted","diffLineModified","isDiffUpToDate","show","done","instantiationService","container","editorWidgetOptions","editor","contributions","getDiffEditorContributions","ctor","err","_targetEditor","getEditorType","IDiffEditor","observe","hasTextFocus","saveViewState","originalViewState","modifiedViewState","modelState","serializeState","restoreViewState","s","diffEditorState","restoreSerializedState","createViewModel","getModel","setModel","close","vm","updateOptions","changedOptions","getContainerDomNode","getOriginalEditor","getModifiedEditor","getLineChanges","diffState","toLineChanges","changes","innerChanges","range","modifiedRange","text","getValueInRange","originalRange","toExclusiveRange","executeEdits","accessibleDiffViewerNext","next","accessibleDiffViewerPrev","prev","mapToOtherSide","isModifiedFocus","hasWidgetFocus","destination","destinationSelection","sourceSelection","getSelection","flip","newRange1","translatePosition","getStartPosition","newRange2","getEndPosition","plusRange","switchSide","focus","setSelection","exitCompareMove","collapseAllUnchangedRegions","unchangedRegions","region","collapseAll","showAllUnchangedRegions","showAll","posInOriginal","mapping","fromPositions","endLineNumberExclusive","newLineNumber","column","innerMapping","isBeforeOrEqual","containsPosition","l","lengthBetweenPositions","addLength","position1","position2","lineCount","columnCount","state","x","originalStartLineNumber","originalEndLineNumber","modifiedStartLineNumber","modifiedEndLineNumber","charChanges","originalStartColumn","startColumn","endLineNumber","originalEndColumn","endColumn","modifiedStartColumn","modifiedEndColumn"],"sources":["/home/chlohest/work/website/my_web/node_modules/monaco-editor/esm/vs/editor/browser/widget/diffEditor/diffEditorWidget.js"],"sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { $, h } from '../../../../base/browser/dom.js';\nimport { findLast } from '../../../../base/common/arraysFind.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { toDisposable } from '../../../../base/common/lifecycle.js';\nimport { autorun, autorunWithStore, derived, derivedWithStore, disposableObservableValue, recomputeInitiallyAndOnChange, observableValue, transaction } from '../../../../base/common/observable.js';\nimport './style.css';\nimport { EditorExtensionsRegistry } from '../../editorExtensions.js';\nimport { ICodeEditorService } from '../../services/codeEditorService.js';\nimport { CodeEditorWidget } from '../codeEditorWidget.js';\nimport { AccessibleDiffViewer } from './accessibleDiffViewer.js';\nimport { DiffEditorDecorations } from './diffEditorDecorations.js';\nimport { DiffEditorSash } from './diffEditorSash.js';\nimport { HideUnchangedRegionsFeature } from './hideUnchangedRegionsFeature.js';\nimport { ViewZoneManager } from './lineAlignment.js';\nimport { MovedBlocksLinesPart } from './movedBlocksLines.js';\nimport { OverviewRulerPart } from './overviewRulerPart.js';\nimport { ObservableElementSizeObserver, applyStyle, readHotReloadableExport } from './utils.js';\nimport { Position } from '../../../common/core/position.js';\nimport { Range } from '../../../common/core/range.js';\nimport { EditorType } from '../../../common/editorCommon.js';\nimport { EditorContextKeys } from '../../../common/editorContextKeys.js';\nimport { LengthObj } from '../../../common/model/bracketPairsTextModelPart/bracketPairsTree/length.js';\nimport { AudioCue, IAudioCueService } from '../../../../platform/audioCues/browser/audioCueService.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { IEditorProgressService } from '../../../../platform/progress/common/progress.js';\nimport './colors.js';\nimport { DelegatingEditor } from './delegatingEditorImpl.js';\nimport { DiffEditorEditors } from './diffEditorEditors.js';\nimport { DiffEditorOptions } from './diffEditorOptions.js';\nimport { DiffEditorViewModel } from './diffEditorViewModel.js';\nlet DiffEditorWidget = class DiffEditorWidget extends DelegatingEditor {\n    constructor(_domElement, options, codeEditorWidgetOptions, _parentContextKeyService, _parentInstantiationService, codeEditorService, _audioCueService, _editorProgressService) {\n        var _a;\n        super();\n        this._domElement = _domElement;\n        this._parentContextKeyService = _parentContextKeyService;\n        this._parentInstantiationService = _parentInstantiationService;\n        this._audioCueService = _audioCueService;\n        this._editorProgressService = _editorProgressService;\n        this.elements = h('div.monaco-diff-editor.side-by-side', { style: { position: 'relative', height: '100%' } }, [\n            h('div.noModificationsOverlay@overlay', { style: { position: 'absolute', height: '100%', visibility: 'hidden', } }, [$('span', {}, 'No Changes')]),\n            h('div.editor.original@original', { style: { position: 'absolute', height: '100%' } }),\n            h('div.editor.modified@modified', { style: { position: 'absolute', height: '100%' } }),\n            h('div.accessibleDiffViewer@accessibleDiffViewer', { style: { position: 'absolute', height: '100%' } }),\n        ]);\n        this._diffModel = this._register(disposableObservableValue('diffModel', undefined));\n        this.onDidChangeModel = Event.fromObservableLight(this._diffModel);\n        this._contextKeyService = this._register(this._parentContextKeyService.createScoped(this._domElement));\n        this._instantiationService = this._parentInstantiationService.createChild(new ServiceCollection([IContextKeyService, this._contextKeyService]));\n        this._boundarySashes = observableValue(this, undefined);\n        this._accessibleDiffViewerShouldBeVisible = observableValue(this, false);\n        this._accessibleDiffViewerVisible = derived(this, reader => this._options.onlyShowAccessibleDiffViewer.read(reader)\n            ? true\n            : this._accessibleDiffViewerShouldBeVisible.read(reader));\n        this.movedBlocksLinesPart = observableValue(this, undefined);\n        this._layoutInfo = derived(this, reader => {\n            var _a, _b, _c;\n            const width = this._rootSizeObserver.width.read(reader);\n            const height = this._rootSizeObserver.height.read(reader);\n            const sashLeft = (_a = this._sash.read(reader)) === null || _a === void 0 ? void 0 : _a.sashLeft.read(reader);\n            const originalWidth = sashLeft !== null && sashLeft !== void 0 ? sashLeft : Math.max(5, this._editors.original.getLayoutInfo().decorationsLeft);\n            const modifiedWidth = width - originalWidth - (this._options.renderOverviewRuler.read(reader) ? OverviewRulerPart.ENTIRE_DIFF_OVERVIEW_WIDTH : 0);\n            const movedBlocksLinesWidth = (_c = (_b = this.movedBlocksLinesPart.read(reader)) === null || _b === void 0 ? void 0 : _b.width.read(reader)) !== null && _c !== void 0 ? _c : 0;\n            const originalWidthWithoutMovedBlockLines = originalWidth - movedBlocksLinesWidth;\n            this.elements.original.style.width = originalWidthWithoutMovedBlockLines + 'px';\n            this.elements.original.style.left = '0px';\n            this.elements.modified.style.width = modifiedWidth + 'px';\n            this.elements.modified.style.left = originalWidth + 'px';\n            this._editors.original.layout({ width: originalWidthWithoutMovedBlockLines, height });\n            this._editors.modified.layout({ width: modifiedWidth, height });\n            return {\n                modifiedEditor: this._editors.modified.getLayoutInfo(),\n                originalEditor: this._editors.original.getLayoutInfo(),\n            };\n        });\n        this._diffValue = this._diffModel.map((m, r) => m === null || m === void 0 ? void 0 : m.diff.read(r));\n        this.onDidUpdateDiff = Event.fromObservableLight(this._diffValue);\n        codeEditorService.willCreateDiffEditor();\n        this._contextKeyService.createKey('isInDiffEditor', true);\n        this._domElement.appendChild(this.elements.root);\n        this._register(toDisposable(() => this._domElement.removeChild(this.elements.root)));\n        this._rootSizeObserver = this._register(new ObservableElementSizeObserver(this.elements.root, options.dimension));\n        this._rootSizeObserver.setAutomaticLayout((_a = options.automaticLayout) !== null && _a !== void 0 ? _a : false);\n        this._options = new DiffEditorOptions(options, this._rootSizeObserver.width);\n        this._contextKeyService.createKey(EditorContextKeys.isEmbeddedDiffEditor.key, false);\n        const isEmbeddedDiffEditorKey = EditorContextKeys.isEmbeddedDiffEditor.bindTo(this._contextKeyService);\n        this._register(autorun(reader => {\n            /** @description update isEmbeddedDiffEditorKey */\n            isEmbeddedDiffEditorKey.set(this._options.isInEmbeddedEditor.read(reader));\n        }));\n        const comparingMovedCodeKey = EditorContextKeys.comparingMovedCode.bindTo(this._contextKeyService);\n        this._register(autorun(reader => {\n            var _a;\n            /** @description update comparingMovedCodeKey */\n            comparingMovedCodeKey.set(!!((_a = this._diffModel.read(reader)) === null || _a === void 0 ? void 0 : _a.movedTextToCompare.read(reader)));\n        }));\n        const diffEditorRenderSideBySideInlineBreakpointReachedContextKeyValue = EditorContextKeys.diffEditorRenderSideBySideInlineBreakpointReached.bindTo(this._contextKeyService);\n        this._register(autorun(reader => {\n            /** @description update accessibleDiffViewerVisible context key */\n            diffEditorRenderSideBySideInlineBreakpointReachedContextKeyValue.set(this._options.couldShowInlineViewBecauseOfSize.read(reader));\n        }));\n        this._editors = this._register(this._instantiationService.createInstance(DiffEditorEditors, this.elements.original, this.elements.modified, this._options, codeEditorWidgetOptions, (i, c, o, o2) => this._createInnerEditor(i, c, o, o2)));\n        this._sash = derivedWithStore(this, (reader, store) => {\n            const showSash = this._options.renderSideBySide.read(reader);\n            this.elements.root.classList.toggle('side-by-side', showSash);\n            if (!showSash) {\n                return undefined;\n            }\n            const result = store.add(new DiffEditorSash(this._options, this.elements.root, {\n                height: this._rootSizeObserver.height,\n                width: this._rootSizeObserver.width.map((w, reader) => w - (this._options.renderOverviewRuler.read(reader) ? OverviewRulerPart.ENTIRE_DIFF_OVERVIEW_WIDTH : 0)),\n            }));\n            store.add(autorun(reader => {\n                /** @description setBoundarySashes */\n                const boundarySashes = this._boundarySashes.read(reader);\n                if (boundarySashes) {\n                    result.setBoundarySashes(boundarySashes);\n                }\n            }));\n            return result;\n        });\n        this._register(recomputeInitiallyAndOnChange(this._sash));\n        this._register(autorunWithStore((reader, store) => {\n            /** @description UnchangedRangesFeature */\n            this.unchangedRangesFeature = store.add(this._instantiationService.createInstance(readHotReloadableExport(HideUnchangedRegionsFeature, reader), this._editors, this._diffModel, this._options));\n        }));\n        this._register(autorunWithStore((reader, store) => {\n            /** @description DiffEditorDecorations */\n            store.add(new (readHotReloadableExport(DiffEditorDecorations, reader))(this._editors, this._diffModel, this._options));\n        }));\n        this._register(autorunWithStore((reader, store) => {\n            /** @description ViewZoneManager */\n            store.add(this._instantiationService.createInstance(readHotReloadableExport(ViewZoneManager, reader), this._editors, this._diffModel, this._options, this, () => this.unchangedRangesFeature.isUpdatingViewZones));\n        }));\n        this._register(autorunWithStore((reader, store) => {\n            /** @description OverviewRulerPart */\n            store.add(this._instantiationService.createInstance(readHotReloadableExport(OverviewRulerPart, reader), this._editors, this.elements.root, this._diffModel, this._rootSizeObserver.width, this._rootSizeObserver.height, this._layoutInfo.map(i => i.modifiedEditor), this._options));\n        }));\n        this._register(autorunWithStore((reader, store) => {\n            /** @description _accessibleDiffViewer */\n            this._accessibleDiffViewer = store.add(this._register(this._instantiationService.createInstance(readHotReloadableExport(AccessibleDiffViewer, reader), this.elements.accessibleDiffViewer, this._accessibleDiffViewerVisible, (visible, tx) => this._accessibleDiffViewerShouldBeVisible.set(visible, tx), this._options.onlyShowAccessibleDiffViewer.map(v => !v), this._rootSizeObserver.width, this._rootSizeObserver.height, this._diffModel.map((m, r) => { var _a; return (_a = m === null || m === void 0 ? void 0 : m.diff.read(r)) === null || _a === void 0 ? void 0 : _a.mappings.map(m => m.lineRangeMapping); }), this._editors)));\n        }));\n        const visibility = this._accessibleDiffViewerVisible.map(v => v ? 'hidden' : 'visible');\n        this._register(applyStyle(this.elements.modified, { visibility }));\n        this._register(applyStyle(this.elements.original, { visibility }));\n        this._createDiffEditorContributions();\n        codeEditorService.addDiffEditor(this);\n        this._register(recomputeInitiallyAndOnChange(this._layoutInfo));\n        this._register(autorunWithStore((reader, store) => {\n            this.movedBlocksLinesPart.set(store.add(new (readHotReloadableExport(MovedBlocksLinesPart, reader))(this.elements.root, this._diffModel, this._layoutInfo.map(i => i.originalEditor), this._layoutInfo.map(i => i.modifiedEditor), this._editors)), undefined);\n        }));\n        this._register(applyStyle(this.elements.overlay, {\n            width: this._layoutInfo.map((i, r) => i.originalEditor.width + (this._options.renderSideBySide.read(r) ? 0 : i.modifiedEditor.width)),\n            visibility: derived(reader => /** @description visibility */ {\n                var _a, _b;\n                return (this._options.hideUnchangedRegions.read(reader) && ((_b = (_a = this._diffModel.read(reader)) === null || _a === void 0 ? void 0 : _a.diff.read(reader)) === null || _b === void 0 ? void 0 : _b.mappings.length) === 0)\n                    ? 'visible' : 'hidden';\n            }),\n        }));\n        // Revert change when an arrow is clicked.\n        this._register(this._editors.modified.onMouseDown(event => {\n            var _a, _b;\n            if (!event.event.rightButton && event.target.position && ((_a = event.target.element) === null || _a === void 0 ? void 0 : _a.className.includes('arrow-revert-change'))) {\n                const lineNumber = event.target.position.lineNumber;\n                const viewZone = event.target;\n                const model = this._diffModel.get();\n                if (!model) {\n                    return;\n                }\n                const diffs = (_b = model.diff.get()) === null || _b === void 0 ? void 0 : _b.mappings;\n                if (!diffs) {\n                    return;\n                }\n                const diff = diffs.find(d => (viewZone === null || viewZone === void 0 ? void 0 : viewZone.detail.afterLineNumber) === d.lineRangeMapping.modified.startLineNumber - 1 ||\n                    d.lineRangeMapping.modified.startLineNumber === lineNumber);\n                if (!diff) {\n                    return;\n                }\n                this.revert(diff.lineRangeMapping);\n                event.event.stopPropagation();\n            }\n        }));\n        this._register(Event.runAndSubscribe(this._editors.modified.onDidChangeCursorPosition, (e) => {\n            var _a, _b;\n            if ((e === null || e === void 0 ? void 0 : e.reason) === 3 /* CursorChangeReason.Explicit */) {\n                const diff = (_b = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.diff.get()) === null || _b === void 0 ? void 0 : _b.mappings.find(m => m.lineRangeMapping.modified.contains(e.position.lineNumber));\n                if (diff === null || diff === void 0 ? void 0 : diff.lineRangeMapping.modified.isEmpty) {\n                    this._audioCueService.playAudioCue(AudioCue.diffLineDeleted, { source: 'diffEditor.cursorPositionChanged' });\n                }\n                else if (diff === null || diff === void 0 ? void 0 : diff.lineRangeMapping.original.isEmpty) {\n                    this._audioCueService.playAudioCue(AudioCue.diffLineInserted, { source: 'diffEditor.cursorPositionChanged' });\n                }\n                else if (diff) {\n                    this._audioCueService.playAudioCue(AudioCue.diffLineModified, { source: 'diffEditor.cursorPositionChanged' });\n                }\n            }\n        }));\n        const isDiffUpToDate = this._diffModel.map((m, reader) => m === null || m === void 0 ? void 0 : m.isDiffUpToDate.read(reader));\n        this._register(autorunWithStore((reader, store) => {\n            if (isDiffUpToDate.read(reader) === false) {\n                const r = this._editorProgressService.show(true, 1000);\n                store.add(toDisposable(() => r.done()));\n            }\n        }));\n    }\n    _createInnerEditor(instantiationService, container, options, editorWidgetOptions) {\n        const editor = instantiationService.createInstance(CodeEditorWidget, container, options, editorWidgetOptions);\n        return editor;\n    }\n    _createDiffEditorContributions() {\n        const contributions = EditorExtensionsRegistry.getDiffEditorContributions();\n        for (const desc of contributions) {\n            try {\n                this._register(this._instantiationService.createInstance(desc.ctor, this));\n            }\n            catch (err) {\n                onUnexpectedError(err);\n            }\n        }\n    }\n    get _targetEditor() { return this._editors.modified; }\n    getEditorType() { return EditorType.IDiffEditor; }\n    layout(dimension) { this._rootSizeObserver.observe(dimension); }\n    hasTextFocus() { return this._editors.original.hasTextFocus() || this._editors.modified.hasTextFocus(); }\n    saveViewState() {\n        var _a;\n        const originalViewState = this._editors.original.saveViewState();\n        const modifiedViewState = this._editors.modified.saveViewState();\n        return {\n            original: originalViewState,\n            modified: modifiedViewState,\n            modelState: (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.serializeState(),\n        };\n    }\n    restoreViewState(s) {\n        var _a;\n        if (s && s.original && s.modified) {\n            const diffEditorState = s;\n            this._editors.original.restoreViewState(diffEditorState.original);\n            this._editors.modified.restoreViewState(diffEditorState.modified);\n            if (diffEditorState.modelState) {\n                (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.restoreSerializedState(diffEditorState.modelState);\n            }\n        }\n    }\n    createViewModel(model) {\n        return this._instantiationService.createInstance(DiffEditorViewModel, model, this._options, this);\n    }\n    getModel() { var _a, _b; return (_b = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.model) !== null && _b !== void 0 ? _b : null; }\n    setModel(model) {\n        if (!model && this._diffModel.get()) {\n            // Transitioning from a model to no-model\n            this._accessibleDiffViewer.close();\n        }\n        const vm = model ? ('model' in model) ? model : this.createViewModel(model) : undefined;\n        this._editors.original.setModel(vm ? vm.model.original : null);\n        this._editors.modified.setModel(vm ? vm.model.modified : null);\n        transaction(tx => {\n            this._diffModel.set(vm, tx);\n        });\n    }\n    /**\n     * @param changedOptions Only has values for top-level options that have actually changed.\n     */\n    updateOptions(changedOptions) {\n        this._options.updateOptions(changedOptions);\n    }\n    getContainerDomNode() { return this._domElement; }\n    getOriginalEditor() { return this._editors.original; }\n    getModifiedEditor() { return this._editors.modified; }\n    /**\n     * @deprecated Use `this.getDiffComputationResult().changes2` instead.\n     */\n    getLineChanges() {\n        var _a;\n        const diffState = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.diff.get();\n        if (!diffState) {\n            return null;\n        }\n        return toLineChanges(diffState);\n    }\n    revert(diff) {\n        var _a;\n        const model = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.model;\n        if (!model) {\n            return;\n        }\n        const changes = diff.innerChanges\n            ? diff.innerChanges.map(c => ({\n                range: c.modifiedRange,\n                text: model.original.getValueInRange(c.originalRange)\n            }))\n            : [\n                {\n                    range: diff.modified.toExclusiveRange(),\n                    text: model.original.getValueInRange(diff.original.toExclusiveRange())\n                }\n            ];\n        this._editors.modified.executeEdits('diffEditor', changes);\n    }\n    accessibleDiffViewerNext() { this._accessibleDiffViewer.next(); }\n    accessibleDiffViewerPrev() { this._accessibleDiffViewer.prev(); }\n    mapToOtherSide() {\n        var _a, _b;\n        const isModifiedFocus = this._editors.modified.hasWidgetFocus();\n        const source = isModifiedFocus ? this._editors.modified : this._editors.original;\n        const destination = isModifiedFocus ? this._editors.original : this._editors.modified;\n        let destinationSelection;\n        const sourceSelection = source.getSelection();\n        if (sourceSelection) {\n            const mappings = (_b = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.diff.get()) === null || _b === void 0 ? void 0 : _b.mappings.map(m => isModifiedFocus ? m.lineRangeMapping.flip() : m.lineRangeMapping);\n            if (mappings) {\n                const newRange1 = translatePosition(sourceSelection.getStartPosition(), mappings);\n                const newRange2 = translatePosition(sourceSelection.getEndPosition(), mappings);\n                destinationSelection = Range.plusRange(newRange1, newRange2);\n            }\n        }\n        return { destination, destinationSelection };\n    }\n    switchSide() {\n        const { destination, destinationSelection } = this.mapToOtherSide();\n        destination.focus();\n        if (destinationSelection) {\n            destination.setSelection(destinationSelection);\n        }\n    }\n    exitCompareMove() {\n        const model = this._diffModel.get();\n        if (!model) {\n            return;\n        }\n        model.movedTextToCompare.set(undefined, undefined);\n    }\n    collapseAllUnchangedRegions() {\n        var _a;\n        const unchangedRegions = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.unchangedRegions.get();\n        if (!unchangedRegions) {\n            return;\n        }\n        transaction(tx => {\n            for (const region of unchangedRegions) {\n                region.collapseAll(tx);\n            }\n        });\n    }\n    showAllUnchangedRegions() {\n        var _a;\n        const unchangedRegions = (_a = this._diffModel.get()) === null || _a === void 0 ? void 0 : _a.unchangedRegions.get();\n        if (!unchangedRegions) {\n            return;\n        }\n        transaction(tx => {\n            for (const region of unchangedRegions) {\n                region.showAll(tx);\n            }\n        });\n    }\n};\nDiffEditorWidget = __decorate([\n    __param(3, IContextKeyService),\n    __param(4, IInstantiationService),\n    __param(5, ICodeEditorService),\n    __param(6, IAudioCueService),\n    __param(7, IEditorProgressService)\n], DiffEditorWidget);\nexport { DiffEditorWidget };\nfunction translatePosition(posInOriginal, mappings) {\n    const mapping = findLast(mappings, m => m.original.startLineNumber <= posInOriginal.lineNumber);\n    if (!mapping) {\n        // No changes before the position\n        return Range.fromPositions(posInOriginal);\n    }\n    if (mapping.original.endLineNumberExclusive <= posInOriginal.lineNumber) {\n        const newLineNumber = posInOriginal.lineNumber - mapping.original.endLineNumberExclusive + mapping.modified.endLineNumberExclusive;\n        return Range.fromPositions(new Position(newLineNumber, posInOriginal.column));\n    }\n    if (!mapping.innerChanges) {\n        // Only for legacy algorithm\n        return Range.fromPositions(new Position(mapping.modified.startLineNumber, 1));\n    }\n    const innerMapping = findLast(mapping.innerChanges, m => m.originalRange.getStartPosition().isBeforeOrEqual(posInOriginal));\n    if (!innerMapping) {\n        const newLineNumber = posInOriginal.lineNumber - mapping.original.startLineNumber + mapping.modified.startLineNumber;\n        return Range.fromPositions(new Position(newLineNumber, posInOriginal.column));\n    }\n    if (innerMapping.originalRange.containsPosition(posInOriginal)) {\n        return innerMapping.modifiedRange;\n    }\n    else {\n        const l = lengthBetweenPositions(innerMapping.originalRange.getEndPosition(), posInOriginal);\n        return Range.fromPositions(addLength(innerMapping.modifiedRange.getEndPosition(), l));\n    }\n}\nfunction lengthBetweenPositions(position1, position2) {\n    if (position1.lineNumber === position2.lineNumber) {\n        return new LengthObj(0, position2.column - position1.column);\n    }\n    else {\n        return new LengthObj(position2.lineNumber - position1.lineNumber, position2.column - 1);\n    }\n}\nfunction addLength(position, length) {\n    if (length.lineCount === 0) {\n        return new Position(position.lineNumber, position.column + length.columnCount);\n    }\n    else {\n        return new Position(position.lineNumber + length.lineCount, length.columnCount + 1);\n    }\n}\nfunction toLineChanges(state) {\n    return state.mappings.map(x => {\n        const m = x.lineRangeMapping;\n        let originalStartLineNumber;\n        let originalEndLineNumber;\n        let modifiedStartLineNumber;\n        let modifiedEndLineNumber;\n        let innerChanges = m.innerChanges;\n        if (m.original.isEmpty) {\n            // Insertion\n            originalStartLineNumber = m.original.startLineNumber - 1;\n            originalEndLineNumber = 0;\n            innerChanges = undefined;\n        }\n        else {\n            originalStartLineNumber = m.original.startLineNumber;\n            originalEndLineNumber = m.original.endLineNumberExclusive - 1;\n        }\n        if (m.modified.isEmpty) {\n            // Deletion\n            modifiedStartLineNumber = m.modified.startLineNumber - 1;\n            modifiedEndLineNumber = 0;\n            innerChanges = undefined;\n        }\n        else {\n            modifiedStartLineNumber = m.modified.startLineNumber;\n            modifiedEndLineNumber = m.modified.endLineNumberExclusive - 1;\n        }\n        return {\n            originalStartLineNumber,\n            originalEndLineNumber,\n            modifiedStartLineNumber,\n            modifiedEndLineNumber,\n            charChanges: innerChanges === null || innerChanges === void 0 ? void 0 : innerChanges.map(m => ({\n                originalStartLineNumber: m.originalRange.startLineNumber,\n                originalStartColumn: m.originalRange.startColumn,\n                originalEndLineNumber: m.originalRange.endLineNumber,\n                originalEndColumn: m.originalRange.endColumn,\n                modifiedStartLineNumber: m.modifiedRange.startLineNumber,\n                modifiedStartColumn: m.modifiedRange.startColumn,\n                modifiedEndLineNumber: m.modifiedRange.endLineNumber,\n                modifiedEndColumn: m.modifiedRange.endColumn,\n            }))\n        };\n    });\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}