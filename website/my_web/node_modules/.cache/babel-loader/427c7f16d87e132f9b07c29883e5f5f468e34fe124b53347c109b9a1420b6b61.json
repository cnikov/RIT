{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar CopyPasteController_1;\nimport { addDisposableListener, getActiveDocument } from '../../../../base/browser/dom.js';\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { createCancelablePromise, raceCancellation } from '../../../../base/common/async.js';\nimport { UriList, createStringDataTransferItem, matchesMimeType } from '../../../../base/common/dataTransfer.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Mimes } from '../../../../base/common/mime.js';\nimport * as platform from '../../../../base/common/platform.js';\nimport { generateUuid } from '../../../../base/common/uuid.js';\nimport { ClipboardEventUtils } from '../../../browser/controller/textAreaInput.js';\nimport { toExternalVSDataTransfer, toVSDataTransfer } from '../../../browser/dnd.js';\nimport { IBulkEditService } from '../../../browser/services/bulkEditService.js';\nimport { Range } from '../../../common/core/range.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { createCombinedWorkspaceEdit, sortEditsByYieldTo } from './edit.js';\nimport { EditorStateCancellationTokenSource } from '../../editorState/browser/editorState.js';\nimport { InlineProgressManager } from '../../inlineProgress/browser/inlineProgress.js';\nimport { localize } from '../../../../nls.js';\nimport { IClipboardService } from '../../../../platform/clipboard/common/clipboardService.js';\nimport { RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IProgressService } from '../../../../platform/progress/common/progress.js';\nimport { IQuickInputService } from '../../../../platform/quickinput/common/quickInput.js';\nimport { PostEditWidgetManager } from './postEditWidget.js';\nexport const changePasteTypeCommandId = 'editor.changePasteType';\nexport const pasteWidgetVisibleCtx = new RawContextKey('pasteWidgetVisible', false, localize('pasteWidgetVisible', \"Whether the paste widget is showing\"));\nconst vscodeClipboardMime = 'application/vnd.code.copyMetadata';\nlet CopyPasteController = CopyPasteController_1 = class CopyPasteController extends Disposable {\n  static get(editor) {\n    return editor.getContribution(CopyPasteController_1.ID);\n  }\n  constructor(editor, instantiationService, _bulkEditService, _clipboardService, _languageFeaturesService, _quickInputService, _progressService) {\n    super();\n    this._bulkEditService = _bulkEditService;\n    this._clipboardService = _clipboardService;\n    this._languageFeaturesService = _languageFeaturesService;\n    this._quickInputService = _quickInputService;\n    this._progressService = _progressService;\n    this._editor = editor;\n    const container = editor.getContainerDomNode();\n    this._register(addDisposableListener(container, 'copy', e => this.handleCopy(e)));\n    this._register(addDisposableListener(container, 'cut', e => this.handleCopy(e)));\n    this._register(addDisposableListener(container, 'paste', e => this.handlePaste(e), true));\n    this._pasteProgressManager = this._register(new InlineProgressManager('pasteIntoEditor', editor, instantiationService));\n    this._postPasteWidgetManager = this._register(instantiationService.createInstance(PostEditWidgetManager, 'pasteIntoEditor', editor, pasteWidgetVisibleCtx, {\n      id: changePasteTypeCommandId,\n      label: localize('postPasteWidgetTitle', \"Show paste options...\")\n    }));\n  }\n  changePasteType() {\n    this._postPasteWidgetManager.tryShowSelector();\n  }\n  pasteAs(preferredId) {\n    this._editor.focus();\n    try {\n      this._pasteAsActionContext = {\n        preferredId\n      };\n      getActiveDocument().execCommand('paste');\n    } finally {\n      this._pasteAsActionContext = undefined;\n    }\n  }\n  isPasteAsEnabled() {\n    return this._editor.getOption(84 /* EditorOption.pasteAs */).enabled && !this._editor.getOption(90 /* EditorOption.readOnly */);\n  }\n\n  handleCopy(e) {\n    var _a, _b;\n    if (!this._editor.hasTextFocus()) {\n      return;\n    }\n    if (platform.isWeb) {\n      // Explicitly clear the web resources clipboard.\n      // This is needed because on web, the browser clipboard is faked out using an in-memory store.\n      // This means the resources clipboard is not properly updated when copying from the editor.\n      this._clipboardService.writeResources([]);\n    }\n    if (!e.clipboardData || !this.isPasteAsEnabled()) {\n      return;\n    }\n    const model = this._editor.getModel();\n    const selections = this._editor.getSelections();\n    if (!model || !(selections === null || selections === void 0 ? void 0 : selections.length)) {\n      return;\n    }\n    const enableEmptySelectionClipboard = this._editor.getOption(37 /* EditorOption.emptySelectionClipboard */);\n    let ranges = selections;\n    const wasFromEmptySelection = selections.length === 1 && selections[0].isEmpty();\n    if (wasFromEmptySelection) {\n      if (!enableEmptySelectionClipboard) {\n        return;\n      }\n      ranges = [new Range(ranges[0].startLineNumber, 1, ranges[0].startLineNumber, 1 + model.getLineLength(ranges[0].startLineNumber))];\n    }\n    const toCopy = (_a = this._editor._getViewModel()) === null || _a === void 0 ? void 0 : _a.getPlainTextToCopy(selections, enableEmptySelectionClipboard, platform.isWindows);\n    const multicursorText = Array.isArray(toCopy) ? toCopy : null;\n    const defaultPastePayload = {\n      multicursorText,\n      pasteOnNewLine: wasFromEmptySelection,\n      mode: null\n    };\n    const providers = this._languageFeaturesService.documentPasteEditProvider.ordered(model).filter(x => !!x.prepareDocumentPaste);\n    if (!providers.length) {\n      this.setCopyMetadata(e.clipboardData, {\n        defaultPastePayload\n      });\n      return;\n    }\n    const dataTransfer = toVSDataTransfer(e.clipboardData);\n    const providerCopyMimeTypes = providers.flatMap(x => {\n      var _a;\n      return (_a = x.copyMimeTypes) !== null && _a !== void 0 ? _a : [];\n    });\n    // Save off a handle pointing to data that VS Code maintains.\n    const handle = generateUuid();\n    this.setCopyMetadata(e.clipboardData, {\n      id: handle,\n      providerCopyMimeTypes,\n      defaultPastePayload\n    });\n    const promise = createCancelablePromise(token => __awaiter(this, void 0, void 0, function* () {\n      const results = coalesce(yield Promise.all(providers.map(provider => __awaiter(this, void 0, void 0, function* () {\n        try {\n          return yield provider.prepareDocumentPaste(model, ranges, dataTransfer, token);\n        } catch (err) {\n          console.error(err);\n          return undefined;\n        }\n      }))));\n      // Values from higher priority providers should overwrite values from lower priority ones.\n      // Reverse the array to so that the calls to `replace` below will do this\n      results.reverse();\n      for (const result of results) {\n        for (const [mime, value] of result) {\n          dataTransfer.replace(mime, value);\n        }\n      }\n      return dataTransfer;\n    }));\n    (_b = this._currentCopyOperation) === null || _b === void 0 ? void 0 : _b.dataTransferPromise.cancel();\n    this._currentCopyOperation = {\n      handle: handle,\n      dataTransferPromise: promise\n    };\n  }\n  handlePaste(e) {\n    var _a, _b;\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!e.clipboardData || !this._editor.hasTextFocus()) {\n        return;\n      }\n      (_a = this._currentPasteOperation) === null || _a === void 0 ? void 0 : _a.cancel();\n      this._currentPasteOperation = undefined;\n      const model = this._editor.getModel();\n      const selections = this._editor.getSelections();\n      if (!(selections === null || selections === void 0 ? void 0 : selections.length) || !model) {\n        return;\n      }\n      if (!this.isPasteAsEnabled()) {\n        return;\n      }\n      const metadata = this.fetchCopyMetadata(e);\n      const dataTransfer = toExternalVSDataTransfer(e.clipboardData);\n      dataTransfer.delete(vscodeClipboardMime);\n      const allPotentialMimeTypes = [...e.clipboardData.types, ...((_b = metadata === null || metadata === void 0 ? void 0 : metadata.providerCopyMimeTypes) !== null && _b !== void 0 ? _b : []),\n      // TODO: always adds `uri-list` because this get set if there are resources in the system clipboard.\n      // However we can only check the system clipboard async. For this early check, just add it in.\n      // We filter providers again once we have the final dataTransfer we will use.\n      Mimes.uriList];\n      const allProviders = this._languageFeaturesService.documentPasteEditProvider.ordered(model).filter(provider => {\n        var _a;\n        return (_a = provider.pasteMimeTypes) === null || _a === void 0 ? void 0 : _a.some(type => matchesMimeType(type, allPotentialMimeTypes));\n      });\n      if (!allProviders.length) {\n        return;\n      }\n      // Prevent the editor's default paste handler from running.\n      // Note that after this point, we are fully responsible for handling paste.\n      // If we can't provider a paste for any reason, we need to explicitly delegate pasting back to the editor.\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      if (this._pasteAsActionContext) {\n        this.showPasteAsPick(this._pasteAsActionContext.preferredId, allProviders, selections, dataTransfer, metadata);\n      } else {\n        this.doPasteInline(allProviders, selections, dataTransfer, metadata);\n      }\n    });\n  }\n  doPasteInline(allProviders, selections, dataTransfer, metadata) {\n    const p = createCancelablePromise(token => __awaiter(this, void 0, void 0, function* () {\n      const editor = this._editor;\n      if (!editor.hasModel()) {\n        return;\n      }\n      const model = editor.getModel();\n      const tokenSource = new EditorStateCancellationTokenSource(editor, 1 /* CodeEditorStateFlag.Value */ | 2 /* CodeEditorStateFlag.Selection */, undefined, token);\n      try {\n        yield this.mergeInDataFromCopy(dataTransfer, metadata, tokenSource.token);\n        if (tokenSource.token.isCancellationRequested) {\n          return;\n        }\n        // Filter out any providers the don't match the full data transfer we will send them.\n        const supportedProviders = allProviders.filter(provider => isSupportedPasteProvider(provider, dataTransfer));\n        if (!supportedProviders.length || supportedProviders.length === 1 && supportedProviders[0].id === 'text' // Only our default text provider is active\n        ) {\n          yield this.applyDefaultPasteHandler(dataTransfer, metadata, tokenSource.token);\n          return;\n        }\n        const providerEdits = yield this.getPasteEdits(supportedProviders, dataTransfer, model, selections, tokenSource.token);\n        if (tokenSource.token.isCancellationRequested) {\n          return;\n        }\n        // If the only edit returned is a text edit, use the default paste handler\n        if (providerEdits.length === 1 && providerEdits[0].providerId === 'text') {\n          yield this.applyDefaultPasteHandler(dataTransfer, metadata, tokenSource.token);\n          return;\n        }\n        if (providerEdits.length) {\n          const canShowWidget = editor.getOption(84 /* EditorOption.pasteAs */).showPasteSelector === 'afterPaste';\n          return this._postPasteWidgetManager.applyEditAndShowIfNeeded(selections, {\n            activeEditIndex: 0,\n            allEdits: providerEdits\n          }, canShowWidget, tokenSource.token);\n        }\n        yield this.applyDefaultPasteHandler(dataTransfer, metadata, tokenSource.token);\n      } finally {\n        tokenSource.dispose();\n        if (this._currentPasteOperation === p) {\n          this._currentPasteOperation = undefined;\n        }\n      }\n    }));\n    this._pasteProgressManager.showWhile(selections[0].getEndPosition(), localize('pasteIntoEditorProgress', \"Running paste handlers. Click to cancel\"), p);\n    this._currentPasteOperation = p;\n  }\n  showPasteAsPick(preferredId, allProviders, selections, dataTransfer, metadata) {\n    const p = createCancelablePromise(token => __awaiter(this, void 0, void 0, function* () {\n      const editor = this._editor;\n      if (!editor.hasModel()) {\n        return;\n      }\n      const model = editor.getModel();\n      const tokenSource = new EditorStateCancellationTokenSource(editor, 1 /* CodeEditorStateFlag.Value */ | 2 /* CodeEditorStateFlag.Selection */, undefined, token);\n      try {\n        yield this.mergeInDataFromCopy(dataTransfer, metadata, tokenSource.token);\n        if (tokenSource.token.isCancellationRequested) {\n          return;\n        }\n        // Filter out any providers the don't match the full data transfer we will send them.\n        let supportedProviders = allProviders.filter(provider => isSupportedPasteProvider(provider, dataTransfer));\n        if (preferredId) {\n          // We are looking for a specific edit\n          supportedProviders = supportedProviders.filter(edit => edit.id === preferredId);\n        }\n        const providerEdits = yield this.getPasteEdits(supportedProviders, dataTransfer, model, selections, tokenSource.token);\n        if (tokenSource.token.isCancellationRequested) {\n          return;\n        }\n        if (!providerEdits.length) {\n          return;\n        }\n        let pickedEdit;\n        if (preferredId) {\n          pickedEdit = providerEdits.at(0);\n        } else {\n          const selected = yield this._quickInputService.pick(providerEdits.map(edit => ({\n            label: edit.label,\n            description: edit.providerId,\n            detail: edit.detail,\n            edit\n          })), {\n            placeHolder: localize('pasteAsPickerPlaceholder', \"Select Paste Action\")\n          });\n          pickedEdit = selected === null || selected === void 0 ? void 0 : selected.edit;\n        }\n        if (!pickedEdit) {\n          return;\n        }\n        const combinedWorkspaceEdit = createCombinedWorkspaceEdit(model.uri, selections, pickedEdit);\n        yield this._bulkEditService.apply(combinedWorkspaceEdit, {\n          editor: this._editor\n        });\n      } finally {\n        tokenSource.dispose();\n        if (this._currentPasteOperation === p) {\n          this._currentPasteOperation = undefined;\n        }\n      }\n    }));\n    this._progressService.withProgress({\n      location: 10 /* ProgressLocation.Window */,\n      title: localize('pasteAsProgress', \"Running paste handlers\")\n    }, () => p);\n  }\n  setCopyMetadata(dataTransfer, metadata) {\n    dataTransfer.setData(vscodeClipboardMime, JSON.stringify(metadata));\n  }\n  fetchCopyMetadata(e) {\n    var _a;\n    if (!e.clipboardData) {\n      return;\n    }\n    // Prefer using the clipboard data we saved off\n    const rawMetadata = e.clipboardData.getData(vscodeClipboardMime);\n    if (rawMetadata) {\n      try {\n        return JSON.parse(rawMetadata);\n      } catch (_b) {\n        return undefined;\n      }\n    }\n    // Otherwise try to extract the generic text editor metadata\n    const [_, metadata] = ClipboardEventUtils.getTextData(e.clipboardData);\n    if (metadata) {\n      return {\n        defaultPastePayload: {\n          mode: metadata.mode,\n          multicursorText: (_a = metadata.multicursorText) !== null && _a !== void 0 ? _a : null,\n          pasteOnNewLine: !!metadata.isFromEmptySelection\n        }\n      };\n    }\n    return undefined;\n  }\n  mergeInDataFromCopy(dataTransfer, metadata, token) {\n    var _a;\n    return __awaiter(this, void 0, void 0, function* () {\n      if ((metadata === null || metadata === void 0 ? void 0 : metadata.id) && ((_a = this._currentCopyOperation) === null || _a === void 0 ? void 0 : _a.handle) === metadata.id) {\n        const toMergeDataTransfer = yield this._currentCopyOperation.dataTransferPromise;\n        if (token.isCancellationRequested) {\n          return;\n        }\n        for (const [key, value] of toMergeDataTransfer) {\n          dataTransfer.replace(key, value);\n        }\n      }\n      if (!dataTransfer.has(Mimes.uriList)) {\n        const resources = yield this._clipboardService.readResources();\n        if (token.isCancellationRequested) {\n          return;\n        }\n        if (resources.length) {\n          dataTransfer.append(Mimes.uriList, createStringDataTransferItem(UriList.create(resources)));\n        }\n      }\n    });\n  }\n  getPasteEdits(providers, dataTransfer, model, selections, token) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const results = yield raceCancellation(Promise.all(providers.map(provider => __awaiter(this, void 0, void 0, function* () {\n        var _a;\n        try {\n          const edit = yield (_a = provider.provideDocumentPasteEdits) === null || _a === void 0 ? void 0 : _a.call(provider, model, selections, dataTransfer, token);\n          if (edit) {\n            return Object.assign(Object.assign({}, edit), {\n              providerId: provider.id\n            });\n          }\n        } catch (err) {\n          console.error(err);\n        }\n        return undefined;\n      }))), token);\n      const edits = coalesce(results !== null && results !== void 0 ? results : []);\n      return sortEditsByYieldTo(edits);\n    });\n  }\n  applyDefaultPasteHandler(dataTransfer, metadata, token) {\n    var _a, _b, _c;\n    return __awaiter(this, void 0, void 0, function* () {\n      const textDataTransfer = (_a = dataTransfer.get(Mimes.text)) !== null && _a !== void 0 ? _a : dataTransfer.get('text');\n      if (!textDataTransfer) {\n        return;\n      }\n      const text = yield textDataTransfer.asString();\n      if (token.isCancellationRequested) {\n        return;\n      }\n      const payload = {\n        text,\n        pasteOnNewLine: (_b = metadata === null || metadata === void 0 ? void 0 : metadata.defaultPastePayload.pasteOnNewLine) !== null && _b !== void 0 ? _b : false,\n        multicursorText: (_c = metadata === null || metadata === void 0 ? void 0 : metadata.defaultPastePayload.multicursorText) !== null && _c !== void 0 ? _c : null,\n        mode: null\n      };\n      this._editor.trigger('keyboard', \"paste\" /* Handler.Paste */, payload);\n    });\n  }\n};\nCopyPasteController.ID = 'editor.contrib.copyPasteActionController';\nCopyPasteController = CopyPasteController_1 = __decorate([__param(1, IInstantiationService), __param(2, IBulkEditService), __param(3, IClipboardService), __param(4, ILanguageFeaturesService), __param(5, IQuickInputService), __param(6, IProgressService)], CopyPasteController);\nexport { CopyPasteController };\nfunction isSupportedPasteProvider(provider, dataTransfer) {\n  var _a;\n  return Boolean((_a = provider.pasteMimeTypes) === null || _a === void 0 ? void 0 : _a.some(type => dataTransfer.matches(type)));\n}","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","CopyPasteController_1","addDisposableListener","getActiveDocument","coalesce","createCancelablePromise","raceCancellation","UriList","createStringDataTransferItem","matchesMimeType","Disposable","Mimes","platform","generateUuid","ClipboardEventUtils","toExternalVSDataTransfer","toVSDataTransfer","IBulkEditService","Range","ILanguageFeaturesService","createCombinedWorkspaceEdit","sortEditsByYieldTo","EditorStateCancellationTokenSource","InlineProgressManager","localize","IClipboardService","RawContextKey","IInstantiationService","IProgressService","IQuickInputService","PostEditWidgetManager","changePasteTypeCommandId","pasteWidgetVisibleCtx","vscodeClipboardMime","CopyPasteController","get","editor","getContribution","ID","constructor","instantiationService","_bulkEditService","_clipboardService","_languageFeaturesService","_quickInputService","_progressService","_editor","container","getContainerDomNode","_register","handleCopy","handlePaste","_pasteProgressManager","_postPasteWidgetManager","createInstance","id","label","changePasteType","tryShowSelector","pasteAs","preferredId","focus","_pasteAsActionContext","execCommand","undefined","isPasteAsEnabled","getOption","enabled","_a","_b","hasTextFocus","isWeb","writeResources","clipboardData","model","getModel","selections","getSelections","enableEmptySelectionClipboard","ranges","wasFromEmptySelection","isEmpty","startLineNumber","getLineLength","toCopy","_getViewModel","getPlainTextToCopy","isWindows","multicursorText","Array","isArray","defaultPastePayload","pasteOnNewLine","mode","providers","documentPasteEditProvider","ordered","filter","x","prepareDocumentPaste","setCopyMetadata","dataTransfer","providerCopyMimeTypes","flatMap","copyMimeTypes","handle","promise","token","results","all","map","provider","err","console","error","reverse","mime","replace","_currentCopyOperation","dataTransferPromise","cancel","_currentPasteOperation","metadata","fetchCopyMetadata","delete","allPotentialMimeTypes","types","uriList","allProviders","pasteMimeTypes","some","type","preventDefault","stopImmediatePropagation","showPasteAsPick","doPasteInline","p","hasModel","tokenSource","mergeInDataFromCopy","isCancellationRequested","supportedProviders","isSupportedPasteProvider","applyDefaultPasteHandler","providerEdits","getPasteEdits","providerId","canShowWidget","showPasteSelector","applyEditAndShowIfNeeded","activeEditIndex","allEdits","dispose","showWhile","getEndPosition","edit","pickedEdit","at","selected","pick","description","detail","placeHolder","combinedWorkspaceEdit","uri","withProgress","location","title","setData","JSON","stringify","rawMetadata","getData","parse","_","getTextData","isFromEmptySelection","toMergeDataTransfer","has","resources","readResources","append","create","provideDocumentPasteEdits","call","assign","edits","_c","textDataTransfer","text","asString","payload","trigger","Boolean","matches"],"sources":["/home/chlohest/work/website/my_web/node_modules/monaco-editor/esm/vs/editor/contrib/dropOrPasteInto/browser/copyPasteController.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar CopyPasteController_1;\nimport { addDisposableListener, getActiveDocument } from '../../../../base/browser/dom.js';\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { createCancelablePromise, raceCancellation } from '../../../../base/common/async.js';\nimport { UriList, createStringDataTransferItem, matchesMimeType } from '../../../../base/common/dataTransfer.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Mimes } from '../../../../base/common/mime.js';\nimport * as platform from '../../../../base/common/platform.js';\nimport { generateUuid } from '../../../../base/common/uuid.js';\nimport { ClipboardEventUtils } from '../../../browser/controller/textAreaInput.js';\nimport { toExternalVSDataTransfer, toVSDataTransfer } from '../../../browser/dnd.js';\nimport { IBulkEditService } from '../../../browser/services/bulkEditService.js';\nimport { Range } from '../../../common/core/range.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { createCombinedWorkspaceEdit, sortEditsByYieldTo } from './edit.js';\nimport { EditorStateCancellationTokenSource } from '../../editorState/browser/editorState.js';\nimport { InlineProgressManager } from '../../inlineProgress/browser/inlineProgress.js';\nimport { localize } from '../../../../nls.js';\nimport { IClipboardService } from '../../../../platform/clipboard/common/clipboardService.js';\nimport { RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IProgressService } from '../../../../platform/progress/common/progress.js';\nimport { IQuickInputService } from '../../../../platform/quickinput/common/quickInput.js';\nimport { PostEditWidgetManager } from './postEditWidget.js';\nexport const changePasteTypeCommandId = 'editor.changePasteType';\nexport const pasteWidgetVisibleCtx = new RawContextKey('pasteWidgetVisible', false, localize('pasteWidgetVisible', \"Whether the paste widget is showing\"));\nconst vscodeClipboardMime = 'application/vnd.code.copyMetadata';\nlet CopyPasteController = CopyPasteController_1 = class CopyPasteController extends Disposable {\n    static get(editor) {\n        return editor.getContribution(CopyPasteController_1.ID);\n    }\n    constructor(editor, instantiationService, _bulkEditService, _clipboardService, _languageFeaturesService, _quickInputService, _progressService) {\n        super();\n        this._bulkEditService = _bulkEditService;\n        this._clipboardService = _clipboardService;\n        this._languageFeaturesService = _languageFeaturesService;\n        this._quickInputService = _quickInputService;\n        this._progressService = _progressService;\n        this._editor = editor;\n        const container = editor.getContainerDomNode();\n        this._register(addDisposableListener(container, 'copy', e => this.handleCopy(e)));\n        this._register(addDisposableListener(container, 'cut', e => this.handleCopy(e)));\n        this._register(addDisposableListener(container, 'paste', e => this.handlePaste(e), true));\n        this._pasteProgressManager = this._register(new InlineProgressManager('pasteIntoEditor', editor, instantiationService));\n        this._postPasteWidgetManager = this._register(instantiationService.createInstance(PostEditWidgetManager, 'pasteIntoEditor', editor, pasteWidgetVisibleCtx, { id: changePasteTypeCommandId, label: localize('postPasteWidgetTitle', \"Show paste options...\") }));\n    }\n    changePasteType() {\n        this._postPasteWidgetManager.tryShowSelector();\n    }\n    pasteAs(preferredId) {\n        this._editor.focus();\n        try {\n            this._pasteAsActionContext = { preferredId };\n            getActiveDocument().execCommand('paste');\n        }\n        finally {\n            this._pasteAsActionContext = undefined;\n        }\n    }\n    isPasteAsEnabled() {\n        return this._editor.getOption(84 /* EditorOption.pasteAs */).enabled\n            && !this._editor.getOption(90 /* EditorOption.readOnly */);\n    }\n    handleCopy(e) {\n        var _a, _b;\n        if (!this._editor.hasTextFocus()) {\n            return;\n        }\n        if (platform.isWeb) {\n            // Explicitly clear the web resources clipboard.\n            // This is needed because on web, the browser clipboard is faked out using an in-memory store.\n            // This means the resources clipboard is not properly updated when copying from the editor.\n            this._clipboardService.writeResources([]);\n        }\n        if (!e.clipboardData || !this.isPasteAsEnabled()) {\n            return;\n        }\n        const model = this._editor.getModel();\n        const selections = this._editor.getSelections();\n        if (!model || !(selections === null || selections === void 0 ? void 0 : selections.length)) {\n            return;\n        }\n        const enableEmptySelectionClipboard = this._editor.getOption(37 /* EditorOption.emptySelectionClipboard */);\n        let ranges = selections;\n        const wasFromEmptySelection = selections.length === 1 && selections[0].isEmpty();\n        if (wasFromEmptySelection) {\n            if (!enableEmptySelectionClipboard) {\n                return;\n            }\n            ranges = [new Range(ranges[0].startLineNumber, 1, ranges[0].startLineNumber, 1 + model.getLineLength(ranges[0].startLineNumber))];\n        }\n        const toCopy = (_a = this._editor._getViewModel()) === null || _a === void 0 ? void 0 : _a.getPlainTextToCopy(selections, enableEmptySelectionClipboard, platform.isWindows);\n        const multicursorText = Array.isArray(toCopy) ? toCopy : null;\n        const defaultPastePayload = {\n            multicursorText,\n            pasteOnNewLine: wasFromEmptySelection,\n            mode: null\n        };\n        const providers = this._languageFeaturesService.documentPasteEditProvider\n            .ordered(model)\n            .filter(x => !!x.prepareDocumentPaste);\n        if (!providers.length) {\n            this.setCopyMetadata(e.clipboardData, { defaultPastePayload });\n            return;\n        }\n        const dataTransfer = toVSDataTransfer(e.clipboardData);\n        const providerCopyMimeTypes = providers.flatMap(x => { var _a; return (_a = x.copyMimeTypes) !== null && _a !== void 0 ? _a : []; });\n        // Save off a handle pointing to data that VS Code maintains.\n        const handle = generateUuid();\n        this.setCopyMetadata(e.clipboardData, {\n            id: handle,\n            providerCopyMimeTypes,\n            defaultPastePayload\n        });\n        const promise = createCancelablePromise((token) => __awaiter(this, void 0, void 0, function* () {\n            const results = coalesce(yield Promise.all(providers.map((provider) => __awaiter(this, void 0, void 0, function* () {\n                try {\n                    return yield provider.prepareDocumentPaste(model, ranges, dataTransfer, token);\n                }\n                catch (err) {\n                    console.error(err);\n                    return undefined;\n                }\n            }))));\n            // Values from higher priority providers should overwrite values from lower priority ones.\n            // Reverse the array to so that the calls to `replace` below will do this\n            results.reverse();\n            for (const result of results) {\n                for (const [mime, value] of result) {\n                    dataTransfer.replace(mime, value);\n                }\n            }\n            return dataTransfer;\n        }));\n        (_b = this._currentCopyOperation) === null || _b === void 0 ? void 0 : _b.dataTransferPromise.cancel();\n        this._currentCopyOperation = { handle: handle, dataTransferPromise: promise };\n    }\n    handlePaste(e) {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!e.clipboardData || !this._editor.hasTextFocus()) {\n                return;\n            }\n            (_a = this._currentPasteOperation) === null || _a === void 0 ? void 0 : _a.cancel();\n            this._currentPasteOperation = undefined;\n            const model = this._editor.getModel();\n            const selections = this._editor.getSelections();\n            if (!(selections === null || selections === void 0 ? void 0 : selections.length) || !model) {\n                return;\n            }\n            if (!this.isPasteAsEnabled()) {\n                return;\n            }\n            const metadata = this.fetchCopyMetadata(e);\n            const dataTransfer = toExternalVSDataTransfer(e.clipboardData);\n            dataTransfer.delete(vscodeClipboardMime);\n            const allPotentialMimeTypes = [\n                ...e.clipboardData.types,\n                ...(_b = metadata === null || metadata === void 0 ? void 0 : metadata.providerCopyMimeTypes) !== null && _b !== void 0 ? _b : [],\n                // TODO: always adds `uri-list` because this get set if there are resources in the system clipboard.\n                // However we can only check the system clipboard async. For this early check, just add it in.\n                // We filter providers again once we have the final dataTransfer we will use.\n                Mimes.uriList,\n            ];\n            const allProviders = this._languageFeaturesService.documentPasteEditProvider\n                .ordered(model)\n                .filter(provider => { var _a; return (_a = provider.pasteMimeTypes) === null || _a === void 0 ? void 0 : _a.some(type => matchesMimeType(type, allPotentialMimeTypes)); });\n            if (!allProviders.length) {\n                return;\n            }\n            // Prevent the editor's default paste handler from running.\n            // Note that after this point, we are fully responsible for handling paste.\n            // If we can't provider a paste for any reason, we need to explicitly delegate pasting back to the editor.\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (this._pasteAsActionContext) {\n                this.showPasteAsPick(this._pasteAsActionContext.preferredId, allProviders, selections, dataTransfer, metadata);\n            }\n            else {\n                this.doPasteInline(allProviders, selections, dataTransfer, metadata);\n            }\n        });\n    }\n    doPasteInline(allProviders, selections, dataTransfer, metadata) {\n        const p = createCancelablePromise((token) => __awaiter(this, void 0, void 0, function* () {\n            const editor = this._editor;\n            if (!editor.hasModel()) {\n                return;\n            }\n            const model = editor.getModel();\n            const tokenSource = new EditorStateCancellationTokenSource(editor, 1 /* CodeEditorStateFlag.Value */ | 2 /* CodeEditorStateFlag.Selection */, undefined, token);\n            try {\n                yield this.mergeInDataFromCopy(dataTransfer, metadata, tokenSource.token);\n                if (tokenSource.token.isCancellationRequested) {\n                    return;\n                }\n                // Filter out any providers the don't match the full data transfer we will send them.\n                const supportedProviders = allProviders.filter(provider => isSupportedPasteProvider(provider, dataTransfer));\n                if (!supportedProviders.length\n                    || (supportedProviders.length === 1 && supportedProviders[0].id === 'text') // Only our default text provider is active\n                ) {\n                    yield this.applyDefaultPasteHandler(dataTransfer, metadata, tokenSource.token);\n                    return;\n                }\n                const providerEdits = yield this.getPasteEdits(supportedProviders, dataTransfer, model, selections, tokenSource.token);\n                if (tokenSource.token.isCancellationRequested) {\n                    return;\n                }\n                // If the only edit returned is a text edit, use the default paste handler\n                if (providerEdits.length === 1 && providerEdits[0].providerId === 'text') {\n                    yield this.applyDefaultPasteHandler(dataTransfer, metadata, tokenSource.token);\n                    return;\n                }\n                if (providerEdits.length) {\n                    const canShowWidget = editor.getOption(84 /* EditorOption.pasteAs */).showPasteSelector === 'afterPaste';\n                    return this._postPasteWidgetManager.applyEditAndShowIfNeeded(selections, { activeEditIndex: 0, allEdits: providerEdits }, canShowWidget, tokenSource.token);\n                }\n                yield this.applyDefaultPasteHandler(dataTransfer, metadata, tokenSource.token);\n            }\n            finally {\n                tokenSource.dispose();\n                if (this._currentPasteOperation === p) {\n                    this._currentPasteOperation = undefined;\n                }\n            }\n        }));\n        this._pasteProgressManager.showWhile(selections[0].getEndPosition(), localize('pasteIntoEditorProgress', \"Running paste handlers. Click to cancel\"), p);\n        this._currentPasteOperation = p;\n    }\n    showPasteAsPick(preferredId, allProviders, selections, dataTransfer, metadata) {\n        const p = createCancelablePromise((token) => __awaiter(this, void 0, void 0, function* () {\n            const editor = this._editor;\n            if (!editor.hasModel()) {\n                return;\n            }\n            const model = editor.getModel();\n            const tokenSource = new EditorStateCancellationTokenSource(editor, 1 /* CodeEditorStateFlag.Value */ | 2 /* CodeEditorStateFlag.Selection */, undefined, token);\n            try {\n                yield this.mergeInDataFromCopy(dataTransfer, metadata, tokenSource.token);\n                if (tokenSource.token.isCancellationRequested) {\n                    return;\n                }\n                // Filter out any providers the don't match the full data transfer we will send them.\n                let supportedProviders = allProviders.filter(provider => isSupportedPasteProvider(provider, dataTransfer));\n                if (preferredId) {\n                    // We are looking for a specific edit\n                    supportedProviders = supportedProviders.filter(edit => edit.id === preferredId);\n                }\n                const providerEdits = yield this.getPasteEdits(supportedProviders, dataTransfer, model, selections, tokenSource.token);\n                if (tokenSource.token.isCancellationRequested) {\n                    return;\n                }\n                if (!providerEdits.length) {\n                    return;\n                }\n                let pickedEdit;\n                if (preferredId) {\n                    pickedEdit = providerEdits.at(0);\n                }\n                else {\n                    const selected = yield this._quickInputService.pick(providerEdits.map((edit) => ({\n                        label: edit.label,\n                        description: edit.providerId,\n                        detail: edit.detail,\n                        edit,\n                    })), {\n                        placeHolder: localize('pasteAsPickerPlaceholder', \"Select Paste Action\"),\n                    });\n                    pickedEdit = selected === null || selected === void 0 ? void 0 : selected.edit;\n                }\n                if (!pickedEdit) {\n                    return;\n                }\n                const combinedWorkspaceEdit = createCombinedWorkspaceEdit(model.uri, selections, pickedEdit);\n                yield this._bulkEditService.apply(combinedWorkspaceEdit, { editor: this._editor });\n            }\n            finally {\n                tokenSource.dispose();\n                if (this._currentPasteOperation === p) {\n                    this._currentPasteOperation = undefined;\n                }\n            }\n        }));\n        this._progressService.withProgress({\n            location: 10 /* ProgressLocation.Window */,\n            title: localize('pasteAsProgress', \"Running paste handlers\"),\n        }, () => p);\n    }\n    setCopyMetadata(dataTransfer, metadata) {\n        dataTransfer.setData(vscodeClipboardMime, JSON.stringify(metadata));\n    }\n    fetchCopyMetadata(e) {\n        var _a;\n        if (!e.clipboardData) {\n            return;\n        }\n        // Prefer using the clipboard data we saved off\n        const rawMetadata = e.clipboardData.getData(vscodeClipboardMime);\n        if (rawMetadata) {\n            try {\n                return JSON.parse(rawMetadata);\n            }\n            catch (_b) {\n                return undefined;\n            }\n        }\n        // Otherwise try to extract the generic text editor metadata\n        const [_, metadata] = ClipboardEventUtils.getTextData(e.clipboardData);\n        if (metadata) {\n            return {\n                defaultPastePayload: {\n                    mode: metadata.mode,\n                    multicursorText: (_a = metadata.multicursorText) !== null && _a !== void 0 ? _a : null,\n                    pasteOnNewLine: !!metadata.isFromEmptySelection,\n                },\n            };\n        }\n        return undefined;\n    }\n    mergeInDataFromCopy(dataTransfer, metadata, token) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function* () {\n            if ((metadata === null || metadata === void 0 ? void 0 : metadata.id) && ((_a = this._currentCopyOperation) === null || _a === void 0 ? void 0 : _a.handle) === metadata.id) {\n                const toMergeDataTransfer = yield this._currentCopyOperation.dataTransferPromise;\n                if (token.isCancellationRequested) {\n                    return;\n                }\n                for (const [key, value] of toMergeDataTransfer) {\n                    dataTransfer.replace(key, value);\n                }\n            }\n            if (!dataTransfer.has(Mimes.uriList)) {\n                const resources = yield this._clipboardService.readResources();\n                if (token.isCancellationRequested) {\n                    return;\n                }\n                if (resources.length) {\n                    dataTransfer.append(Mimes.uriList, createStringDataTransferItem(UriList.create(resources)));\n                }\n            }\n        });\n    }\n    getPasteEdits(providers, dataTransfer, model, selections, token) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const results = yield raceCancellation(Promise.all(providers.map((provider) => __awaiter(this, void 0, void 0, function* () {\n                var _a;\n                try {\n                    const edit = yield ((_a = provider.provideDocumentPasteEdits) === null || _a === void 0 ? void 0 : _a.call(provider, model, selections, dataTransfer, token));\n                    if (edit) {\n                        return Object.assign(Object.assign({}, edit), { providerId: provider.id });\n                    }\n                }\n                catch (err) {\n                    console.error(err);\n                }\n                return undefined;\n            }))), token);\n            const edits = coalesce(results !== null && results !== void 0 ? results : []);\n            return sortEditsByYieldTo(edits);\n        });\n    }\n    applyDefaultPasteHandler(dataTransfer, metadata, token) {\n        var _a, _b, _c;\n        return __awaiter(this, void 0, void 0, function* () {\n            const textDataTransfer = (_a = dataTransfer.get(Mimes.text)) !== null && _a !== void 0 ? _a : dataTransfer.get('text');\n            if (!textDataTransfer) {\n                return;\n            }\n            const text = yield textDataTransfer.asString();\n            if (token.isCancellationRequested) {\n                return;\n            }\n            const payload = {\n                text,\n                pasteOnNewLine: (_b = metadata === null || metadata === void 0 ? void 0 : metadata.defaultPastePayload.pasteOnNewLine) !== null && _b !== void 0 ? _b : false,\n                multicursorText: (_c = metadata === null || metadata === void 0 ? void 0 : metadata.defaultPastePayload.multicursorText) !== null && _c !== void 0 ? _c : null,\n                mode: null,\n            };\n            this._editor.trigger('keyboard', \"paste\" /* Handler.Paste */, payload);\n        });\n    }\n};\nCopyPasteController.ID = 'editor.contrib.copyPasteActionController';\nCopyPasteController = CopyPasteController_1 = __decorate([\n    __param(1, IInstantiationService),\n    __param(2, IBulkEditService),\n    __param(3, IClipboardService),\n    __param(4, ILanguageFeaturesService),\n    __param(5, IQuickInputService),\n    __param(6, IProgressService)\n], CopyPasteController);\nexport { CopyPasteController };\nfunction isSupportedPasteProvider(provider, dataTransfer) {\n    var _a;\n    return Boolean((_a = provider.pasteMimeTypes) === null || _a === void 0 ? void 0 : _a.some(type => dataTransfer.matches(type)));\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}