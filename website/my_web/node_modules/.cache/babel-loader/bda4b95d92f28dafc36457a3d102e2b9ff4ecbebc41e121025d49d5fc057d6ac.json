{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar SuggestWidget_1;\nimport * as dom from '../../../../base/browser/dom.js';\nimport '../../../../base/browser/ui/codicons/codiconStyles.js'; // The codicon symbol styles are defined here and must be loaded\nimport { List } from '../../../../base/browser/ui/list/listWidget.js';\nimport { createCancelablePromise, disposableTimeout, TimeoutTimer } from '../../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Emitter, PauseableEmitter } from '../../../../base/common/event.js';\nimport { DisposableStore, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { clamp } from '../../../../base/common/numbers.js';\nimport * as strings from '../../../../base/common/strings.js';\nimport './media/suggest.css';\nimport { EmbeddedCodeEditorWidget } from '../../../browser/widget/embeddedCodeEditorWidget.js';\nimport { SuggestWidgetStatus } from './suggestWidgetStatus.js';\nimport '../../symbolIcons/browser/symbolIcons.js'; // The codicon symbol colors are defined here and must be loaded to get colors\nimport * as nls from '../../../../nls.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { activeContrastBorder, editorForeground, editorWidgetBackground, editorWidgetBorder, listFocusHighlightForeground, listHighlightForeground, quickInputListFocusBackground, quickInputListFocusForeground, quickInputListFocusIconForeground, registerColor, transparent } from '../../../../platform/theme/common/colorRegistry.js';\nimport { isHighContrast } from '../../../../platform/theme/common/theme.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { ResizableHTMLElement } from '../../../../base/browser/ui/resizable/resizable.js';\nimport { Context as SuggestContext, suggestWidgetStatusbarMenu } from './suggest.js';\nimport { canExpandCompletionItem, SuggestDetailsOverlay, SuggestDetailsWidget } from './suggestWidgetDetails.js';\nimport { getAriaId, ItemRenderer } from './suggestWidgetRenderer.js';\nimport { getListStyles } from '../../../../platform/theme/browser/defaultStyles.js';\nimport { status } from '../../../../base/browser/ui/aria/aria.js';\n/**\n * Suggest widget colors\n */\nregisterColor('editorSuggestWidget.background', {\n  dark: editorWidgetBackground,\n  light: editorWidgetBackground,\n  hcDark: editorWidgetBackground,\n  hcLight: editorWidgetBackground\n}, nls.localize('editorSuggestWidgetBackground', 'Background color of the suggest widget.'));\nregisterColor('editorSuggestWidget.border', {\n  dark: editorWidgetBorder,\n  light: editorWidgetBorder,\n  hcDark: editorWidgetBorder,\n  hcLight: editorWidgetBorder\n}, nls.localize('editorSuggestWidgetBorder', 'Border color of the suggest widget.'));\nconst editorSuggestWidgetForeground = registerColor('editorSuggestWidget.foreground', {\n  dark: editorForeground,\n  light: editorForeground,\n  hcDark: editorForeground,\n  hcLight: editorForeground\n}, nls.localize('editorSuggestWidgetForeground', 'Foreground color of the suggest widget.'));\nregisterColor('editorSuggestWidget.selectedForeground', {\n  dark: quickInputListFocusForeground,\n  light: quickInputListFocusForeground,\n  hcDark: quickInputListFocusForeground,\n  hcLight: quickInputListFocusForeground\n}, nls.localize('editorSuggestWidgetSelectedForeground', 'Foreground color of the selected entry in the suggest widget.'));\nregisterColor('editorSuggestWidget.selectedIconForeground', {\n  dark: quickInputListFocusIconForeground,\n  light: quickInputListFocusIconForeground,\n  hcDark: quickInputListFocusIconForeground,\n  hcLight: quickInputListFocusIconForeground\n}, nls.localize('editorSuggestWidgetSelectedIconForeground', 'Icon foreground color of the selected entry in the suggest widget.'));\nexport const editorSuggestWidgetSelectedBackground = registerColor('editorSuggestWidget.selectedBackground', {\n  dark: quickInputListFocusBackground,\n  light: quickInputListFocusBackground,\n  hcDark: quickInputListFocusBackground,\n  hcLight: quickInputListFocusBackground\n}, nls.localize('editorSuggestWidgetSelectedBackground', 'Background color of the selected entry in the suggest widget.'));\nregisterColor('editorSuggestWidget.highlightForeground', {\n  dark: listHighlightForeground,\n  light: listHighlightForeground,\n  hcDark: listHighlightForeground,\n  hcLight: listHighlightForeground\n}, nls.localize('editorSuggestWidgetHighlightForeground', 'Color of the match highlights in the suggest widget.'));\nregisterColor('editorSuggestWidget.focusHighlightForeground', {\n  dark: listFocusHighlightForeground,\n  light: listFocusHighlightForeground,\n  hcDark: listFocusHighlightForeground,\n  hcLight: listFocusHighlightForeground\n}, nls.localize('editorSuggestWidgetFocusHighlightForeground', 'Color of the match highlights in the suggest widget when an item is focused.'));\nregisterColor('editorSuggestWidgetStatus.foreground', {\n  dark: transparent(editorSuggestWidgetForeground, .5),\n  light: transparent(editorSuggestWidgetForeground, .5),\n  hcDark: transparent(editorSuggestWidgetForeground, .5),\n  hcLight: transparent(editorSuggestWidgetForeground, .5)\n}, nls.localize('editorSuggestWidgetStatusForeground', 'Foreground color of the suggest widget status.'));\nclass PersistedWidgetSize {\n  constructor(_service, editor) {\n    this._service = _service;\n    this._key = `suggestWidget.size/${editor.getEditorType()}/${editor instanceof EmbeddedCodeEditorWidget}`;\n  }\n  restore() {\n    var _a;\n    const raw = (_a = this._service.get(this._key, 0 /* StorageScope.PROFILE */)) !== null && _a !== void 0 ? _a : '';\n    try {\n      const obj = JSON.parse(raw);\n      if (dom.Dimension.is(obj)) {\n        return dom.Dimension.lift(obj);\n      }\n    } catch (_b) {\n      // ignore\n    }\n    return undefined;\n  }\n  store(size) {\n    this._service.store(this._key, JSON.stringify(size), 0 /* StorageScope.PROFILE */, 1 /* StorageTarget.MACHINE */);\n  }\n\n  reset() {\n    this._service.remove(this._key, 0 /* StorageScope.PROFILE */);\n  }\n}\n\nlet SuggestWidget = SuggestWidget_1 = class SuggestWidget {\n  constructor(editor, _storageService, _contextKeyService, _themeService, instantiationService) {\n    this.editor = editor;\n    this._storageService = _storageService;\n    this._state = 0 /* State.Hidden */;\n    this._isAuto = false;\n    this._pendingLayout = new MutableDisposable();\n    this._pendingShowDetails = new MutableDisposable();\n    this._ignoreFocusEvents = false;\n    this._forceRenderingAbove = false;\n    this._explainMode = false;\n    this._showTimeout = new TimeoutTimer();\n    this._disposables = new DisposableStore();\n    this._onDidSelect = new PauseableEmitter();\n    this._onDidFocus = new PauseableEmitter();\n    this._onDidHide = new Emitter();\n    this._onDidShow = new Emitter();\n    this.onDidSelect = this._onDidSelect.event;\n    this.onDidFocus = this._onDidFocus.event;\n    this.onDidHide = this._onDidHide.event;\n    this.onDidShow = this._onDidShow.event;\n    this._onDetailsKeydown = new Emitter();\n    this.onDetailsKeyDown = this._onDetailsKeydown.event;\n    this.element = new ResizableHTMLElement();\n    this.element.domNode.classList.add('editor-widget', 'suggest-widget');\n    this._contentWidget = new SuggestContentWidget(this, editor);\n    this._persistedSize = new PersistedWidgetSize(_storageService, editor);\n    class ResizeState {\n      constructor(persistedSize, currentSize, persistHeight = false, persistWidth = false) {\n        this.persistedSize = persistedSize;\n        this.currentSize = currentSize;\n        this.persistHeight = persistHeight;\n        this.persistWidth = persistWidth;\n      }\n    }\n    let state;\n    this._disposables.add(this.element.onDidWillResize(() => {\n      this._contentWidget.lockPreference();\n      state = new ResizeState(this._persistedSize.restore(), this.element.size);\n    }));\n    this._disposables.add(this.element.onDidResize(e => {\n      var _a, _b, _c, _d;\n      this._resize(e.dimension.width, e.dimension.height);\n      if (state) {\n        state.persistHeight = state.persistHeight || !!e.north || !!e.south;\n        state.persistWidth = state.persistWidth || !!e.east || !!e.west;\n      }\n      if (!e.done) {\n        return;\n      }\n      if (state) {\n        // only store width or height value that have changed and also\n        // only store changes that are above a certain threshold\n        const {\n          itemHeight,\n          defaultSize\n        } = this.getLayoutInfo();\n        const threshold = Math.round(itemHeight / 2);\n        let {\n          width,\n          height\n        } = this.element.size;\n        if (!state.persistHeight || Math.abs(state.currentSize.height - height) <= threshold) {\n          height = (_b = (_a = state.persistedSize) === null || _a === void 0 ? void 0 : _a.height) !== null && _b !== void 0 ? _b : defaultSize.height;\n        }\n        if (!state.persistWidth || Math.abs(state.currentSize.width - width) <= threshold) {\n          width = (_d = (_c = state.persistedSize) === null || _c === void 0 ? void 0 : _c.width) !== null && _d !== void 0 ? _d : defaultSize.width;\n        }\n        this._persistedSize.store(new dom.Dimension(width, height));\n      }\n      // reset working state\n      this._contentWidget.unlockPreference();\n      state = undefined;\n    }));\n    this._messageElement = dom.append(this.element.domNode, dom.$('.message'));\n    this._listElement = dom.append(this.element.domNode, dom.$('.tree'));\n    const details = this._disposables.add(instantiationService.createInstance(SuggestDetailsWidget, this.editor));\n    details.onDidClose(this.toggleDetails, this, this._disposables);\n    this._details = new SuggestDetailsOverlay(details, this.editor);\n    const applyIconStyle = () => this.element.domNode.classList.toggle('no-icons', !this.editor.getOption(117 /* EditorOption.suggest */).showIcons);\n    applyIconStyle();\n    const renderer = instantiationService.createInstance(ItemRenderer, this.editor);\n    this._disposables.add(renderer);\n    this._disposables.add(renderer.onDidToggleDetails(() => this.toggleDetails()));\n    this._list = new List('SuggestWidget', this._listElement, {\n      getHeight: _element => this.getLayoutInfo().itemHeight,\n      getTemplateId: _element => 'suggestion'\n    }, [renderer], {\n      alwaysConsumeMouseWheel: true,\n      useShadows: false,\n      mouseSupport: false,\n      multipleSelectionSupport: false,\n      accessibilityProvider: {\n        getRole: () => 'option',\n        getWidgetAriaLabel: () => nls.localize('suggest', \"Suggest\"),\n        getWidgetRole: () => 'listbox',\n        getAriaLabel: item => {\n          let label = item.textLabel;\n          if (typeof item.completion.label !== 'string') {\n            const {\n              detail,\n              description\n            } = item.completion.label;\n            if (detail && description) {\n              label = nls.localize('label.full', '{0} {1}, {2}', label, detail, description);\n            } else if (detail) {\n              label = nls.localize('label.detail', '{0} {1}', label, detail);\n            } else if (description) {\n              label = nls.localize('label.desc', '{0}, {1}', label, description);\n            }\n          }\n          if (!item.isResolved || !this._isDetailsVisible()) {\n            return label;\n          }\n          const {\n            documentation,\n            detail\n          } = item.completion;\n          const docs = strings.format('{0}{1}', detail || '', documentation ? typeof documentation === 'string' ? documentation : documentation.value : '');\n          return nls.localize('ariaCurrenttSuggestionReadDetails', \"{0}, docs: {1}\", label, docs);\n        }\n      }\n    });\n    this._list.style(getListStyles({\n      listInactiveFocusBackground: editorSuggestWidgetSelectedBackground,\n      listInactiveFocusOutline: activeContrastBorder\n    }));\n    this._status = instantiationService.createInstance(SuggestWidgetStatus, this.element.domNode, suggestWidgetStatusbarMenu);\n    const applyStatusBarStyle = () => this.element.domNode.classList.toggle('with-status-bar', this.editor.getOption(117 /* EditorOption.suggest */).showStatusBar);\n    applyStatusBarStyle();\n    this._disposables.add(_themeService.onDidColorThemeChange(t => this._onThemeChange(t)));\n    this._onThemeChange(_themeService.getColorTheme());\n    this._disposables.add(this._list.onMouseDown(e => this._onListMouseDownOrTap(e)));\n    this._disposables.add(this._list.onTap(e => this._onListMouseDownOrTap(e)));\n    this._disposables.add(this._list.onDidChangeSelection(e => this._onListSelection(e)));\n    this._disposables.add(this._list.onDidChangeFocus(e => this._onListFocus(e)));\n    this._disposables.add(this.editor.onDidChangeCursorSelection(() => this._onCursorSelectionChanged()));\n    this._disposables.add(this.editor.onDidChangeConfiguration(e => {\n      if (e.hasChanged(117 /* EditorOption.suggest */)) {\n        applyStatusBarStyle();\n        applyIconStyle();\n      }\n    }));\n    this._ctxSuggestWidgetVisible = SuggestContext.Visible.bindTo(_contextKeyService);\n    this._ctxSuggestWidgetDetailsVisible = SuggestContext.DetailsVisible.bindTo(_contextKeyService);\n    this._ctxSuggestWidgetMultipleSuggestions = SuggestContext.MultipleSuggestions.bindTo(_contextKeyService);\n    this._ctxSuggestWidgetHasFocusedSuggestion = SuggestContext.HasFocusedSuggestion.bindTo(_contextKeyService);\n    this._disposables.add(dom.addStandardDisposableListener(this._details.widget.domNode, 'keydown', e => {\n      this._onDetailsKeydown.fire(e);\n    }));\n    this._disposables.add(this.editor.onMouseDown(e => this._onEditorMouseDown(e)));\n  }\n  dispose() {\n    var _a;\n    this._details.widget.dispose();\n    this._details.dispose();\n    this._list.dispose();\n    this._status.dispose();\n    this._disposables.dispose();\n    (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n    this._pendingLayout.dispose();\n    this._pendingShowDetails.dispose();\n    this._showTimeout.dispose();\n    this._contentWidget.dispose();\n    this.element.dispose();\n  }\n  _onEditorMouseDown(mouseEvent) {\n    if (this._details.widget.domNode.contains(mouseEvent.target.element)) {\n      // Clicking inside details\n      this._details.widget.domNode.focus();\n    } else {\n      // Clicking outside details and inside suggest\n      if (this.element.domNode.contains(mouseEvent.target.element)) {\n        this.editor.focus();\n      }\n    }\n  }\n  _onCursorSelectionChanged() {\n    if (this._state !== 0 /* State.Hidden */) {\n      this._contentWidget.layout();\n    }\n  }\n  _onListMouseDownOrTap(e) {\n    if (typeof e.element === 'undefined' || typeof e.index === 'undefined') {\n      return;\n    }\n    // prevent stealing browser focus from the editor\n    e.browserEvent.preventDefault();\n    e.browserEvent.stopPropagation();\n    this._select(e.element, e.index);\n  }\n  _onListSelection(e) {\n    if (e.elements.length) {\n      this._select(e.elements[0], e.indexes[0]);\n    }\n  }\n  _select(item, index) {\n    const completionModel = this._completionModel;\n    if (completionModel) {\n      this._onDidSelect.fire({\n        item,\n        index,\n        model: completionModel\n      });\n      this.editor.focus();\n    }\n  }\n  _onThemeChange(theme) {\n    this._details.widget.borderWidth = isHighContrast(theme.type) ? 2 : 1;\n  }\n  _onListFocus(e) {\n    var _a;\n    if (this._ignoreFocusEvents) {\n      return;\n    }\n    if (!e.elements.length) {\n      if (this._currentSuggestionDetails) {\n        this._currentSuggestionDetails.cancel();\n        this._currentSuggestionDetails = undefined;\n        this._focusedItem = undefined;\n      }\n      this.editor.setAriaOptions({\n        activeDescendant: undefined\n      });\n      this._ctxSuggestWidgetHasFocusedSuggestion.set(false);\n      return;\n    }\n    if (!this._completionModel) {\n      return;\n    }\n    this._ctxSuggestWidgetHasFocusedSuggestion.set(true);\n    const item = e.elements[0];\n    const index = e.indexes[0];\n    if (item !== this._focusedItem) {\n      (_a = this._currentSuggestionDetails) === null || _a === void 0 ? void 0 : _a.cancel();\n      this._currentSuggestionDetails = undefined;\n      this._focusedItem = item;\n      this._list.reveal(index);\n      this._currentSuggestionDetails = createCancelablePromise(token => __awaiter(this, void 0, void 0, function* () {\n        const loading = disposableTimeout(() => {\n          if (this._isDetailsVisible()) {\n            this.showDetails(true);\n          }\n        }, 250);\n        const sub = token.onCancellationRequested(() => loading.dispose());\n        try {\n          return yield item.resolve(token);\n        } finally {\n          loading.dispose();\n          sub.dispose();\n        }\n      }));\n      this._currentSuggestionDetails.then(() => {\n        if (index >= this._list.length || item !== this._list.element(index)) {\n          return;\n        }\n        // item can have extra information, so re-render\n        this._ignoreFocusEvents = true;\n        this._list.splice(index, 1, [item]);\n        this._list.setFocus([index]);\n        this._ignoreFocusEvents = false;\n        if (this._isDetailsVisible()) {\n          this.showDetails(false);\n        } else {\n          this.element.domNode.classList.remove('docs-side');\n        }\n        this.editor.setAriaOptions({\n          activeDescendant: getAriaId(index)\n        });\n      }).catch(onUnexpectedError);\n    }\n    // emit an event\n    this._onDidFocus.fire({\n      item,\n      index,\n      model: this._completionModel\n    });\n  }\n  _setState(state) {\n    if (this._state === state) {\n      return;\n    }\n    this._state = state;\n    this.element.domNode.classList.toggle('frozen', state === 4 /* State.Frozen */);\n    this.element.domNode.classList.remove('message');\n    switch (state) {\n      case 0 /* State.Hidden */:\n        dom.hide(this._messageElement, this._listElement, this._status.element);\n        this._details.hide(true);\n        this._status.hide();\n        this._contentWidget.hide();\n        this._ctxSuggestWidgetVisible.reset();\n        this._ctxSuggestWidgetMultipleSuggestions.reset();\n        this._ctxSuggestWidgetHasFocusedSuggestion.reset();\n        this._showTimeout.cancel();\n        this.element.domNode.classList.remove('visible');\n        this._list.splice(0, this._list.length);\n        this._focusedItem = undefined;\n        this._cappedHeight = undefined;\n        this._explainMode = false;\n        break;\n      case 1 /* State.Loading */:\n        this.element.domNode.classList.add('message');\n        this._messageElement.textContent = SuggestWidget_1.LOADING_MESSAGE;\n        dom.hide(this._listElement, this._status.element);\n        dom.show(this._messageElement);\n        this._details.hide();\n        this._show();\n        this._focusedItem = undefined;\n        status(SuggestWidget_1.LOADING_MESSAGE);\n        break;\n      case 2 /* State.Empty */:\n        this.element.domNode.classList.add('message');\n        this._messageElement.textContent = SuggestWidget_1.NO_SUGGESTIONS_MESSAGE;\n        dom.hide(this._listElement, this._status.element);\n        dom.show(this._messageElement);\n        this._details.hide();\n        this._show();\n        this._focusedItem = undefined;\n        status(SuggestWidget_1.NO_SUGGESTIONS_MESSAGE);\n        break;\n      case 3 /* State.Open */:\n        dom.hide(this._messageElement);\n        dom.show(this._listElement, this._status.element);\n        this._show();\n        break;\n      case 4 /* State.Frozen */:\n        dom.hide(this._messageElement);\n        dom.show(this._listElement, this._status.element);\n        this._show();\n        break;\n      case 5 /* State.Details */:\n        dom.hide(this._messageElement);\n        dom.show(this._listElement, this._status.element);\n        this._details.show();\n        this._show();\n        break;\n    }\n  }\n  _show() {\n    this._status.show();\n    this._contentWidget.show();\n    this._layout(this._persistedSize.restore());\n    this._ctxSuggestWidgetVisible.set(true);\n    this._showTimeout.cancelAndSet(() => {\n      this.element.domNode.classList.add('visible');\n      this._onDidShow.fire(this);\n    }, 100);\n  }\n  showTriggered(auto, delay) {\n    if (this._state !== 0 /* State.Hidden */) {\n      return;\n    }\n    this._contentWidget.setPosition(this.editor.getPosition());\n    this._isAuto = !!auto;\n    if (!this._isAuto) {\n      this._loadingTimeout = disposableTimeout(() => this._setState(1 /* State.Loading */), delay);\n    }\n  }\n  showSuggestions(completionModel, selectionIndex, isFrozen, isAuto, noFocus) {\n    var _a, _b;\n    this._contentWidget.setPosition(this.editor.getPosition());\n    (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n    (_b = this._currentSuggestionDetails) === null || _b === void 0 ? void 0 : _b.cancel();\n    this._currentSuggestionDetails = undefined;\n    if (this._completionModel !== completionModel) {\n      this._completionModel = completionModel;\n    }\n    if (isFrozen && this._state !== 2 /* State.Empty */ && this._state !== 0 /* State.Hidden */) {\n      this._setState(4 /* State.Frozen */);\n      return;\n    }\n    const visibleCount = this._completionModel.items.length;\n    const isEmpty = visibleCount === 0;\n    this._ctxSuggestWidgetMultipleSuggestions.set(visibleCount > 1);\n    if (isEmpty) {\n      this._setState(isAuto ? 0 /* State.Hidden */ : 2 /* State.Empty */);\n      this._completionModel = undefined;\n      return;\n    }\n    this._focusedItem = undefined;\n    // calling list.splice triggers focus event which this widget forwards. That can lead to\n    // suggestions being cancelled and the widget being cleared (and hidden). All this happens\n    // before revealing and focusing is done which means revealing and focusing will fail when\n    // they get run.\n    this._onDidFocus.pause();\n    this._onDidSelect.pause();\n    try {\n      this._list.splice(0, this._list.length, this._completionModel.items);\n      this._setState(isFrozen ? 4 /* State.Frozen */ : 3 /* State.Open */);\n      this._list.reveal(selectionIndex, 0);\n      this._list.setFocus(noFocus ? [] : [selectionIndex]);\n    } finally {\n      this._onDidFocus.resume();\n      this._onDidSelect.resume();\n    }\n    this._pendingLayout.value = dom.runAtThisOrScheduleAtNextAnimationFrame(() => {\n      this._pendingLayout.clear();\n      this._layout(this.element.size);\n      // Reset focus border\n      this._details.widget.domNode.classList.remove('focused');\n    });\n  }\n  focusSelected() {\n    if (this._list.length > 0) {\n      this._list.setFocus([0]);\n    }\n  }\n  selectNextPage() {\n    switch (this._state) {\n      case 0 /* State.Hidden */:\n        return false;\n      case 5 /* State.Details */:\n        this._details.widget.pageDown();\n        return true;\n      case 1 /* State.Loading */:\n        return !this._isAuto;\n      default:\n        this._list.focusNextPage();\n        return true;\n    }\n  }\n  selectNext() {\n    switch (this._state) {\n      case 0 /* State.Hidden */:\n        return false;\n      case 1 /* State.Loading */:\n        return !this._isAuto;\n      default:\n        this._list.focusNext(1, true);\n        return true;\n    }\n  }\n  selectLast() {\n    switch (this._state) {\n      case 0 /* State.Hidden */:\n        return false;\n      case 5 /* State.Details */:\n        this._details.widget.scrollBottom();\n        return true;\n      case 1 /* State.Loading */:\n        return !this._isAuto;\n      default:\n        this._list.focusLast();\n        return true;\n    }\n  }\n  selectPreviousPage() {\n    switch (this._state) {\n      case 0 /* State.Hidden */:\n        return false;\n      case 5 /* State.Details */:\n        this._details.widget.pageUp();\n        return true;\n      case 1 /* State.Loading */:\n        return !this._isAuto;\n      default:\n        this._list.focusPreviousPage();\n        return true;\n    }\n  }\n  selectPrevious() {\n    switch (this._state) {\n      case 0 /* State.Hidden */:\n        return false;\n      case 1 /* State.Loading */:\n        return !this._isAuto;\n      default:\n        this._list.focusPrevious(1, true);\n        return false;\n    }\n  }\n  selectFirst() {\n    switch (this._state) {\n      case 0 /* State.Hidden */:\n        return false;\n      case 5 /* State.Details */:\n        this._details.widget.scrollTop();\n        return true;\n      case 1 /* State.Loading */:\n        return !this._isAuto;\n      default:\n        this._list.focusFirst();\n        return true;\n    }\n  }\n  getFocusedItem() {\n    if (this._state !== 0 /* State.Hidden */ && this._state !== 2 /* State.Empty */ && this._state !== 1 /* State.Loading */ && this._completionModel && this._list.getFocus().length > 0) {\n      return {\n        item: this._list.getFocusedElements()[0],\n        index: this._list.getFocus()[0],\n        model: this._completionModel\n      };\n    }\n    return undefined;\n  }\n  toggleDetailsFocus() {\n    if (this._state === 5 /* State.Details */) {\n      this._setState(3 /* State.Open */);\n      this._details.widget.domNode.classList.remove('focused');\n    } else if (this._state === 3 /* State.Open */ && this._isDetailsVisible()) {\n      this._setState(5 /* State.Details */);\n      this._details.widget.domNode.classList.add('focused');\n    }\n  }\n  toggleDetails() {\n    if (this._isDetailsVisible()) {\n      // hide details widget\n      this._pendingShowDetails.clear();\n      this._ctxSuggestWidgetDetailsVisible.set(false);\n      this._setDetailsVisible(false);\n      this._details.hide();\n      this.element.domNode.classList.remove('shows-details');\n    } else if ((canExpandCompletionItem(this._list.getFocusedElements()[0]) || this._explainMode) && (this._state === 3 /* State.Open */ || this._state === 5 /* State.Details */ || this._state === 4 /* State.Frozen */)) {\n      // show details widget (iff possible)\n      this._ctxSuggestWidgetDetailsVisible.set(true);\n      this._setDetailsVisible(true);\n      this.showDetails(false);\n    }\n  }\n  showDetails(loading) {\n    this._pendingShowDetails.value = dom.runAtThisOrScheduleAtNextAnimationFrame(() => {\n      this._pendingShowDetails.clear();\n      this._details.show();\n      if (loading) {\n        this._details.widget.renderLoading();\n      } else {\n        this._details.widget.renderItem(this._list.getFocusedElements()[0], this._explainMode);\n      }\n      this._positionDetails();\n      this.editor.focus();\n      this.element.domNode.classList.add('shows-details');\n    });\n  }\n  toggleExplainMode() {\n    if (this._list.getFocusedElements()[0]) {\n      this._explainMode = !this._explainMode;\n      if (!this._isDetailsVisible()) {\n        this.toggleDetails();\n      } else {\n        this.showDetails(false);\n      }\n    }\n  }\n  resetPersistedSize() {\n    this._persistedSize.reset();\n  }\n  hideWidget() {\n    var _a;\n    this._pendingLayout.clear();\n    this._pendingShowDetails.clear();\n    (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n    this._setState(0 /* State.Hidden */);\n    this._onDidHide.fire(this);\n    this.element.clearSashHoverState();\n    // ensure that a reasonable widget height is persisted so that\n    // accidential \"resize-to-single-items\" cases aren't happening\n    const dim = this._persistedSize.restore();\n    const minPersistedHeight = Math.ceil(this.getLayoutInfo().itemHeight * 4.3);\n    if (dim && dim.height < minPersistedHeight) {\n      this._persistedSize.store(dim.with(undefined, minPersistedHeight));\n    }\n  }\n  isFrozen() {\n    return this._state === 4 /* State.Frozen */;\n  }\n\n  _afterRender(position) {\n    if (position === null) {\n      if (this._isDetailsVisible()) {\n        this._details.hide(); //todo@jrieken soft-hide\n      }\n\n      return;\n    }\n    if (this._state === 2 /* State.Empty */ || this._state === 1 /* State.Loading */) {\n      // no special positioning when widget isn't showing list\n      return;\n    }\n    if (this._isDetailsVisible()) {\n      this._details.show();\n    }\n    this._positionDetails();\n  }\n  _layout(size) {\n    var _a, _b, _c;\n    if (!this.editor.hasModel()) {\n      return;\n    }\n    if (!this.editor.getDomNode()) {\n      // happens when running tests\n      return;\n    }\n    const bodyBox = dom.getClientArea(this.element.domNode.ownerDocument.body);\n    const info = this.getLayoutInfo();\n    if (!size) {\n      size = info.defaultSize;\n    }\n    let height = size.height;\n    let width = size.width;\n    // status bar\n    this._status.element.style.height = `${info.itemHeight}px`;\n    if (this._state === 2 /* State.Empty */ || this._state === 1 /* State.Loading */) {\n      // showing a message only\n      height = info.itemHeight + info.borderHeight;\n      width = info.defaultSize.width / 2;\n      this.element.enableSashes(false, false, false, false);\n      this.element.minSize = this.element.maxSize = new dom.Dimension(width, height);\n      this._contentWidget.setPreference(2 /* ContentWidgetPositionPreference.BELOW */);\n    } else {\n      // showing items\n      // width math\n      const maxWidth = bodyBox.width - info.borderHeight - 2 * info.horizontalPadding;\n      if (width > maxWidth) {\n        width = maxWidth;\n      }\n      const preferredWidth = this._completionModel ? this._completionModel.stats.pLabelLen * info.typicalHalfwidthCharacterWidth : width;\n      // height math\n      const fullHeight = info.statusBarHeight + this._list.contentHeight + info.borderHeight;\n      const minHeight = info.itemHeight + info.statusBarHeight;\n      const editorBox = dom.getDomNodePagePosition(this.editor.getDomNode());\n      const cursorBox = this.editor.getScrolledVisiblePosition(this.editor.getPosition());\n      const cursorBottom = editorBox.top + cursorBox.top + cursorBox.height;\n      const maxHeightBelow = Math.min(bodyBox.height - cursorBottom - info.verticalPadding, fullHeight);\n      const availableSpaceAbove = editorBox.top + cursorBox.top - info.verticalPadding;\n      const maxHeightAbove = Math.min(availableSpaceAbove, fullHeight);\n      let maxHeight = Math.min(Math.max(maxHeightAbove, maxHeightBelow) + info.borderHeight, fullHeight);\n      if (height === ((_a = this._cappedHeight) === null || _a === void 0 ? void 0 : _a.capped)) {\n        // Restore the old (wanted) height when the current\n        // height is capped to fit\n        height = this._cappedHeight.wanted;\n      }\n      if (height < minHeight) {\n        height = minHeight;\n      }\n      if (height > maxHeight) {\n        height = maxHeight;\n      }\n      const forceRenderingAboveRequiredSpace = 150;\n      if (height > maxHeightBelow || this._forceRenderingAbove && availableSpaceAbove > forceRenderingAboveRequiredSpace) {\n        this._contentWidget.setPreference(1 /* ContentWidgetPositionPreference.ABOVE */);\n        this.element.enableSashes(true, true, false, false);\n        maxHeight = maxHeightAbove;\n      } else {\n        this._contentWidget.setPreference(2 /* ContentWidgetPositionPreference.BELOW */);\n        this.element.enableSashes(false, true, true, false);\n        maxHeight = maxHeightBelow;\n      }\n      this.element.preferredSize = new dom.Dimension(preferredWidth, info.defaultSize.height);\n      this.element.maxSize = new dom.Dimension(maxWidth, maxHeight);\n      this.element.minSize = new dom.Dimension(220, minHeight);\n      // Know when the height was capped to fit and remember\n      // the wanted height for later. This is required when going\n      // left to widen suggestions.\n      this._cappedHeight = height === fullHeight ? {\n        wanted: (_c = (_b = this._cappedHeight) === null || _b === void 0 ? void 0 : _b.wanted) !== null && _c !== void 0 ? _c : size.height,\n        capped: height\n      } : undefined;\n    }\n    this._resize(width, height);\n  }\n  _resize(width, height) {\n    const {\n      width: maxWidth,\n      height: maxHeight\n    } = this.element.maxSize;\n    width = Math.min(maxWidth, width);\n    height = Math.min(maxHeight, height);\n    const {\n      statusBarHeight\n    } = this.getLayoutInfo();\n    this._list.layout(height - statusBarHeight, width);\n    this._listElement.style.height = `${height - statusBarHeight}px`;\n    this.element.layout(height, width);\n    this._contentWidget.layout();\n    this._positionDetails();\n  }\n  _positionDetails() {\n    var _a;\n    if (this._isDetailsVisible()) {\n      this._details.placeAtAnchor(this.element.domNode, ((_a = this._contentWidget.getPosition()) === null || _a === void 0 ? void 0 : _a.preference[0]) === 2 /* ContentWidgetPositionPreference.BELOW */);\n    }\n  }\n\n  getLayoutInfo() {\n    const fontInfo = this.editor.getOption(50 /* EditorOption.fontInfo */);\n    const itemHeight = clamp(this.editor.getOption(119 /* EditorOption.suggestLineHeight */) || fontInfo.lineHeight, 8, 1000);\n    const statusBarHeight = !this.editor.getOption(117 /* EditorOption.suggest */).showStatusBar || this._state === 2 /* State.Empty */ || this._state === 1 /* State.Loading */ ? 0 : itemHeight;\n    const borderWidth = this._details.widget.borderWidth;\n    const borderHeight = 2 * borderWidth;\n    return {\n      itemHeight,\n      statusBarHeight,\n      borderWidth,\n      borderHeight,\n      typicalHalfwidthCharacterWidth: fontInfo.typicalHalfwidthCharacterWidth,\n      verticalPadding: 22,\n      horizontalPadding: 14,\n      defaultSize: new dom.Dimension(430, statusBarHeight + 12 * itemHeight + borderHeight)\n    };\n  }\n  _isDetailsVisible() {\n    return this._storageService.getBoolean('expandSuggestionDocs', 0 /* StorageScope.PROFILE */, false);\n  }\n  _setDetailsVisible(value) {\n    this._storageService.store('expandSuggestionDocs', value, 0 /* StorageScope.PROFILE */, 0 /* StorageTarget.USER */);\n  }\n\n  forceRenderingAbove() {\n    if (!this._forceRenderingAbove) {\n      this._forceRenderingAbove = true;\n      this._layout(this._persistedSize.restore());\n    }\n  }\n  stopForceRenderingAbove() {\n    this._forceRenderingAbove = false;\n  }\n};\nSuggestWidget.LOADING_MESSAGE = nls.localize('suggestWidget.loading', \"Loading...\");\nSuggestWidget.NO_SUGGESTIONS_MESSAGE = nls.localize('suggestWidget.noSuggestions', \"No suggestions.\");\nSuggestWidget = SuggestWidget_1 = __decorate([__param(1, IStorageService), __param(2, IContextKeyService), __param(3, IThemeService), __param(4, IInstantiationService)], SuggestWidget);\nexport { SuggestWidget };\nexport class SuggestContentWidget {\n  constructor(_widget, _editor) {\n    this._widget = _widget;\n    this._editor = _editor;\n    this.allowEditorOverflow = true;\n    this.suppressMouseDown = false;\n    this._preferenceLocked = false;\n    this._added = false;\n    this._hidden = false;\n  }\n  dispose() {\n    if (this._added) {\n      this._added = false;\n      this._editor.removeContentWidget(this);\n    }\n  }\n  getId() {\n    return 'editor.widget.suggestWidget';\n  }\n  getDomNode() {\n    return this._widget.element.domNode;\n  }\n  show() {\n    this._hidden = false;\n    if (!this._added) {\n      this._added = true;\n      this._editor.addContentWidget(this);\n    }\n  }\n  hide() {\n    if (!this._hidden) {\n      this._hidden = true;\n      this.layout();\n    }\n  }\n  layout() {\n    this._editor.layoutContentWidget(this);\n  }\n  getPosition() {\n    if (this._hidden || !this._position || !this._preference) {\n      return null;\n    }\n    return {\n      position: this._position,\n      preference: [this._preference]\n    };\n  }\n  beforeRender() {\n    const {\n      height,\n      width\n    } = this._widget.element.size;\n    const {\n      borderWidth,\n      horizontalPadding\n    } = this._widget.getLayoutInfo();\n    return new dom.Dimension(width + 2 * borderWidth + horizontalPadding, height + 2 * borderWidth);\n  }\n  afterRender(position) {\n    this._widget._afterRender(position);\n  }\n  setPreference(preference) {\n    if (!this._preferenceLocked) {\n      this._preference = preference;\n    }\n  }\n  lockPreference() {\n    this._preferenceLocked = true;\n  }\n  unlockPreference() {\n    this._preferenceLocked = false;\n  }\n  setPosition(position) {\n    this._position = position;\n  }\n}","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","SuggestWidget_1","dom","List","createCancelablePromise","disposableTimeout","TimeoutTimer","onUnexpectedError","Emitter","PauseableEmitter","DisposableStore","MutableDisposable","clamp","strings","EmbeddedCodeEditorWidget","SuggestWidgetStatus","nls","IContextKeyService","IInstantiationService","IStorageService","activeContrastBorder","editorForeground","editorWidgetBackground","editorWidgetBorder","listFocusHighlightForeground","listHighlightForeground","quickInputListFocusBackground","quickInputListFocusForeground","quickInputListFocusIconForeground","registerColor","transparent","isHighContrast","IThemeService","ResizableHTMLElement","Context","SuggestContext","suggestWidgetStatusbarMenu","canExpandCompletionItem","SuggestDetailsOverlay","SuggestDetailsWidget","getAriaId","ItemRenderer","getListStyles","status","dark","light","hcDark","hcLight","localize","editorSuggestWidgetForeground","editorSuggestWidgetSelectedBackground","PersistedWidgetSize","constructor","_service","editor","_key","getEditorType","restore","_a","raw","get","obj","JSON","parse","Dimension","is","lift","_b","undefined","store","size","stringify","reset","remove","SuggestWidget","_storageService","_contextKeyService","_themeService","instantiationService","_state","_isAuto","_pendingLayout","_pendingShowDetails","_ignoreFocusEvents","_forceRenderingAbove","_explainMode","_showTimeout","_disposables","_onDidSelect","_onDidFocus","_onDidHide","_onDidShow","onDidSelect","event","onDidFocus","onDidHide","onDidShow","_onDetailsKeydown","onDetailsKeyDown","element","domNode","classList","add","_contentWidget","SuggestContentWidget","_persistedSize","ResizeState","persistedSize","currentSize","persistHeight","persistWidth","state","onDidWillResize","lockPreference","onDidResize","_c","_d","_resize","dimension","width","height","north","south","east","west","itemHeight","defaultSize","getLayoutInfo","threshold","Math","round","abs","unlockPreference","_messageElement","append","$","_listElement","details","createInstance","onDidClose","toggleDetails","_details","applyIconStyle","toggle","getOption","showIcons","renderer","onDidToggleDetails","_list","getHeight","_element","getTemplateId","alwaysConsumeMouseWheel","useShadows","mouseSupport","multipleSelectionSupport","accessibilityProvider","getRole","getWidgetAriaLabel","getWidgetRole","getAriaLabel","item","label","textLabel","completion","detail","description","isResolved","_isDetailsVisible","documentation","docs","format","style","listInactiveFocusBackground","listInactiveFocusOutline","_status","applyStatusBarStyle","showStatusBar","onDidColorThemeChange","t","_onThemeChange","getColorTheme","onMouseDown","_onListMouseDownOrTap","onTap","onDidChangeSelection","_onListSelection","onDidChangeFocus","_onListFocus","onDidChangeCursorSelection","_onCursorSelectionChanged","onDidChangeConfiguration","hasChanged","_ctxSuggestWidgetVisible","Visible","bindTo","_ctxSuggestWidgetDetailsVisible","DetailsVisible","_ctxSuggestWidgetMultipleSuggestions","MultipleSuggestions","_ctxSuggestWidgetHasFocusedSuggestion","HasFocusedSuggestion","addStandardDisposableListener","widget","fire","_onEditorMouseDown","dispose","_loadingTimeout","mouseEvent","contains","focus","layout","index","browserEvent","preventDefault","stopPropagation","_select","elements","indexes","completionModel","_completionModel","model","theme","borderWidth","type","_currentSuggestionDetails","cancel","_focusedItem","setAriaOptions","activeDescendant","set","reveal","token","loading","showDetails","sub","onCancellationRequested","splice","setFocus","catch","_setState","hide","_cappedHeight","textContent","LOADING_MESSAGE","show","_show","NO_SUGGESTIONS_MESSAGE","_layout","cancelAndSet","showTriggered","auto","delay","setPosition","getPosition","showSuggestions","selectionIndex","isFrozen","isAuto","noFocus","visibleCount","items","isEmpty","pause","resume","runAtThisOrScheduleAtNextAnimationFrame","clear","focusSelected","selectNextPage","pageDown","focusNextPage","selectNext","focusNext","selectLast","scrollBottom","focusLast","selectPreviousPage","pageUp","focusPreviousPage","selectPrevious","focusPrevious","selectFirst","scrollTop","focusFirst","getFocusedItem","getFocus","getFocusedElements","toggleDetailsFocus","_setDetailsVisible","renderLoading","renderItem","_positionDetails","toggleExplainMode","resetPersistedSize","hideWidget","clearSashHoverState","dim","minPersistedHeight","ceil","with","_afterRender","position","hasModel","getDomNode","bodyBox","getClientArea","ownerDocument","body","info","borderHeight","enableSashes","minSize","maxSize","setPreference","maxWidth","horizontalPadding","preferredWidth","stats","pLabelLen","typicalHalfwidthCharacterWidth","fullHeight","statusBarHeight","contentHeight","minHeight","editorBox","getDomNodePagePosition","cursorBox","getScrolledVisiblePosition","cursorBottom","top","maxHeightBelow","min","verticalPadding","availableSpaceAbove","maxHeightAbove","maxHeight","max","capped","wanted","forceRenderingAboveRequiredSpace","preferredSize","placeAtAnchor","preference","fontInfo","lineHeight","getBoolean","forceRenderingAbove","stopForceRenderingAbove","_widget","_editor","allowEditorOverflow","suppressMouseDown","_preferenceLocked","_added","_hidden","removeContentWidget","getId","addContentWidget","layoutContentWidget","_position","_preference","beforeRender","afterRender"],"sources":["/home/chlohest/work/website/my_web/node_modules/monaco-editor/esm/vs/editor/contrib/suggest/browser/suggestWidget.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar SuggestWidget_1;\nimport * as dom from '../../../../base/browser/dom.js';\nimport '../../../../base/browser/ui/codicons/codiconStyles.js'; // The codicon symbol styles are defined here and must be loaded\nimport { List } from '../../../../base/browser/ui/list/listWidget.js';\nimport { createCancelablePromise, disposableTimeout, TimeoutTimer } from '../../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Emitter, PauseableEmitter } from '../../../../base/common/event.js';\nimport { DisposableStore, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { clamp } from '../../../../base/common/numbers.js';\nimport * as strings from '../../../../base/common/strings.js';\nimport './media/suggest.css';\nimport { EmbeddedCodeEditorWidget } from '../../../browser/widget/embeddedCodeEditorWidget.js';\nimport { SuggestWidgetStatus } from './suggestWidgetStatus.js';\nimport '../../symbolIcons/browser/symbolIcons.js'; // The codicon symbol colors are defined here and must be loaded to get colors\nimport * as nls from '../../../../nls.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { activeContrastBorder, editorForeground, editorWidgetBackground, editorWidgetBorder, listFocusHighlightForeground, listHighlightForeground, quickInputListFocusBackground, quickInputListFocusForeground, quickInputListFocusIconForeground, registerColor, transparent } from '../../../../platform/theme/common/colorRegistry.js';\nimport { isHighContrast } from '../../../../platform/theme/common/theme.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { ResizableHTMLElement } from '../../../../base/browser/ui/resizable/resizable.js';\nimport { Context as SuggestContext, suggestWidgetStatusbarMenu } from './suggest.js';\nimport { canExpandCompletionItem, SuggestDetailsOverlay, SuggestDetailsWidget } from './suggestWidgetDetails.js';\nimport { getAriaId, ItemRenderer } from './suggestWidgetRenderer.js';\nimport { getListStyles } from '../../../../platform/theme/browser/defaultStyles.js';\nimport { status } from '../../../../base/browser/ui/aria/aria.js';\n/**\n * Suggest widget colors\n */\nregisterColor('editorSuggestWidget.background', { dark: editorWidgetBackground, light: editorWidgetBackground, hcDark: editorWidgetBackground, hcLight: editorWidgetBackground }, nls.localize('editorSuggestWidgetBackground', 'Background color of the suggest widget.'));\nregisterColor('editorSuggestWidget.border', { dark: editorWidgetBorder, light: editorWidgetBorder, hcDark: editorWidgetBorder, hcLight: editorWidgetBorder }, nls.localize('editorSuggestWidgetBorder', 'Border color of the suggest widget.'));\nconst editorSuggestWidgetForeground = registerColor('editorSuggestWidget.foreground', { dark: editorForeground, light: editorForeground, hcDark: editorForeground, hcLight: editorForeground }, nls.localize('editorSuggestWidgetForeground', 'Foreground color of the suggest widget.'));\nregisterColor('editorSuggestWidget.selectedForeground', { dark: quickInputListFocusForeground, light: quickInputListFocusForeground, hcDark: quickInputListFocusForeground, hcLight: quickInputListFocusForeground }, nls.localize('editorSuggestWidgetSelectedForeground', 'Foreground color of the selected entry in the suggest widget.'));\nregisterColor('editorSuggestWidget.selectedIconForeground', { dark: quickInputListFocusIconForeground, light: quickInputListFocusIconForeground, hcDark: quickInputListFocusIconForeground, hcLight: quickInputListFocusIconForeground }, nls.localize('editorSuggestWidgetSelectedIconForeground', 'Icon foreground color of the selected entry in the suggest widget.'));\nexport const editorSuggestWidgetSelectedBackground = registerColor('editorSuggestWidget.selectedBackground', { dark: quickInputListFocusBackground, light: quickInputListFocusBackground, hcDark: quickInputListFocusBackground, hcLight: quickInputListFocusBackground }, nls.localize('editorSuggestWidgetSelectedBackground', 'Background color of the selected entry in the suggest widget.'));\nregisterColor('editorSuggestWidget.highlightForeground', { dark: listHighlightForeground, light: listHighlightForeground, hcDark: listHighlightForeground, hcLight: listHighlightForeground }, nls.localize('editorSuggestWidgetHighlightForeground', 'Color of the match highlights in the suggest widget.'));\nregisterColor('editorSuggestWidget.focusHighlightForeground', { dark: listFocusHighlightForeground, light: listFocusHighlightForeground, hcDark: listFocusHighlightForeground, hcLight: listFocusHighlightForeground }, nls.localize('editorSuggestWidgetFocusHighlightForeground', 'Color of the match highlights in the suggest widget when an item is focused.'));\nregisterColor('editorSuggestWidgetStatus.foreground', { dark: transparent(editorSuggestWidgetForeground, .5), light: transparent(editorSuggestWidgetForeground, .5), hcDark: transparent(editorSuggestWidgetForeground, .5), hcLight: transparent(editorSuggestWidgetForeground, .5) }, nls.localize('editorSuggestWidgetStatusForeground', 'Foreground color of the suggest widget status.'));\nclass PersistedWidgetSize {\n    constructor(_service, editor) {\n        this._service = _service;\n        this._key = `suggestWidget.size/${editor.getEditorType()}/${editor instanceof EmbeddedCodeEditorWidget}`;\n    }\n    restore() {\n        var _a;\n        const raw = (_a = this._service.get(this._key, 0 /* StorageScope.PROFILE */)) !== null && _a !== void 0 ? _a : '';\n        try {\n            const obj = JSON.parse(raw);\n            if (dom.Dimension.is(obj)) {\n                return dom.Dimension.lift(obj);\n            }\n        }\n        catch (_b) {\n            // ignore\n        }\n        return undefined;\n    }\n    store(size) {\n        this._service.store(this._key, JSON.stringify(size), 0 /* StorageScope.PROFILE */, 1 /* StorageTarget.MACHINE */);\n    }\n    reset() {\n        this._service.remove(this._key, 0 /* StorageScope.PROFILE */);\n    }\n}\nlet SuggestWidget = SuggestWidget_1 = class SuggestWidget {\n    constructor(editor, _storageService, _contextKeyService, _themeService, instantiationService) {\n        this.editor = editor;\n        this._storageService = _storageService;\n        this._state = 0 /* State.Hidden */;\n        this._isAuto = false;\n        this._pendingLayout = new MutableDisposable();\n        this._pendingShowDetails = new MutableDisposable();\n        this._ignoreFocusEvents = false;\n        this._forceRenderingAbove = false;\n        this._explainMode = false;\n        this._showTimeout = new TimeoutTimer();\n        this._disposables = new DisposableStore();\n        this._onDidSelect = new PauseableEmitter();\n        this._onDidFocus = new PauseableEmitter();\n        this._onDidHide = new Emitter();\n        this._onDidShow = new Emitter();\n        this.onDidSelect = this._onDidSelect.event;\n        this.onDidFocus = this._onDidFocus.event;\n        this.onDidHide = this._onDidHide.event;\n        this.onDidShow = this._onDidShow.event;\n        this._onDetailsKeydown = new Emitter();\n        this.onDetailsKeyDown = this._onDetailsKeydown.event;\n        this.element = new ResizableHTMLElement();\n        this.element.domNode.classList.add('editor-widget', 'suggest-widget');\n        this._contentWidget = new SuggestContentWidget(this, editor);\n        this._persistedSize = new PersistedWidgetSize(_storageService, editor);\n        class ResizeState {\n            constructor(persistedSize, currentSize, persistHeight = false, persistWidth = false) {\n                this.persistedSize = persistedSize;\n                this.currentSize = currentSize;\n                this.persistHeight = persistHeight;\n                this.persistWidth = persistWidth;\n            }\n        }\n        let state;\n        this._disposables.add(this.element.onDidWillResize(() => {\n            this._contentWidget.lockPreference();\n            state = new ResizeState(this._persistedSize.restore(), this.element.size);\n        }));\n        this._disposables.add(this.element.onDidResize(e => {\n            var _a, _b, _c, _d;\n            this._resize(e.dimension.width, e.dimension.height);\n            if (state) {\n                state.persistHeight = state.persistHeight || !!e.north || !!e.south;\n                state.persistWidth = state.persistWidth || !!e.east || !!e.west;\n            }\n            if (!e.done) {\n                return;\n            }\n            if (state) {\n                // only store width or height value that have changed and also\n                // only store changes that are above a certain threshold\n                const { itemHeight, defaultSize } = this.getLayoutInfo();\n                const threshold = Math.round(itemHeight / 2);\n                let { width, height } = this.element.size;\n                if (!state.persistHeight || Math.abs(state.currentSize.height - height) <= threshold) {\n                    height = (_b = (_a = state.persistedSize) === null || _a === void 0 ? void 0 : _a.height) !== null && _b !== void 0 ? _b : defaultSize.height;\n                }\n                if (!state.persistWidth || Math.abs(state.currentSize.width - width) <= threshold) {\n                    width = (_d = (_c = state.persistedSize) === null || _c === void 0 ? void 0 : _c.width) !== null && _d !== void 0 ? _d : defaultSize.width;\n                }\n                this._persistedSize.store(new dom.Dimension(width, height));\n            }\n            // reset working state\n            this._contentWidget.unlockPreference();\n            state = undefined;\n        }));\n        this._messageElement = dom.append(this.element.domNode, dom.$('.message'));\n        this._listElement = dom.append(this.element.domNode, dom.$('.tree'));\n        const details = this._disposables.add(instantiationService.createInstance(SuggestDetailsWidget, this.editor));\n        details.onDidClose(this.toggleDetails, this, this._disposables);\n        this._details = new SuggestDetailsOverlay(details, this.editor);\n        const applyIconStyle = () => this.element.domNode.classList.toggle('no-icons', !this.editor.getOption(117 /* EditorOption.suggest */).showIcons);\n        applyIconStyle();\n        const renderer = instantiationService.createInstance(ItemRenderer, this.editor);\n        this._disposables.add(renderer);\n        this._disposables.add(renderer.onDidToggleDetails(() => this.toggleDetails()));\n        this._list = new List('SuggestWidget', this._listElement, {\n            getHeight: (_element) => this.getLayoutInfo().itemHeight,\n            getTemplateId: (_element) => 'suggestion'\n        }, [renderer], {\n            alwaysConsumeMouseWheel: true,\n            useShadows: false,\n            mouseSupport: false,\n            multipleSelectionSupport: false,\n            accessibilityProvider: {\n                getRole: () => 'option',\n                getWidgetAriaLabel: () => nls.localize('suggest', \"Suggest\"),\n                getWidgetRole: () => 'listbox',\n                getAriaLabel: (item) => {\n                    let label = item.textLabel;\n                    if (typeof item.completion.label !== 'string') {\n                        const { detail, description } = item.completion.label;\n                        if (detail && description) {\n                            label = nls.localize('label.full', '{0} {1}, {2}', label, detail, description);\n                        }\n                        else if (detail) {\n                            label = nls.localize('label.detail', '{0} {1}', label, detail);\n                        }\n                        else if (description) {\n                            label = nls.localize('label.desc', '{0}, {1}', label, description);\n                        }\n                    }\n                    if (!item.isResolved || !this._isDetailsVisible()) {\n                        return label;\n                    }\n                    const { documentation, detail } = item.completion;\n                    const docs = strings.format('{0}{1}', detail || '', documentation ? (typeof documentation === 'string' ? documentation : documentation.value) : '');\n                    return nls.localize('ariaCurrenttSuggestionReadDetails', \"{0}, docs: {1}\", label, docs);\n                },\n            }\n        });\n        this._list.style(getListStyles({\n            listInactiveFocusBackground: editorSuggestWidgetSelectedBackground,\n            listInactiveFocusOutline: activeContrastBorder\n        }));\n        this._status = instantiationService.createInstance(SuggestWidgetStatus, this.element.domNode, suggestWidgetStatusbarMenu);\n        const applyStatusBarStyle = () => this.element.domNode.classList.toggle('with-status-bar', this.editor.getOption(117 /* EditorOption.suggest */).showStatusBar);\n        applyStatusBarStyle();\n        this._disposables.add(_themeService.onDidColorThemeChange(t => this._onThemeChange(t)));\n        this._onThemeChange(_themeService.getColorTheme());\n        this._disposables.add(this._list.onMouseDown(e => this._onListMouseDownOrTap(e)));\n        this._disposables.add(this._list.onTap(e => this._onListMouseDownOrTap(e)));\n        this._disposables.add(this._list.onDidChangeSelection(e => this._onListSelection(e)));\n        this._disposables.add(this._list.onDidChangeFocus(e => this._onListFocus(e)));\n        this._disposables.add(this.editor.onDidChangeCursorSelection(() => this._onCursorSelectionChanged()));\n        this._disposables.add(this.editor.onDidChangeConfiguration(e => {\n            if (e.hasChanged(117 /* EditorOption.suggest */)) {\n                applyStatusBarStyle();\n                applyIconStyle();\n            }\n        }));\n        this._ctxSuggestWidgetVisible = SuggestContext.Visible.bindTo(_contextKeyService);\n        this._ctxSuggestWidgetDetailsVisible = SuggestContext.DetailsVisible.bindTo(_contextKeyService);\n        this._ctxSuggestWidgetMultipleSuggestions = SuggestContext.MultipleSuggestions.bindTo(_contextKeyService);\n        this._ctxSuggestWidgetHasFocusedSuggestion = SuggestContext.HasFocusedSuggestion.bindTo(_contextKeyService);\n        this._disposables.add(dom.addStandardDisposableListener(this._details.widget.domNode, 'keydown', e => {\n            this._onDetailsKeydown.fire(e);\n        }));\n        this._disposables.add(this.editor.onMouseDown((e) => this._onEditorMouseDown(e)));\n    }\n    dispose() {\n        var _a;\n        this._details.widget.dispose();\n        this._details.dispose();\n        this._list.dispose();\n        this._status.dispose();\n        this._disposables.dispose();\n        (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n        this._pendingLayout.dispose();\n        this._pendingShowDetails.dispose();\n        this._showTimeout.dispose();\n        this._contentWidget.dispose();\n        this.element.dispose();\n    }\n    _onEditorMouseDown(mouseEvent) {\n        if (this._details.widget.domNode.contains(mouseEvent.target.element)) {\n            // Clicking inside details\n            this._details.widget.domNode.focus();\n        }\n        else {\n            // Clicking outside details and inside suggest\n            if (this.element.domNode.contains(mouseEvent.target.element)) {\n                this.editor.focus();\n            }\n        }\n    }\n    _onCursorSelectionChanged() {\n        if (this._state !== 0 /* State.Hidden */) {\n            this._contentWidget.layout();\n        }\n    }\n    _onListMouseDownOrTap(e) {\n        if (typeof e.element === 'undefined' || typeof e.index === 'undefined') {\n            return;\n        }\n        // prevent stealing browser focus from the editor\n        e.browserEvent.preventDefault();\n        e.browserEvent.stopPropagation();\n        this._select(e.element, e.index);\n    }\n    _onListSelection(e) {\n        if (e.elements.length) {\n            this._select(e.elements[0], e.indexes[0]);\n        }\n    }\n    _select(item, index) {\n        const completionModel = this._completionModel;\n        if (completionModel) {\n            this._onDidSelect.fire({ item, index, model: completionModel });\n            this.editor.focus();\n        }\n    }\n    _onThemeChange(theme) {\n        this._details.widget.borderWidth = isHighContrast(theme.type) ? 2 : 1;\n    }\n    _onListFocus(e) {\n        var _a;\n        if (this._ignoreFocusEvents) {\n            return;\n        }\n        if (!e.elements.length) {\n            if (this._currentSuggestionDetails) {\n                this._currentSuggestionDetails.cancel();\n                this._currentSuggestionDetails = undefined;\n                this._focusedItem = undefined;\n            }\n            this.editor.setAriaOptions({ activeDescendant: undefined });\n            this._ctxSuggestWidgetHasFocusedSuggestion.set(false);\n            return;\n        }\n        if (!this._completionModel) {\n            return;\n        }\n        this._ctxSuggestWidgetHasFocusedSuggestion.set(true);\n        const item = e.elements[0];\n        const index = e.indexes[0];\n        if (item !== this._focusedItem) {\n            (_a = this._currentSuggestionDetails) === null || _a === void 0 ? void 0 : _a.cancel();\n            this._currentSuggestionDetails = undefined;\n            this._focusedItem = item;\n            this._list.reveal(index);\n            this._currentSuggestionDetails = createCancelablePromise((token) => __awaiter(this, void 0, void 0, function* () {\n                const loading = disposableTimeout(() => {\n                    if (this._isDetailsVisible()) {\n                        this.showDetails(true);\n                    }\n                }, 250);\n                const sub = token.onCancellationRequested(() => loading.dispose());\n                try {\n                    return yield item.resolve(token);\n                }\n                finally {\n                    loading.dispose();\n                    sub.dispose();\n                }\n            }));\n            this._currentSuggestionDetails.then(() => {\n                if (index >= this._list.length || item !== this._list.element(index)) {\n                    return;\n                }\n                // item can have extra information, so re-render\n                this._ignoreFocusEvents = true;\n                this._list.splice(index, 1, [item]);\n                this._list.setFocus([index]);\n                this._ignoreFocusEvents = false;\n                if (this._isDetailsVisible()) {\n                    this.showDetails(false);\n                }\n                else {\n                    this.element.domNode.classList.remove('docs-side');\n                }\n                this.editor.setAriaOptions({ activeDescendant: getAriaId(index) });\n            }).catch(onUnexpectedError);\n        }\n        // emit an event\n        this._onDidFocus.fire({ item, index, model: this._completionModel });\n    }\n    _setState(state) {\n        if (this._state === state) {\n            return;\n        }\n        this._state = state;\n        this.element.domNode.classList.toggle('frozen', state === 4 /* State.Frozen */);\n        this.element.domNode.classList.remove('message');\n        switch (state) {\n            case 0 /* State.Hidden */:\n                dom.hide(this._messageElement, this._listElement, this._status.element);\n                this._details.hide(true);\n                this._status.hide();\n                this._contentWidget.hide();\n                this._ctxSuggestWidgetVisible.reset();\n                this._ctxSuggestWidgetMultipleSuggestions.reset();\n                this._ctxSuggestWidgetHasFocusedSuggestion.reset();\n                this._showTimeout.cancel();\n                this.element.domNode.classList.remove('visible');\n                this._list.splice(0, this._list.length);\n                this._focusedItem = undefined;\n                this._cappedHeight = undefined;\n                this._explainMode = false;\n                break;\n            case 1 /* State.Loading */:\n                this.element.domNode.classList.add('message');\n                this._messageElement.textContent = SuggestWidget_1.LOADING_MESSAGE;\n                dom.hide(this._listElement, this._status.element);\n                dom.show(this._messageElement);\n                this._details.hide();\n                this._show();\n                this._focusedItem = undefined;\n                status(SuggestWidget_1.LOADING_MESSAGE);\n                break;\n            case 2 /* State.Empty */:\n                this.element.domNode.classList.add('message');\n                this._messageElement.textContent = SuggestWidget_1.NO_SUGGESTIONS_MESSAGE;\n                dom.hide(this._listElement, this._status.element);\n                dom.show(this._messageElement);\n                this._details.hide();\n                this._show();\n                this._focusedItem = undefined;\n                status(SuggestWidget_1.NO_SUGGESTIONS_MESSAGE);\n                break;\n            case 3 /* State.Open */:\n                dom.hide(this._messageElement);\n                dom.show(this._listElement, this._status.element);\n                this._show();\n                break;\n            case 4 /* State.Frozen */:\n                dom.hide(this._messageElement);\n                dom.show(this._listElement, this._status.element);\n                this._show();\n                break;\n            case 5 /* State.Details */:\n                dom.hide(this._messageElement);\n                dom.show(this._listElement, this._status.element);\n                this._details.show();\n                this._show();\n                break;\n        }\n    }\n    _show() {\n        this._status.show();\n        this._contentWidget.show();\n        this._layout(this._persistedSize.restore());\n        this._ctxSuggestWidgetVisible.set(true);\n        this._showTimeout.cancelAndSet(() => {\n            this.element.domNode.classList.add('visible');\n            this._onDidShow.fire(this);\n        }, 100);\n    }\n    showTriggered(auto, delay) {\n        if (this._state !== 0 /* State.Hidden */) {\n            return;\n        }\n        this._contentWidget.setPosition(this.editor.getPosition());\n        this._isAuto = !!auto;\n        if (!this._isAuto) {\n            this._loadingTimeout = disposableTimeout(() => this._setState(1 /* State.Loading */), delay);\n        }\n    }\n    showSuggestions(completionModel, selectionIndex, isFrozen, isAuto, noFocus) {\n        var _a, _b;\n        this._contentWidget.setPosition(this.editor.getPosition());\n        (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n        (_b = this._currentSuggestionDetails) === null || _b === void 0 ? void 0 : _b.cancel();\n        this._currentSuggestionDetails = undefined;\n        if (this._completionModel !== completionModel) {\n            this._completionModel = completionModel;\n        }\n        if (isFrozen && this._state !== 2 /* State.Empty */ && this._state !== 0 /* State.Hidden */) {\n            this._setState(4 /* State.Frozen */);\n            return;\n        }\n        const visibleCount = this._completionModel.items.length;\n        const isEmpty = visibleCount === 0;\n        this._ctxSuggestWidgetMultipleSuggestions.set(visibleCount > 1);\n        if (isEmpty) {\n            this._setState(isAuto ? 0 /* State.Hidden */ : 2 /* State.Empty */);\n            this._completionModel = undefined;\n            return;\n        }\n        this._focusedItem = undefined;\n        // calling list.splice triggers focus event which this widget forwards. That can lead to\n        // suggestions being cancelled and the widget being cleared (and hidden). All this happens\n        // before revealing and focusing is done which means revealing and focusing will fail when\n        // they get run.\n        this._onDidFocus.pause();\n        this._onDidSelect.pause();\n        try {\n            this._list.splice(0, this._list.length, this._completionModel.items);\n            this._setState(isFrozen ? 4 /* State.Frozen */ : 3 /* State.Open */);\n            this._list.reveal(selectionIndex, 0);\n            this._list.setFocus(noFocus ? [] : [selectionIndex]);\n        }\n        finally {\n            this._onDidFocus.resume();\n            this._onDidSelect.resume();\n        }\n        this._pendingLayout.value = dom.runAtThisOrScheduleAtNextAnimationFrame(() => {\n            this._pendingLayout.clear();\n            this._layout(this.element.size);\n            // Reset focus border\n            this._details.widget.domNode.classList.remove('focused');\n        });\n    }\n    focusSelected() {\n        if (this._list.length > 0) {\n            this._list.setFocus([0]);\n        }\n    }\n    selectNextPage() {\n        switch (this._state) {\n            case 0 /* State.Hidden */:\n                return false;\n            case 5 /* State.Details */:\n                this._details.widget.pageDown();\n                return true;\n            case 1 /* State.Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusNextPage();\n                return true;\n        }\n    }\n    selectNext() {\n        switch (this._state) {\n            case 0 /* State.Hidden */:\n                return false;\n            case 1 /* State.Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusNext(1, true);\n                return true;\n        }\n    }\n    selectLast() {\n        switch (this._state) {\n            case 0 /* State.Hidden */:\n                return false;\n            case 5 /* State.Details */:\n                this._details.widget.scrollBottom();\n                return true;\n            case 1 /* State.Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusLast();\n                return true;\n        }\n    }\n    selectPreviousPage() {\n        switch (this._state) {\n            case 0 /* State.Hidden */:\n                return false;\n            case 5 /* State.Details */:\n                this._details.widget.pageUp();\n                return true;\n            case 1 /* State.Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusPreviousPage();\n                return true;\n        }\n    }\n    selectPrevious() {\n        switch (this._state) {\n            case 0 /* State.Hidden */:\n                return false;\n            case 1 /* State.Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusPrevious(1, true);\n                return false;\n        }\n    }\n    selectFirst() {\n        switch (this._state) {\n            case 0 /* State.Hidden */:\n                return false;\n            case 5 /* State.Details */:\n                this._details.widget.scrollTop();\n                return true;\n            case 1 /* State.Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusFirst();\n                return true;\n        }\n    }\n    getFocusedItem() {\n        if (this._state !== 0 /* State.Hidden */\n            && this._state !== 2 /* State.Empty */\n            && this._state !== 1 /* State.Loading */\n            && this._completionModel\n            && this._list.getFocus().length > 0) {\n            return {\n                item: this._list.getFocusedElements()[0],\n                index: this._list.getFocus()[0],\n                model: this._completionModel\n            };\n        }\n        return undefined;\n    }\n    toggleDetailsFocus() {\n        if (this._state === 5 /* State.Details */) {\n            this._setState(3 /* State.Open */);\n            this._details.widget.domNode.classList.remove('focused');\n        }\n        else if (this._state === 3 /* State.Open */ && this._isDetailsVisible()) {\n            this._setState(5 /* State.Details */);\n            this._details.widget.domNode.classList.add('focused');\n        }\n    }\n    toggleDetails() {\n        if (this._isDetailsVisible()) {\n            // hide details widget\n            this._pendingShowDetails.clear();\n            this._ctxSuggestWidgetDetailsVisible.set(false);\n            this._setDetailsVisible(false);\n            this._details.hide();\n            this.element.domNode.classList.remove('shows-details');\n        }\n        else if ((canExpandCompletionItem(this._list.getFocusedElements()[0]) || this._explainMode) && (this._state === 3 /* State.Open */ || this._state === 5 /* State.Details */ || this._state === 4 /* State.Frozen */)) {\n            // show details widget (iff possible)\n            this._ctxSuggestWidgetDetailsVisible.set(true);\n            this._setDetailsVisible(true);\n            this.showDetails(false);\n        }\n    }\n    showDetails(loading) {\n        this._pendingShowDetails.value = dom.runAtThisOrScheduleAtNextAnimationFrame(() => {\n            this._pendingShowDetails.clear();\n            this._details.show();\n            if (loading) {\n                this._details.widget.renderLoading();\n            }\n            else {\n                this._details.widget.renderItem(this._list.getFocusedElements()[0], this._explainMode);\n            }\n            this._positionDetails();\n            this.editor.focus();\n            this.element.domNode.classList.add('shows-details');\n        });\n    }\n    toggleExplainMode() {\n        if (this._list.getFocusedElements()[0]) {\n            this._explainMode = !this._explainMode;\n            if (!this._isDetailsVisible()) {\n                this.toggleDetails();\n            }\n            else {\n                this.showDetails(false);\n            }\n        }\n    }\n    resetPersistedSize() {\n        this._persistedSize.reset();\n    }\n    hideWidget() {\n        var _a;\n        this._pendingLayout.clear();\n        this._pendingShowDetails.clear();\n        (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n        this._setState(0 /* State.Hidden */);\n        this._onDidHide.fire(this);\n        this.element.clearSashHoverState();\n        // ensure that a reasonable widget height is persisted so that\n        // accidential \"resize-to-single-items\" cases aren't happening\n        const dim = this._persistedSize.restore();\n        const minPersistedHeight = Math.ceil(this.getLayoutInfo().itemHeight * 4.3);\n        if (dim && dim.height < minPersistedHeight) {\n            this._persistedSize.store(dim.with(undefined, minPersistedHeight));\n        }\n    }\n    isFrozen() {\n        return this._state === 4 /* State.Frozen */;\n    }\n    _afterRender(position) {\n        if (position === null) {\n            if (this._isDetailsVisible()) {\n                this._details.hide(); //todo@jrieken soft-hide\n            }\n            return;\n        }\n        if (this._state === 2 /* State.Empty */ || this._state === 1 /* State.Loading */) {\n            // no special positioning when widget isn't showing list\n            return;\n        }\n        if (this._isDetailsVisible()) {\n            this._details.show();\n        }\n        this._positionDetails();\n    }\n    _layout(size) {\n        var _a, _b, _c;\n        if (!this.editor.hasModel()) {\n            return;\n        }\n        if (!this.editor.getDomNode()) {\n            // happens when running tests\n            return;\n        }\n        const bodyBox = dom.getClientArea(this.element.domNode.ownerDocument.body);\n        const info = this.getLayoutInfo();\n        if (!size) {\n            size = info.defaultSize;\n        }\n        let height = size.height;\n        let width = size.width;\n        // status bar\n        this._status.element.style.height = `${info.itemHeight}px`;\n        if (this._state === 2 /* State.Empty */ || this._state === 1 /* State.Loading */) {\n            // showing a message only\n            height = info.itemHeight + info.borderHeight;\n            width = info.defaultSize.width / 2;\n            this.element.enableSashes(false, false, false, false);\n            this.element.minSize = this.element.maxSize = new dom.Dimension(width, height);\n            this._contentWidget.setPreference(2 /* ContentWidgetPositionPreference.BELOW */);\n        }\n        else {\n            // showing items\n            // width math\n            const maxWidth = bodyBox.width - info.borderHeight - 2 * info.horizontalPadding;\n            if (width > maxWidth) {\n                width = maxWidth;\n            }\n            const preferredWidth = this._completionModel ? this._completionModel.stats.pLabelLen * info.typicalHalfwidthCharacterWidth : width;\n            // height math\n            const fullHeight = info.statusBarHeight + this._list.contentHeight + info.borderHeight;\n            const minHeight = info.itemHeight + info.statusBarHeight;\n            const editorBox = dom.getDomNodePagePosition(this.editor.getDomNode());\n            const cursorBox = this.editor.getScrolledVisiblePosition(this.editor.getPosition());\n            const cursorBottom = editorBox.top + cursorBox.top + cursorBox.height;\n            const maxHeightBelow = Math.min(bodyBox.height - cursorBottom - info.verticalPadding, fullHeight);\n            const availableSpaceAbove = editorBox.top + cursorBox.top - info.verticalPadding;\n            const maxHeightAbove = Math.min(availableSpaceAbove, fullHeight);\n            let maxHeight = Math.min(Math.max(maxHeightAbove, maxHeightBelow) + info.borderHeight, fullHeight);\n            if (height === ((_a = this._cappedHeight) === null || _a === void 0 ? void 0 : _a.capped)) {\n                // Restore the old (wanted) height when the current\n                // height is capped to fit\n                height = this._cappedHeight.wanted;\n            }\n            if (height < minHeight) {\n                height = minHeight;\n            }\n            if (height > maxHeight) {\n                height = maxHeight;\n            }\n            const forceRenderingAboveRequiredSpace = 150;\n            if (height > maxHeightBelow || (this._forceRenderingAbove && availableSpaceAbove > forceRenderingAboveRequiredSpace)) {\n                this._contentWidget.setPreference(1 /* ContentWidgetPositionPreference.ABOVE */);\n                this.element.enableSashes(true, true, false, false);\n                maxHeight = maxHeightAbove;\n            }\n            else {\n                this._contentWidget.setPreference(2 /* ContentWidgetPositionPreference.BELOW */);\n                this.element.enableSashes(false, true, true, false);\n                maxHeight = maxHeightBelow;\n            }\n            this.element.preferredSize = new dom.Dimension(preferredWidth, info.defaultSize.height);\n            this.element.maxSize = new dom.Dimension(maxWidth, maxHeight);\n            this.element.minSize = new dom.Dimension(220, minHeight);\n            // Know when the height was capped to fit and remember\n            // the wanted height for later. This is required when going\n            // left to widen suggestions.\n            this._cappedHeight = height === fullHeight\n                ? { wanted: (_c = (_b = this._cappedHeight) === null || _b === void 0 ? void 0 : _b.wanted) !== null && _c !== void 0 ? _c : size.height, capped: height }\n                : undefined;\n        }\n        this._resize(width, height);\n    }\n    _resize(width, height) {\n        const { width: maxWidth, height: maxHeight } = this.element.maxSize;\n        width = Math.min(maxWidth, width);\n        height = Math.min(maxHeight, height);\n        const { statusBarHeight } = this.getLayoutInfo();\n        this._list.layout(height - statusBarHeight, width);\n        this._listElement.style.height = `${height - statusBarHeight}px`;\n        this.element.layout(height, width);\n        this._contentWidget.layout();\n        this._positionDetails();\n    }\n    _positionDetails() {\n        var _a;\n        if (this._isDetailsVisible()) {\n            this._details.placeAtAnchor(this.element.domNode, ((_a = this._contentWidget.getPosition()) === null || _a === void 0 ? void 0 : _a.preference[0]) === 2 /* ContentWidgetPositionPreference.BELOW */);\n        }\n    }\n    getLayoutInfo() {\n        const fontInfo = this.editor.getOption(50 /* EditorOption.fontInfo */);\n        const itemHeight = clamp(this.editor.getOption(119 /* EditorOption.suggestLineHeight */) || fontInfo.lineHeight, 8, 1000);\n        const statusBarHeight = !this.editor.getOption(117 /* EditorOption.suggest */).showStatusBar || this._state === 2 /* State.Empty */ || this._state === 1 /* State.Loading */ ? 0 : itemHeight;\n        const borderWidth = this._details.widget.borderWidth;\n        const borderHeight = 2 * borderWidth;\n        return {\n            itemHeight,\n            statusBarHeight,\n            borderWidth,\n            borderHeight,\n            typicalHalfwidthCharacterWidth: fontInfo.typicalHalfwidthCharacterWidth,\n            verticalPadding: 22,\n            horizontalPadding: 14,\n            defaultSize: new dom.Dimension(430, statusBarHeight + 12 * itemHeight + borderHeight)\n        };\n    }\n    _isDetailsVisible() {\n        return this._storageService.getBoolean('expandSuggestionDocs', 0 /* StorageScope.PROFILE */, false);\n    }\n    _setDetailsVisible(value) {\n        this._storageService.store('expandSuggestionDocs', value, 0 /* StorageScope.PROFILE */, 0 /* StorageTarget.USER */);\n    }\n    forceRenderingAbove() {\n        if (!this._forceRenderingAbove) {\n            this._forceRenderingAbove = true;\n            this._layout(this._persistedSize.restore());\n        }\n    }\n    stopForceRenderingAbove() {\n        this._forceRenderingAbove = false;\n    }\n};\nSuggestWidget.LOADING_MESSAGE = nls.localize('suggestWidget.loading', \"Loading...\");\nSuggestWidget.NO_SUGGESTIONS_MESSAGE = nls.localize('suggestWidget.noSuggestions', \"No suggestions.\");\nSuggestWidget = SuggestWidget_1 = __decorate([\n    __param(1, IStorageService),\n    __param(2, IContextKeyService),\n    __param(3, IThemeService),\n    __param(4, IInstantiationService)\n], SuggestWidget);\nexport { SuggestWidget };\nexport class SuggestContentWidget {\n    constructor(_widget, _editor) {\n        this._widget = _widget;\n        this._editor = _editor;\n        this.allowEditorOverflow = true;\n        this.suppressMouseDown = false;\n        this._preferenceLocked = false;\n        this._added = false;\n        this._hidden = false;\n    }\n    dispose() {\n        if (this._added) {\n            this._added = false;\n            this._editor.removeContentWidget(this);\n        }\n    }\n    getId() {\n        return 'editor.widget.suggestWidget';\n    }\n    getDomNode() {\n        return this._widget.element.domNode;\n    }\n    show() {\n        this._hidden = false;\n        if (!this._added) {\n            this._added = true;\n            this._editor.addContentWidget(this);\n        }\n    }\n    hide() {\n        if (!this._hidden) {\n            this._hidden = true;\n            this.layout();\n        }\n    }\n    layout() {\n        this._editor.layoutContentWidget(this);\n    }\n    getPosition() {\n        if (this._hidden || !this._position || !this._preference) {\n            return null;\n        }\n        return {\n            position: this._position,\n            preference: [this._preference]\n        };\n    }\n    beforeRender() {\n        const { height, width } = this._widget.element.size;\n        const { borderWidth, horizontalPadding } = this._widget.getLayoutInfo();\n        return new dom.Dimension(width + 2 * borderWidth + horizontalPadding, height + 2 * borderWidth);\n    }\n    afterRender(position) {\n        this._widget._afterRender(position);\n    }\n    setPreference(preference) {\n        if (!this._preferenceLocked) {\n            this._preference = preference;\n        }\n    }\n    lockPreference() {\n        this._preferenceLocked = true;\n    }\n    unlockPreference() {\n        this._preferenceLocked = false;\n    }\n    setPosition(position) {\n        this._position = position;\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}